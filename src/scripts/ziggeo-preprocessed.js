/*!
ziggeo-js-sdk - v2.34.3 - 2019-06-24
Copyright (c) Ziggeo
Closed Source Software License.
*/

(function(){var Scoped=this.subScope();Scoped.define("module:",function(){return{guid:"6c65838a-53fd-4fd1-8d48-e571a0500135"}}),Scoped.define("private:Core",function(){return{servers:{local:{whitedomains:["*"],"server.api.server.public.domain":"localhost:91","server.api.server.public.protocol":"http","assets.api.server.public.domain":"localhost:92","assets.api.server.public.protocol":"http","embed.api.server.public.domain":"localhost:93","embed.api.server.public.protocol":"http","analytics.api.server.public.domain":"localhost:1197","analytics.api.server.public.protocol":"http","server.js-api.server.public.domain":"localhost:1197","server.js-api.server.public.protocol":"http","embed-cdn.api.server.public.domain":"localhost:93","embed-cdn.api.server.public.protocol":"http","streaming-cdn.api.server.public.domain":"localhost:90","streaming-cdn.api.server.public.protocol":"http","webserver.public.domain":"localhost:98","webserver.public.protocol":"http","web-api-server.public.domain":"localhost:96","web-api-server.public.protocol":"http","hosted.pages.server.public.domain":"localhost:99","hosted.pages.server.public.protocol":"http","wowza.api.record.rtmp.protocol":"rtmp","wowza.api.record.rtmp.domain":"localhost","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.rtmp.audiopath":"audiorecord/_definst_","wowza.api.record.webrtc.wssurl":"wss://localhost:4444/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo","wowza.api.record.webrtc.audioapp":"webrtcziggeoaudio",prefix:"",location:"Home",regions:{other:{prefix:"r1",location:"Somewhere","server.api.server.public.domain":"localhost:191","embed.api.server.public.domain":"localhost:193","analytics.api.server.public.domain":"localhost:2197","server.js-api.server.public.domain":"localhost:2197","embed-cdn.api.server.public.domain":"localhost:193","streaming-cdn.api.server.public.domain":"localhost:190","webserver.public.domain":"localhost:198","web-api-server.public.domain":"localhost:196","hosted.pages.server.public.domain":"localhost:199"}},tags:{local:!0,development:!0}},production:{whitedomains:["*.ziggeo.com","ziggeo.com","localhost"],"server.api.server.public.domain":"srvapi.ziggeo.com","server.api.server.public.protocol":"https","assets.api.server.public.domain":"assets.ziggeo.com","assets.api.server.public.protocol":"https","embed.api.server.public.domain":"embed.ziggeo.com","embed.api.server.public.protocol":"https","analytics.api.server.public.domain":"api-us-east-1.ziggeo.com","analytics.api.server.public.protocol":"https","server.js-api.server.public.domain":"api-us-east-1.ziggeo.com","server.js-api.server.public.protocol":"https","embed-cdn.api.server.public.domain":"embed-cdn.ziggeo.com","embed-cdn.api.server.public.protocol":"https","streaming-cdn.api.server.public.domain":"streaming-cdn.ziggeo.com","streaming-cdn.api.server.public.protocol":"https","webserver.public.domain":"ziggeo.com","webserver.public.protocol":"https","web-api-server.public.domain":"webapi.ziggeo.com","web-api-server.public.protocol":"https","hosted.pages.server.public.domain":"ziggeo.io","hosted.pages.server.public.protocol":"https","wowza.api.record.rtmp.protocol":"rtmps","wowza.api.record.rtmp.domain":"wowza.ziggeo.com","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.rtmp.audiopath":"audiorecord/_definst_","wowza.api.record.webrtc.wssurl":"wss://wowza.ziggeo.com:443/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo","wowza.api.record.webrtc.audioapp":"webrtcziggeoaudio",prefix:"",location:"U.S. / International",regions:{"eu-west-1":{prefix:"r1",location:"Ireland / EU","server.api.server.public.domain":"srvapi-eu-west-1.ziggeo.com","embed.api.server.public.domain":"embed-eu-west-1.ziggeo.com","analytics.api.server.public.domain":"api-eu-west-1.ziggeo.com","server.js-api.server.public.domain":"api-eu-west-1.ziggeo.com","embed-cdn.api.server.public.domain":"embed-cdn-eu-west-1.ziggeo.com","streaming-cdn.api.server.public.domain":"streaming-cdn-eu-west-1.ziggeo.com","webserver.public.domain":"eu-west-1.ziggeo.com","web-api-server.public.domain":"webapi-eu-west-1.ziggeo.com","hosted.pages.server.public.domain":"eu-west-1.ziggeo.io","wowza.api.record.rtmp.domain":"wowza-eu-west-1.ziggeo.com","wowza.api.record.webrtc.wssurl":"wss://wowza-eu-west-1.ziggeo.com:443/webrtc-session.json"}},tags:{production:!0}},development:{whitedomains:["*.ziggeo.com","ziggeo.com","localhost"],"server.api.server.public.domain":"srvapi-dev.ziggeo.com","server.api.server.public.protocol":"https","assets.api.server.public.domain":"assets-dev.ziggeo.com","assets.api.server.public.protocol":"https","embed.api.server.public.domain":"embed-dev.ziggeo.com","embed.api.server.public.protocol":"https","analytics.api.server.public.domain":"api-us-east-1-dev.ziggeo.com","analytics.api.server.public.protocol":"https","embed-cdn.api.server.public.domain":"embed-dev-cdn.ziggeo.com","embed-cdn.api.server.public.protocol":"https","server.js-api.server.public.domain":"api-us-east-1-dev.ziggeo.com","server.js-api.server.public.protocol":"https","streaming-cdn.api.server.public.domain":"streaming-cdn-dev.ziggeo.com","streaming-cdn.api.server.public.protocol":"https","webserver.public.domain":"www-dev.ziggeo.com","webserver.public.protocol":"https","web-api-server.public.domain":"webapi-dev.ziggeo.com","web-api-server.public.protocol":"https","hosted.pages.server.public.domain":"dev.ziggeo.io","hosted.pages.server.public.protocol":"https","wowza.api.record.rtmp.protocol":"rtmps","wowza.api.record.rtmp.domain":"wowza-dev.ziggeo.com","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.rtmp.audiopath":"audiorecord/_definst_","wowza.api.record.webrtc.wssurl":"wss://wowza-dev.ziggeo.com:443/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo","wowza.api.record.webrtc.audioapp":"webrtcziggeoaudio",prefix:"",location:"U.S. (US Law)",regions:{"eu-west-1":{prefix:"r1",location:"Ireland (European Law)","server.api.server.public.domain":"srvapi-dev-eu-west-1.ziggeo.com","embed.api.server.public.domain":"embed-dev-eu-west-1.ziggeo.com","analytics.api.server.public.domain":"api-eu-west-1.ziggeo.com","embed-cdn.api.server.public.domain":"embed-dev-cdn-eu-west-1.ziggeo.com","server.js-api.server.public.domain":"api-eu-west-1.ziggeo.com","streaming-cdn.api.server.public.domain":"streaming-cdn-dev-eu-west-1.ziggeo.com","webserver.public.domain":"dev-eu-west-1.ziggeo.com","web-api-server.public.domain":"webapi-dev-eu-west-1.ziggeo.com","hosted.pages.server.public.domain":"dev-eu-west-1.ziggeo.io","wowza.api.record.rtmp.domain":"wowza-dev-eu-west-1.ziggeo.com","wowza.api.record.webrtc.wssurl":"wss://wowza-dev-eu-west-1.ziggeo.com:443/webrtc-session.json"}},tags:{development:!0}}},models:{session_cookie_prefix:"i07af2jp98rvoctt26y5egy3"},revision:{version:1,revision:34,latest:!0,prerelease:!0},video:{iframe:{"allow-player-mods":["speakers","autoplay","fullscreen"],"allow-recorder-mods":["speakers","autoplay","fullscreen","microphone","camera","usermedia"],"allow-audio-player-mods":["speakers","autoplay","fullscreen"],"allow-audio-recorder-mods":["speakers","autoplay","fullscreen","microphone","usermedia"],"allow-image-viewer-mods":["fullscreen"],"allow-image-capture-mods":["fullscreen","camera","usermedia"]}}}}),Scoped.define("private:Application.Analytics",["base:Class","base:Events.EventsMixin","base:Objs","base:Time","base:Timers.Timer","browser:Info","private:Core","private:Environment","private:Logger"],function(e,t,n,o,i,c,d,a,s,r){var l=o.now();return e.extend({scoped:r},[t,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__google_analytics_events={},e.data.get("google_analytics")&&(this.__google_analytics_events=n.objectify(e.data.get("google_analytics_track"))),this.__queue=[],this.__trackFailed=0,this.__trackSuccess=0,this.application.data.get("analytics")&&(this.__timer=this.auto_destroy(new i({context:this,fire:this.__pushEvents,delay:5e3})))},_generateEvent:function(e,t,i,a,s,r){return r=r||o.now(),i=i||{},a=a||{},s=s||{},{tokens:n.extend({application_token:this.application.data.get("token")},i),client:{type:"web",version:"v"+d.revision.version+"-"+d.revision.revision,revision:d.revision.revision,sdk_version:e},environment:{location:document.location.href,time:r-l},device:{navigator_appname:navigator.appName,navigator_appcodename:navigator.appCodeName,navigator_appversion:navigator.appVersion,navigator_cookieenabled:navigator.cookieEnabled,navigator_language:navigator.language||navigator.userLanguage||"",navigator_platform:navigator.platform,navigator_useragent:navigator.userAgent,navigator_window_chrome:"chrome"in window,navigator_window_opera:"opera"in window,flash_installed:c.flash().installed(),flash_version_major:c.flash().installed()?c.flash().version().major:0,flash_version_minor:c.flash().installed()?c.flash().version().minor:0},event:{time:r,type:t,media_time:a.media_time||null,embed_type:a.embed_type||null,data_size:a.data_size||null,bandwidth:a.bandwidth||null},media:{duration:s.duration||null,width:s.width||null,height:s.height||null,tags:s.tags?s.tags.join(","):null,creation_type:s.creation_type||null,hd:s.width&&s.height&&921600<=s.width*s.height}}},track:function(e,t,i,a,s,r){try{var n=this._generateEvent(e,t,i,a,s,r);this.application.data.get("analytics")&&this.__queue.push(n),this.__google_analytics_events[t]&&ga("send","event","Ziggeo",t,"Ziggeo Campaign",a.media_time||s.duration||a.data_size||undefined),this.trigger("track",n)}catch(o){}},userTrack:function(e){this.track("2",e)},__pushEvents:function(){if(this.application.data.get("analytics")&&0!==this.__queue.length&&!(10<this.__trackFailed&&this.__trackSuccess/this.__trackFailed<.5)){var e=this.__queue;this.__queue=[],this.application.connect.apiRequest("/scitylana/kcart",{data:{events:JSON.stringify(e)},method:"POST"}).error(function(){this.__trackFailed++,this.__queue=e.concat(this.__queue)},this).success(function(){this.__trackSuccess++},this)}}}}])}),Scoped.define("module:Application",["base:Class","base:Objs","base:Events.EventsMixin","base:Events.Events","base:Async","browser:Dom","module:Locale","private:Application.Data","private:Application.Urls","private:Application.Connect","private:Application.Videos","private:Application.Streams","private:Application.Audios","private:Application.AudioStreams","private:Application.Images","private:Application.ImageStreams","private:Application.Analytics","private:Application.Debugger","module:Supplementary"],function(e,i,t,a,s,r,n,o,c,d,l,u,p,h,m,g,_,f,v,y){return n.mainLocale.register({error_503:"We are maintaining our service. We will be back shortly.",error_404:"We cannot recognize your api key. Please make sure to specify it in your website's header.",error_401:"You are not allowed to access the application from this site.",error_412:"You need to confirm / upgrade your account.",error_unknown:"An unknown error occurred. Our team has been notified and will resolve the issue."},"application"),e.extend({scoped:y},[t,function(t){return{constructor:function(e){t.constructor.call(this),this.data=this.auto_destroy(new o(this,e)),this.data.get("debug")&&(this.debug=this.auto_destroy(new f(this))),this.urls=this.auto_destroy(new c(this)),this.connect=this.auto_destroy(new d(this)),this.videos=this.auto_destroy(new l(this)),this.streams=this.auto_destroy(new u(this)),this.audios=this.auto_destroy(new p(this)),this.audio_streams=this.auto_destroy(new h(this)),this.images=this.auto_destroy(new m(this)),this.image_streams=this.auto_destroy(new g(this)),this.analytics=this.auto_destroy(new _(this)),this.embed_events=this.auto_destroy(new a),this.embed_events._invokeCallback=v.eventInvokeCallback,this._invokeCallback=v.eventInvokeCallback,this.cls.register(this),this.__init()},destroy:function(){this.cls.unregister(this),t.destroy.call(this)},__init:function(){this.connect.request("session",{method:"POST",params:{noauth:!this.data.get("auth")}}).success(function(e){this.data.set("cookie_changed",e.token!==this.data.get("cookie_value")),this.data.set("cookie_value",e.token),this.data.set("testing_application",e.testing_application),this.data.set("ready",!0),this.analytics.track("2","init_application",{}),r.ready(function(){s.eventually(function(){this.persistentTrigger("ready")},this)},this)},this).error(function(e){this.data.set("error",e.status_code());var t=n.mainLocale.get("error_"+e.status_code(),"application");this.data.set("error_message",t||n.mainLocale.get("error_unknown","application")),this.persistentTrigger("error",e.status_code(),this.data.get("error_message"))},this)}}}],{__default:null,__instances:{},__deferred:0,events:new a,setDefault:function(e){this.__default=e,this.events.trigger("set-default",e)},getDefault:function(){return this.__default},getByToken:function(e){return this.__instances[e]},instanceByToken:function(e,t){return this.getByToken(e)||new this(i.extend({token:e},t))},register:function(e){var t=e.data.get("token");if(t in this.__instances)throw"Application Instance already existing for this application token.";this.__instances[t]=e,this.__default||this.setDefault(e)},unregister:function(e){var t=e.data.get("token");this.__instances[t]===e&&delete this.__instances[t],this.getDefault()===e&&this.setDefault(null)},isDeferred:function(){return 0<this.__deferred},defer:function(){this.__deferred++},undefer:function(){this.__deferred--,0===this.__deferred&&this.events.trigger("undefer")},onUndefer:function(e,t){this.isDeferred()?this.events.once("undefer",e,t):e.call(t||this)}})}),Scoped.define("private:Application.AudioStreams",["base:Class","base:Objs","private:Application.AudioStreamsApiMixin"],function(e,t,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e},audioUrl:function(e,t,i){var a="audios/"+e+"/streams/"+t+"/"+((i=i||{}).download?"download_audio.mp4":"audio.mp4");return this.application.urls.apiStreamingResourceUrl(a,{auth:i.auth,params:i.params})},rtmpStreamName:function(e,t,i){return this.application.urls.resourceUrl("applications/"+this.application.data.get("token"),"/audios/"+e+"/streams/"+t+"/audio.mp4",{auth:i})},webrtcStreamName:function(e,t,i){return"applications___"+this.application.data.get("token")+"___audios___"+e+"___streams___"+t+"___audio"},dataUploader:function(e,t,i){return this.audioAttachUploader(e,t,i.auth,i.audio_data)}}}])}),Scoped.define("private:Application.Audios",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.AudiosApiMixin"],function(e,s,c,d,l,t,r,u,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__cache={}},audioUrl:function(e,t){var i="audios/"+e+"/"+((t=t||{}).download?"download_audio.mp4":"audio.mp4");return this.application.urls.apiStreamingResourceUrl(i,{auth:t.auth,params:c.extend({refresh:this.refreshToken(e)},t.params)})},refreshToken:function(e){try{var t=this.cache(e,{weak:!0}).value();return t&&t.submission_date!==t.resubmission_date?86400<d.now()/1e3-t.resubmission_date?null:t.resubmission_date:null}catch(i){return null}},__cacheGet:function(e){return this.__cache[e]||(this.__cache[e]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[e]},__cacheUpdate:function(n,e){var o=this.__cacheGet(n);if(!(o.updating||o.next_update&&o.next_update<=e)){o.next_update&&(l.clearEventually(o.next_update_timer),o.next_update=null);var t=d.now();if(t<e)return o.next_update=e,void(o.next_update_timer=l.eventually(function(){this.__cacheUpdate(n)},this,e-t));o.updating=!0,this.get(n,o.auth).callback(function(t,i){o.ready=!0,o.updating=!1;var e=d.now(),a=o.last_update?e-o.last_update:null;o.last_update=e,o.next_update=null;var s=o.data,r=t;o.data=i,o.error=t,l.clearEventually(o.next_update_timer),c.iter(o.promises,function(e){e.asyncCallback(t,i)},this),(t&&!t.equals(r)||!u.deepEqual(i,s,10))&&c.iter(o.watchers,function(e){e.callback.call(e.context,t,i)},this),null===a?c.iter(o.watchers,function(e){e.weak||(a=null===a?e.initialage:Math.min(e.initialage,a))},this):a*=2,null!==a&&(c.iter(o.watchers,function(e){!e.weak&&e.maxage&&(a=Math.min(a,e.maxage))},this),this.__cacheUpdate(n,e+a))},this)}},cacheInvalidate:function(e){this.__cacheGet(e).ready=!1},cache:function(e,t){var i=this.__cacheGet(e);if((t=c.extend({auth:null,weak:!1,force:!1,age:null},t)).weak&&!i.ready)return s.error(!0);if(i.ready&&!t.force&&(!t.age||now-i.last_update<t.age))return i.data?s.value(i.data):s.error(i.error);t.auth&&(i.auth=t.auth);var a=s.create();return i.promises.push(a),this.__cacheUpdate(e),a},watch:function(e,t,i,a){var s=this.__cacheGet(e);(t=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},t)).auth&&(s.auth=t.auth),s.watchers[r.objectId(a)]={context:a,callback:i,weak:t.weak,maxage:t.maxage,age:t.initialage},t.weak||this.__cacheUpdate(e,t.initialage+d.now())},unwatch:function(e,t){delete this.__cacheGet(e).watchers[r.objectId(t)]},createByUpload:function(a){return this.create(c.extend(c.clone(a.data,1),{create_stream:!0}),a.auth).mapSuccess(function(e){var t=s.create(),i=this.application.audio_streams.dataUploader(e.audio.token,e.stream.token,{auth:a.auth,audio_data:a.audio_data});return a.progress&&i.on("progress",a.progress,a.context),i.on("error",function(e){t.asyncError(e)},this),i.on("success",function(){this.application.audio_streams.submit(e.audio.token,e.stream.token,null,a.auth,50).forwardCallback(t)},this),i.upload(),t},this)}}}])}),Scoped.define("private:Application.Connect",["base:Class","base:Objs","base:Ajax.AjaxWrapper"],["browser:Ajax.IframePostmessageAjax","browser:Ajax.JsonpScriptAjax","browser:Ajax.XDomainRequestAjax","browser:Ajax.XmlHttpRequestAjax"],function(e,i,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.ajax=new a({sendContentType:!1,contentType:"urlencoded",wrapStatus:!0,wrapStatusParam:"_wrapstatus",noCache:!0,noCacheParam:"_nocache"})},destroy:function(){this.ajax.destroy(),t.destroy.call(this)},rawRequest:function(e,t){return this.ajax.execute({method:t.method,data:t.data,uri:e,resilience:t.resilience,sendContentType:t.sendContentType})},request:function(e,t){return this.rawRequest(this.application.urls.httpApiResourceUrl(e,t),t)},apiRequest:function(e,t){return this.rawRequest(this.application.urls.apiResourceUrl(e,t),i.extend({sendContentType:!0},t))}}})}),Scoped.define("private:Application.Data",["base:Properties.Properties","base:Objs","browser:Cookies","private:Core","browser:Upload.FileUploader","dynamics:Parser"],["browser:Upload.ChunkedFileUploader"],function(e,s,a,r,n,o,t){return e.extend({scoped:t},function(i){return{constructor:function(e,t){if(i.constructor.call(this),t=t||{},this.set("token",t.token),!this.get("token"))throw"You need to specify an application token when creating an application";this.set("webrtc_streaming","boolean"==typeof t.webrtc_streaming&&t.webrtc_streaming),this.set("webrtc_streaming_if_necessary","boolean"==typeof t.webrtc_streaming_if_necessary&&t.webrtc_streaming_if_necessary),this.set("webrtc_on_mobile","boolean"==typeof t.webrtc_on_mobile&&t.webrtc_on_mobile),this.set("cdn","boolean"!=typeof t.cdn||t.cdn),this.set("resumable",!1),this.set("auth","boolean"==typeof t.auth&&t.auth),this.set("analytics","boolean"!=typeof t.analytics||t.analytics),this.set("google_analytics","boolean"==typeof t.google_analytics&&t.google_analytics),this.set("google_analytics_track","undefined"!=typeof t.google_analytics_track?t.google_analytics_track:["init_application","embedding_loaded","record_start","record_end","rerecord_confirm","upload_start"]),this.compute("cookie_key",function(){return r.models.session_cookie_prefix+this.get("token")},["token"]),this.set("cookie_value",this.get("auth")?a.get(this.get("cookie_key")):""),this.on("change:cookie_value",function(e){this.get("auth")&&a.set(this.get("cookie_key"),e)},this),this.set("testing_application",!1),this.set("debug","debug"in t&&t.debug!==undefined?t.debug:r.revision.prerelease),this.set("chrome_extension_id",t.chrome_extension_id),this.set("opera_extension_id",t.opera_extension_id),this.set("chrome_extension_install_link",t.chrome_extension_install_link),this.set("opera_extension_install_link",t.opera_extension_install_link),t.disable_secure_templates&&(o.secureMode=!1)},getUploaderConfig:function(e,t,i){var a={url:e,serverSupportPostMessage:!0,resilience:5,serverSupportsChunked:this.get("resumable"),identifierParameter:"resumableIdentifier",chunks:{chunkNumberParameter:"resumableChunkNumber"},assembly:{fileNameParameter:"resumableFilename",totalSizeParameter:"resumableTotalSize",chunkNumberParameter:"resumableChunkNumber",fileTypeParameter:"resumableType"}};return t&&(a.source=t),s.extend(a,i)},getUploader:function(e,t,i){return n.create(this.getUploaderConfig(e,t,i))},getSignedUrlUploader:function(e){return e.signedUploadUrl}}})}),Scoped.define("private:Application.Debugger",["base:Class","base:Timers.Timer","browser:Events"],function(e,i,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__events=this.auto_destroy(new a),this.__events.on(window,"error",function(e){this.__logError({message:e.message,source:e.filename,lineno:e.lineno,colno:e.colno,time:e.timeStamp})},this),this.__queue=[],this.__quota=25,this.__timer=this.auto_destroy(new i({context:this,fire:this.__pushErrors,delay:5e3}))},__logError:function(e){this.__queue.length>=this.__quota||this.__queue.push(e)},__pushErrors:function(){if(0!==this.__queue.length){var e=this.__queue;this.__queue=[],this.__quota-=e.length,this.application.connect.request("/debugger",{data:{events:JSON.stringify(e)},method:"POST"})}}}})}),Scoped.define("private:Application.ImageStreams",["base:Class","base:Objs","private:Application.ImageStreamsApiMixin"],function(e,t,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e},imageUrl:function(e,t,i){var a="images/"+e+"/streams/"+t+"/"+((i=i||{}).download?"download_image.mp4":"image.mp4");return this.application.urls.apiStreamingResourceUrl(a,{auth:i.auth,params:i.params})},rtmpStreamName:function(e,t,i){return this.application.urls.resourceUrl("applications/"+this.application.data.get("token"),"/images/"+e+"/streams/"+t+"/image.mp4",{auth:i})},webrtcStreamName:function(e,t,i){return"applications___"+this.application.data.get("token")+"___images___"+e+"___streams___"+t+"___image"},dataUploader:function(e,t,i){return this.imageAttachUploader(e,t,i.auth,i.image_data)}}}])}),Scoped.define("private:Application.Images",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.ImagesApiMixin"],function(e,s,c,d,l,t,r,u,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__cache={}},imageUrl:function(e,t){var i="images/"+e+"/"+((t=t||{}).download?"download_image.mp4":"image.mp4");return this.application.urls.apiStreamingResourceUrl(i,{auth:t.auth,params:c.extend({refresh:this.refreshToken(e)},t.params)})},refreshToken:function(e){try{var t=this.cache(e,{weak:!0}).value();return t&&t.submission_date!==t.resubmission_date?86400<d.now()/1e3-t.resubmission_date?null:t.resubmission_date:null}catch(i){return null}},__cacheGet:function(e){return this.__cache[e]||(this.__cache[e]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[e]},__cacheUpdate:function(n,e){var o=this.__cacheGet(n);if(!(o.updating||o.next_update&&o.next_update<=e)){o.next_update&&(l.clearEventually(o.next_update_timer),o.next_update=null);var t=d.now();if(t<e)return o.next_update=e,void(o.next_update_timer=l.eventually(function(){this.__cacheUpdate(n)},this,e-t));o.updating=!0,this.get(n,o.auth).callback(function(t,i){o.ready=!0,o.updating=!1;var e=d.now(),a=o.last_update?e-o.last_update:null;o.last_update=e,o.next_update=null;var s=o.data,r=t;o.data=i,o.error=t,l.clearEventually(o.next_update_timer),c.iter(o.promises,function(e){e.asyncCallback(t,i)},this),(t&&!t.equals(r)||!u.deepEqual(i,s,10))&&c.iter(o.watchers,function(e){e.callback.call(e.context,t,i)},this),null===a?c.iter(o.watchers,function(e){e.weak||(a=null===a?e.initialage:Math.min(e.initialage,a))},this):a*=2,null!==a&&(c.iter(o.watchers,function(e){!e.weak&&e.maxage&&(a=Math.min(a,e.maxage))},this),this.__cacheUpdate(n,e+a))},this)}},cacheInvalidate:function(e){this.__cacheGet(e).ready=!1},cache:function(e,t){var i=this.__cacheGet(e);if((t=c.extend({auth:null,weak:!1,force:!1,age:null},t)).weak&&!i.ready)return s.error(!0);if(i.ready&&!t.force&&(!t.age||now-i.last_update<t.age))return i.data?s.value(i.data):s.error(i.error);t.auth&&(i.auth=t.auth);var a=s.create();return i.promises.push(a),this.__cacheUpdate(e),a},watch:function(e,t,i,a){var s=this.__cacheGet(e);(t=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},t)).auth&&(s.auth=t.auth),s.watchers[r.objectId(a)]={context:a,callback:i,weak:t.weak,maxage:t.maxage,age:t.initialage},t.weak||this.__cacheUpdate(e,t.initialage+d.now())},unwatch:function(e,t){delete this.__cacheGet(e).watchers[r.objectId(t)]},createByUpload:function(a){return this.create(c.extend(c.clone(a.data,1),{create_stream:!0}),a.auth).mapSuccess(function(e){var t=s.create(),i=this.application.image_streams.dataUploader(e.image.token,e.stream.token,{auth:a.auth,image_data:a.image_data});return a.progress&&i.on("progress",a.progress,a.context),i.on("error",function(e){t.asyncError(e)},this),i.on("success",function(){this.application.image_streams.submit(e.image.token,e.stream.token,null,a.auth,50).forwardCallback(t)},this),i.upload(),t},this)}}}])}),Scoped.define("private:Application.Streams",["base:Class","base:Objs","private:Application.StreamsApiMixin","browser:Upload.MultiUploader"],function(e,t,i,s,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e},imageUrl:function(e,t,i){i=i||{};var a="videos/"+e+"/streams/"+t+"/image";return this.application.urls.httpStreamingResourceUrl(a,{auth:i.auth,params:i.params})},videoUrl:function(e,t,i){var a="videos/"+e+"/streams/"+t+"/"+((i=i||{}).download?"download_video.mp4":"video.mp4");return this.application.urls.httpStreamingResourceUrl(a,{auth:i.auth,params:i.params})},videoAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/videoattach",{auth:i})},videoAttachUploaderConfig:function(e,t,i,a){return this.application.data.getUploaderConfig(this.videoAttachUrl(e,t,i),a)},videoAttachUploader:function(e,t,i,a){return this.application.data.getUploader(this.videoAttachUrl(e,t,i),a)},imageAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/imageattach",{auth:i})},imageAttachUploaderConfig:function(e,t,i,a){return this.application.data.getUploaderConfig(this.imageAttachUrl(e,t,i),a,{nonessential:!1})},imageAttachUploader:function(e,t,i,a){return this.application.data.getUploader(this.imageAttachUrl(e,t,i),a,{essential:!1})},audioAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/audioattach",{auth:i})},subtitleAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/subtitleattach",{auth:i})},audioAttachUploaderConfig:function(e,t,i,a){return this.application.data.getUploaderConfig(this.audioAttachUrl(e,t,i),a)},subtitleAttachUploaderUrl:function(e,t,i){return this.subtitleAttachUrl(e,t,i)},audioAttachUploader:function(e,t,i,a){return this.application.data.getUploader(this.audioAttachUrl(e,t,i),a)},rtmpStreamName:function(e,t,i){return this.application.urls.resourceUrl("applications/"+this.application.data.get("token"),"/videos/"+e+"/streams/"+t+"/video.mp4",{auth:i})},webrtcStreamName:function(e,t,i){return"applications___"+this.application.data.get("token")+"___videos___"+e+"___streams___"+t+"___video"},dataUploader:function(e,t,i){var a=new s;return i.video_data&&a.addUploader(this.videoAttachUploader(e,t,i.auth,i.video_data)),i.audio_data&&a.addUploader(this.audioAttachUploader(e,t,i.auth,i.audio_data)),i.image_data&&a.addUploader(this.imageAttachUploader(e,t,i.auth,i.image_data)),a}}}])}),Scoped.define("private:Application.Urls",["base:Class","base:Objs","base:Sort","base:Types","base:Comparators","base:Net.Uri","base:Async","browser:Info","media:Flash.Support","media:WebRTC.RecorderWrapper","private:Environment"],function(e,i,a,t,s,r,n,o,c,d,l,u){return e.extend({scoped:u},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__servers=l.serversByToken(this.application.data.get("token")),this.__rtmpConnectivityResults={},this.__rtmpAudioConnectivityResults={}},httpApiBaseUrl:function(){return(l.sslRequired?"https":"http")+"://"+this.__servers["embed.api.server.public.domain"]},httpStreamingBaseUrl:function(){return(l.sslRequired?"https":"http")+"://"+this.__servers[this.application.data.get("cdn")?"embed-cdn.api.server.public.domain":"embed.api.server.public.domain"]},apiStreamingBaseUrl:function(){return(l.sslRequired?"https":"http")+"://"+this.__servers["streaming-cdn.api.server.public.domain"]},rtmpRecordingUrls:function(){var e=[];return e.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+"/"+this.__servers["wowza.api.record.rtmp.path"]),l.isLocal?(e.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+":1936/"+this.__servers["wowza.api.record.rtmp.path"]),e.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+":1936/"+this.__servers["wowza.api.record.rtmp.path"])):(e.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+":80/"+this.__servers["wowza.api.record.rtmp.path"]),e.push("rtmps://"+this.__servers["wowza.api.record.rtmp.domain"]+":443/"+this.__servers["wowza.api.record.rtmp.path"]),e.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+":80/"+this.__servers["wowza.api.record.rtmp.path"])),e.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+"/"+this.__servers["wowza.api.record.rtmp.path"]),e.filter(function(e){return 0<this.__rtmpConnectivityResults[e]},this).concat(e.filter(function(e){return!this.__rtmpConnectivityResults[e]},this)).concat(e.filter(function(e){return this.__rtmpConnectivityResults[e]<0},this))},registerRtmpConnectivityResult:function(e,t){this.__rtmpConnectivityResults[e]=t},rtmpRecordingUrl:function(){return this.rtmpRecordingUrls()[0]},webrtcStreamingApp:function(e){return this.__servers["wowza.api.record.webrtc.app"]+(e||"")},wssUrl:function(){return this.__servers["wowza.api.record.webrtc.wssurl"]},rtmpAudioRecordingUrls:function(){var e=[];return e.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+"/"+this.__servers["wowza.api.record.rtmp.audiopath"]),l.isLocal?(e.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+":1936/"+this.__servers["wowza.api.record.rtmp.audiopath"]),e.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+":1936/"+this.__servers["wowza.api.record.rtmp.audiopath"])):(e.push("rtmp://"+this.__servers["wowza.api.record.rtmp.domain"]+":80/"+this.__servers["wowza.api.record.rtmp.audiopath"]),e.push("rtmps://"+this.__servers["wowza.api.record.rtmp.domain"]+":443/"+this.__servers["wowza.api.record.rtmp.audiopath"]),e.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+":80/"+this.__servers["wowza.api.record.rtmp.audiopath"])),e.push("rtmpt://"+this.__servers["wowza.api.record.rtmp.domain"]+"/"+this.__servers["wowza.api.record.rtmp.audiopath"]),e.filter(function(e){return 0<this.__rtmpAudioConnectivityResults[e]},this).concat(e.filter(function(e){return!this.__rtmpAudioConnectivityResults[e]},this)).concat(e.filter(function(e){return this.__rtmpAudioConnectivityResults[e]<0},this))},registerRtmpAudioConnectivityResult:function(e,t){this.__rtmpAudioConnectivityResults[e]=t},rtmpAudioRecordingUrl:function(){return this.rtmpAudioRecordingUrls()[0]},webrtcAudioStreamingApp:function(e){return this.__servers["wowza.api.record.webrtc.audioapp"]+(e||"")},httpApiAppUrl:function(){return this.httpApiBaseUrl()+"/v1/applications/"+this.application.data.get("token")},apiBaseUrl:function(){return(l.isLocal?"http":"https")+"://"+this.__servers["analytics.api.server.public.domain"]},apiAppUrl:function(){return this.apiBaseUrl()+"/embed/v1/applications/"+this.application.data.get("token")},apiResourceUrl:function(e,t){return this.resourceUrl(this.apiAppUrl(),e,i.extend({auth:!0},t))},httpApiResourceUrl:function(e,t){return this.resourceUrl(this.httpApiAppUrl(),e,i.extend({auth:!0},t))},httpStreamingAppUrl:function(){return this.httpStreamingBaseUrl()+"/v1/applications/"+this.application.data.get("token")},httpStreamingResourceUrl:function(e,t){return this.resourceUrl(this.httpStreamingAppUrl(),e,t)},apiStreamingAppUrl:function(){return this.apiStreamingBaseUrl()+"/v1/applications/"+this.application.data.get("token")},apiStreamingResourceUrl:function(e,t){return this.resourceUrl(this.apiStreamingAppUrl(),e,t)},urlParams:function(e){e=e||{};var t=i.extend({},i.filter(e.params,function(e,t){return null!==e&&""!==e}));return e.auth&&this.application.data.get("auth")&&((t=i.extend(t,i.filter(e.auth,function(e,t){return null!==e&&""!==e})))[this.application.data.get("cookie_key")]=this.application.data.get("cookie_value")),a.sort_object(t,s.byValue)},hostedBaseUrl:function(){return(l.sslRequired?"https":"http")+"://"+this.__servers["hosted.pages.server.public.domain"]},hostedUrl:function(e){return this.hostedBaseUrl()+e},resourceUrl:function(e,t,i){return r.appendUriParams(e+(t&&0!==t.indexOf("/")?"/":"")+t,this.urlParams(i))}}})}),Scoped.define("private:Application.Videos",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.VideosApiMixin"],function(e,s,c,d,l,t,r,u,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__cache={}},imageUrl:function(e,t){t=t||{};var i="videos/"+e+"/image";return this.application.urls.httpStreamingResourceUrl(i,{auth:t.auth,params:c.extend({refresh:this.refreshToken(e)},t.params)})},publicVideoUrl:function(e){return this.application.urls.hostedUrl("/v/"+e)},iframeVideoUrl:function(e){return this.application.urls.hostedUrl("/p/"+e)},iframeRecorderUrl:function(){return this.application.urls.hostedUrl("/r/"+this.application.data.get("token"))},videoUrl:function(e,t){var i="videos/"+e+"/"+((t=t||{}).download?"download_video.mp4":"video.mp4");return this.application.urls.httpStreamingResourceUrl(i,{auth:t.auth,params:c.extend({refresh:this.refreshToken(e)},t.params)})},refreshToken:function(e){try{var t=this.cache(e,{weak:!0}).value();return t&&t.submission_date!==t.resubmission_date?86400<d.now()/1e3-t.resubmission_date?null:t.resubmission_date:null}catch(i){return null}},__cacheGet:function(e){return this.__cache[e]||(this.__cache[e]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[e]},__cacheUpdate:function(n,e){var o=this.__cacheGet(n);if(!(o.updating||o.next_update&&o.next_update<=e)){o.next_update&&(l.clearEventually(o.next_update_timer),o.next_update=null);var t=d.now();if(t<e)return o.next_update=e,void(o.next_update_timer=l.eventually(function(){this.__cacheUpdate(n)},this,e-t));o.updating=!0,this.get(n,o.auth).callback(function(t,i){o.ready=!0,o.updating=!1;var e=d.now(),a=o.last_update?e-o.last_update:null;o.last_update=e,o.next_update=null;var s=o.data,r=t;o.data=i,o.error=t,l.clearEventually(o.next_update_timer),c.iter(o.promises,function(e){e.asyncCallback(t,i)},this),(t&&!t.equals(r)||!u.deepEqual(i,s,10))&&c.iter(o.watchers,function(e){e.callback.call(e.context,t,i)},this),null===a?c.iter(o.watchers,function(e){e.weak||(a=null===a?e.initialage:Math.min(e.initialage,a))},this):a*=2,null!==a&&(c.iter(o.watchers,function(e){!e.weak&&e.maxage&&(a=Math.min(a,e.maxage))},this),this.__cacheUpdate(n,e+a))},this)}},cacheInvalidate:function(e){this.__cacheGet(e).ready=!1},cache:function(e,t){var i=this.__cacheGet(e);if((t=c.extend({auth:null,weak:!1,force:!1,age:null},t)).weak&&!i.ready)return s.error(!0);if(i.ready&&!t.force&&(!t.age||now-i.last_update<t.age))return i.data?s.value(i.data):s.error(i.error);t.auth&&(i.auth=t.auth);var a=s.create();return i.promises.push(a),this.__cacheUpdate(e),a},watch:function(e,t,i,a){var s=this.__cacheGet(e);(t=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},t)).auth&&(s.auth=t.auth),s.watchers[r.objectId(a)]={context:a,callback:i,weak:t.weak,maxage:t.maxage,age:t.initialage},t.weak||this.__cacheUpdate(e,t.initialage+d.now())},unwatch:function(e,t){delete this.__cacheGet(e).watchers[r.objectId(t)]},createByUpload:function(a){return this.create(c.extend(c.clone(a.data,1),{create_stream:!0}),a.auth).mapSuccess(function(e){var t=s.create(),i=this.application.streams.dataUploader(e.video.token,e.stream.token,{auth:a.auth,video_data:a.video_data,audio_data:a.audio_data,image_data:a.image_data});return a.progress&&i.on("progress",a.progress,a.context),i.on("error",function(e){t.asyncError(e)},this),i.on("success",function(){this.application.streams._recorder_submit(e.video.token,e.stream.token,null,a.auth,50).forwardCallback(t)},this),i.upload(),t},this)}}}])}),Scoped.define("module:Config",["private:Environment","base:Properties.Properties","base:Functions","flash:"],function(e,t,i,a){var s,r,n,o=new t;return s="flash",r=e.assetsBase+"ziggeo.swf",(n=function(e){a.options=a.options||{},a.options.flashFile=e})(r),o.set(s,r),o.on("change:"+s,function(e){n(e)}),{set:i.as_method(o.set,o),get:i.as_method(o.get,o)}}),Scoped.define("module:Device",["base:Events.Events","base:Functions","base:Async","base:Promise","media:Recorder.WebRTCVideoRecorderWrapper","media:Recorder.FlashVideoRecorderWrapper","media:WebRTC.Support","media:Flash.Support","browser:Info","private:Core"],function(e,t,i,a,s,r,n,o,c,d){var l=function(e,t){try{return e()}catch(i){return t||!1}},u=new e,p={info:l(function(){return{location:document.location.href,userAgent:navigator.userAgent,flash:c.formatFlash(),device:c.formatDevice(),os:c.formatOS(),browser:c.formatBrowser(),version:c.formatBrowserVersion(),revision:d.revision}},{}),on:t.as_method(u.on,u),webrtc:l(function(){return s.supported({})}),flash:l(function(){return r.supported({})}),cameras:null,microphones:null,camera_count:null,microphone_count:null},h=function(e){p.devices=e,p.cameras=e.video,p.microphones=e.audio,p.camera_count=e.videoCount,p.microphone_count=e.audioCount,u.persistentTrigger("device_info",p.cameras,p.microphones,p.camera_count,p.microphone_count),u.persistentTrigger(0<p.camera_count?"has_camera":"no_camera"),u.persistentTrigger(0<p.microphone_count?"has_microphone":"no_microphone")},m=function(){p.devices=null,u.persistentTrigger("device_error")};return p.media=function(){if("devices"in p)return p.devices?a.value(p.devices):a.error("failed");var t=a.create();try{n.enumerateMediaSources().success(function(e){t.asyncSuccess(e),h(e)}).error(function(){try{o.enumerateMediaSources().success(function(e){t.asyncSuccess(e),h(e)}).error(function(){t.asyncError("failed"),m()})}catch(e){t.asyncError("failed"),m()}})}catch(e){try{o.enumerateMediaSources().success(function(e){t.asyncSuccess(e),h(e)}).error(function(){t.asyncError("failed"),m()})}catch(e){t.asyncError("failed"),m()}}return t},p}),Scoped.define("private:Environment",["private:Logger","private:Core","browser:Info","browser:Loader","base:Objs","base:Types","base:Net.Uri"],function(e,t,i,a,s,r,n){t.revision.prerelease&&e.warn("You are currently using a prerelease version of the Ziggeo JS SDK. We suggest using the stable revision for production use, and prereleases for staging environments and tests only.");var o=!!Scoped.getGlobal("ZiggeoLocal")||!!Scoped.getGlobal("ZiggeoWeb")&&-1===location.hostname.indexOf("ziggeo.com"),c=!1;if(!o)try{c=-1!==location.protocol.indexOf("https")||0===location.protocol.indexOf("file")||i.isCordova()}catch(S){}try{0!==location.protocol.indexOf("file")||i.isCordova()||e.warn("In order to use Ziggeo's recording technology, this page needs to be served via https (for WebRTC) and at least via http (for Flash). The file:// protocol is not supported. For more details contact us at support@ziggeo.com")}catch(S){}try{0===location.protocol.indexOf("https")?window.location!==window.parent.location&&0===document.referrer.indexOf("https")&&e.warn("Accessing the camera and the microphone on insecure origins (HTTP) is deprecated, and future browser versions will stop to support insecure origins. We highly recommend upgrading to SSL (HTTPS). For more details contact us at support@ziggeo.com"):0===location.protocol.indexOf("http")&&e.warn("Accessing the camera and the microphone on insecure origins (HTTP) is deprecated, and future browser versions will stop to support insecure origins. We highly recommend upgrading to SSL (HTTPS). For more details contact us at support@ziggeo.com")}catch(S){}var d=!o,l=o||!!Scoped.getGlobal("ZiggeoDev")||!!Scoped.getGlobal("ZiggeoWeb")&&d&&-1!==location.hostname.indexOf("dev"),u=!l,p=o?"local":u?"production":"development",h=s.clone(t.servers[p],1),m={};if(u&&(m.cdn=h["assets.api.server.public.domain"].replace("assets.","assets-cdn.")),m.normal=h["assets.api.server.public.domain"],o)try{window.location.hostname&&/^\d+\.\d+\.\d+\.\d+$/.test(window.location.hostname)&&(h=s.map(h,function(e){return r.is_string(e)?e.replace("localhost",window.location.hostname):e}),m.local=h["assets.api.server.public.domain"])}catch(S){}var g=h["assets.api.server.public.domain"],_="/v"+t.revision.version+"-r"+t.revision.revision+"/",f=c?"https":"http",v=null;for(var y in m)try{var b=m[y],w=a.findScript(b);if(w&&-1!==w.src.indexOf("ziggeo.js")){var k=n.parse(w.src);f=c?"https":k.protocol,g=k.host,k.port&&(g+=":"+k.port),_=k.directory;break}}catch(S){}return v||(v=f+"://"+g+_),{isLocal:o,isServer:d,isDevelopment:l,isProduction:u,environment:p,serverEnvironments:t.servers,servers:h,serversByToken:function(t){var i=s.clone(h,-1);return s.iter(h.regions,function(e){0===t.indexOf(e.prefix)&&(i=s.extend(i,e))}),i},assetsDomain:g,assetsPath:_,assetsBase:v,sslRequired:c}}),Scoped.define("module:Locale",["base:Classes.LocaleAggregator","base:Classes.LocaleTable","browser:Info","mediacomponents:Assets"],function(e,t,i,a){var s=new e,r=new t;return s.register(r),s.register(a.strings),s.setWeakLocale(i.language()),{setLocale:function(e){s.setLocale(e)},mainLocale:r,mediaLocale:a.strings}}),Scoped.define("private:Logger",[],function(){return{__console:function(e,t){try{console&&console[e]&&console[e].apply(console,t)}catch(i){}return this},warn:function(){return this.__console("warn",arguments)},log:function(){return this.__console("log",arguments)}}}),Scoped.define("module:Ads",["mediacomponents:Ads.AdSenseVideoAdProvider","mediacomponents:Ads.VastVideoAdProvider"],function(e,t){return{AdSenseVideoAdProvider:e,VastVideoAdProvider:t}}),Scoped.define("module:Supplementary",["base:Async"],function(s){return{eventInvokeCallback:function(e,t,i){try{e.apply(t,i)}catch(a){s.eventually(function(){throw a})}}}}),Scoped.define("module:AudioPlayer",["mediacomponents:AudioPlayer.Dynamics.Player","private:Logger","module:Application","base:Types","module:PlayerStates","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Promise","base:TimeFormat","private:ZiggeoDynamicMixin"],function(e,t,i,a,s,r,n,o,l,c,d,u,p,h){return e.extend({scoped:h},[p,function(e){return{types:{playlist:"array",pauseonplay:"bool","lazy-application":"bool"},_notifications:{_activate:"_createWithApplication"},destroy:function(){this.application.embed_events.off(null,null,this),e.destroy.call(this)},attrs:{"client-auth":null,"server-auth":null,"intermediate-token":null,audio:null,stream:null,application:null,forcerefresh:!1,pauseonplay:!1},create:function(){if(this._invokeCallback=o.eventInvokeCallback,this.get("source")||0<this.get("sources").length)return e.create.call(this);this.set("ready",!1),this.__playlist=this.get("playlist"),this.set("playlist",null),e.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.set("audio_status",null)},_obtainApplication:function(){this.get("application")&&(this.application=a.is_string(this.get("application"))?i.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||i.getDefault()},_createWithApplication:function(){if(this._obtainApplication(),this.application)if(this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")){if(this.application.embed_events.delegateEvents(null,this,null,[this]),this.__playlist){this.set("playlist",this.__playlist.map(function(e){return this.__sourceByAudio(e)},this));var e=this.get("playlist")[0];this.set("source",e.source),this.set("audio",e.token),this.on("playlist-next",function(e){this.set("audio",e.token)},this)}this.application.on("ready",function(){this.set("application_status",!0),this.get("playlist")||this.get("source")||this.__setAudioSources(),this.set("ready",!0),this._track("embedding_loaded")},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.get("pauseonplay")&&this.application.embed_events.on("playing",function(e){e!==this&&this.get("playing")&&this.execute("pause")},this)}else t.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false.");else t.warn("No application (token) defined. We need an application (token) to include an embedding.")},events:{"change:audio":function(){this.set("stream",null),this.__setAudioSources()},paused:function(){this._track("audio_play_pause",{media_time:this.get("position")})},playing:function(){this._track("audio_play_playing",{media_time:this.get("position")})},ended:function(){this._track("audio_play_end",{media_time:this.get("duration")})},seek:function(e){this._track("audio_play_seek",{media_time:e})}},__setAudioSources:function(){this.get("audio")&&this.get("application_status")&&(this.set("shareaudiourl",this.application.audios.publicAudioUrl(this.get("audio")).replace("http://","https://")),this.get("stream")||this.set("refresh_token",this.application.audios.refreshToken(this.get("audio"))),this.__setSources(),this.application.audios.cache(this.get("audio"),{auth:this.get("auth")}).callback(this.__audioUpdate,this),this.get("ready")&&this.reattachAudio())},__setSources:function(){this.setAll(this.__sourceByAudio(this.get("audio"),this.get("stream")))},__sourceByAudio:function(t,e){var i=this.get("audio_data"),a=l.filter(i&&i.streams?i.streams:[],function(e){return(e.token===i.original_stream.token||e.parent_stream===i.original_stream.token)&&5===e.state&&3===e.streamable},this);if(this.get("playlist")&&(a=[],e=null),e||a.length<2){var s=e?this.application.audio_streams:this.application.audios,r=[t];return e&&r.push(e),r.push({auth:this.get("auth"),params:{effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh")}}),{source:s.audioUrl.apply(s,r),token:t}}var n=[],o=[],c={force_refresh:this.get("forcerefresh"),auth:this.get("auth")};l.iter(a,function(e){n.push({src:this.application.audio_streams.audioUrl(t,e.token,c),token:e.token}),o.push({filter:{token:e.token}})},this);var d=o[0];return{source:null,sources:n,streams:o,currentstream:d,token:t}},__audioUpdate:function(e,t){if(!this.destroyed())if(e)this.set("audio_status",!1),e.status_code()===r.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("audio-not-found")}):e.status_code()===r.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("audio-access-forbidden")}):this.state().next("FatalError",{message:this.string("audio-unknown-error")});else{if(this.set("audio_data",t),this.get("title")||this.set("title",t.title),this.set("totalduration",t.duration),!1===t.approved&&!this.get("intermediate-token"))return void this.state().next("FatalError",{message:t.moderation_reason||this.string("audio-rejected")});if(t.state<4)return void this.state().next("FatalError",{message:this.string("audio-unknown-error")});if(this.set("audio_status",!0),4===t.state)return void("AudioProcessing"!==this.state().state_name()&&this.state().next("AudioProcessing"));if("AudioProcessing"===this.state().state_name())return this.set("refresh_token",this.application.audios.refreshToken(this.get("audio"))),this.set("forcerefresh",c.now()),this.__setSources(),void this.state().next("LoadPlayer");if(!this.get("stream")&&!this.get("refresh_token")&&this.application.audios.refreshToken(this.get("audio")))return this.set("refresh_token",this.application.audios.refreshToken(this.get("audio"))),this.__setSources(),void this.state().next("LoadPlayer");this.__setSources()}},_track:function(e,t,i){if(this.application){var a=c.now(),s=d.create();s.success(function(){this.application.analytics.track("2",e,{audio_token:this.get("audio_data").token,stream_token:this.get("stream")?this.get("stream"):undefined},l.extend({embed_type:"player"},t),l.extend({duration:this.get("audio_data").duration||this.get("duration"),tags:this.get("audio_data").tags},i),a)},this),this.get("audio_data")?s.asyncSuccess():this.once("change:audio_data",function(){s.asyncSuccess()},this)}}}}],function(e){return{playerStates:function(){return e.playerStates.call(this).concat([s])}}}).register("ba-ziggeoaudioplayer").register("ziggeoaudioplayer").attachStringTable(n.mainLocale).addStrings({"audio-not-found":"We could not find the specified audio file.","audio-access-forbidden":"You are not permitted to access this audio file.","audio-unknown-error":"We cannot access this audio at the moment. Please try again later.","audio-rejected":"The audio has been rejected.","audio-processing":"The audio is processing - stay tuned.","audio-access-error":"The audio is currently under moderation. You may click to retry."})}),Scoped.define("module:AudioPlayerStates.AudioProcessing",["mediacomponents:AudioPlayer.Dynamics.PlayerStates.State","base:Time","base:Timers.Timer"],function(e,a,t,i){return e.extend({scoped:i},function(e){return{dynamics:["loader","message"],_started:function(){this.dyn.set("message",this.dyn.string("audio-processing")),this.__audio=this.dyn.get("audio"),this.dyn.application.audios.watch(this.__audio,{auth:this.dyn.get("auth"),maxage:2500},this.dyn.__audioUpdate,this.dyn),this.dyn.set("start-processing-time",a.now()),this.dyn._track("audio_processing_start"),this.auto_destroy(new t({delay:100,context:this,fire:function(){var e=1e3;this.dyn.get("duration")&&1e3<this.dyn.get("duration")/60*1e3&&(e=this.dyn.get("duration")/60*1e3);var t=(a.now()-this.dyn.get("start-processing-time"))/e,i=1-1/(1+Math.sqrt(Math.sqrt(t)));this.dyn.trigger("processing",i),this.dyn.parent()&&this.dyn.parent().trigger("processing",i)}}))},_end:function(){this.dyn.application.audios.unwatch(this.__audio,this),this.dyn.set("end-processing-time",a.now()),this.dyn._track("audio_processing_end",{media_time:this.dyn.get("end-processing-time")-this.dyn.get("start-processing-time")}),this.dyn.trigger("processed"),this.dyn.parent()&&this.dyn.parent().trigger("processed"),e._end.call(this)}}})}),Scoped.define("module:AudioPlayerStates.PlayAudio",["mediacomponents:AudioPlayer.Dynamics.PlayerStates.PlayAudio"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("audio_play_start")}}})}),Scoped.define("module:PopupAudioPlayer",["module:AudioPlayer","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),Scoped.define("module:AudioRecorder",["mediacomponents:AudioRecorder.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","module:AudioRecorderStates","base:Types","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info","private:ZiggeoDynamicMixin"],function(AudioRecorder,Application,Device,Logger,Environment,AudioRecorderStates,Types,Time,Strings,Locale,Supplementary,Objs,Promise,Async,DomEvents,Info,ZiggeoDynamicMixin,scoped){return AudioRecorder.extend({scoped:scoped},[ZiggeoDynamicMixin,function(t){return{template:t.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynaudioplayer:"ziggeoaudioplayer","audio-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,audio:null,description:null,title:null,tags:null,"custom-data":null,key:null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"input-bind":null,"form-accept":null,playermodeifexists:!1,rerecordableifexists:!1},types:{tags:"array","custom-data":"object","expiration-days":"int","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()})},processed:function(){this.__had_processed=!0}},create:function(){this._invokeCallback=Supplementary.eventInvokeCallback,this.set("ready",!1),this.set("rtmpstreamtype",Environment.isLocal?"flv":"aac"),t.create.call(this),this.get("audio")&&!this.get("key")&&Strings.starts_with(this.get("audio"),"_")&&this.set("key",Strings.strip_start(this.get("audio"),"_")),this.get("simulate")&&this.set("localplayback",!0),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialaudio=!!this.get("audio"),this.get("audio")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new DomEvents),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.__had_processed=!1},_notifications:{_activate:"_createWithApplication"},_deferActivate:function(){if(this._obtainApplication(),(this.application||!this.get("lazy-application"))&&!this.get("playermodeifexists")&&!this.get("rerecordableifexists"))return!1;var t=Promise.create();return this.application?t.asyncSuccess(!0):Application.events.once("set-default",function(e){this.application=e,t.asyncSuccess(!0)},this),(this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(t=t.mapSuccess(function(){return this.application.audios.get(this.get("audio"),{auth:this.get("auth")}).success(function(e){e&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1))},this)},this)),t.success(this.activate,this),!0},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.set("playerattrs",{application:this.application,"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),audio:this.get("audio"),"force-refresh":Time.now()}),this._track("audio_embedding_loaded"),this.on("attached",function(){this.recorder.isFlash()&&this.recorder.on("endpoint_connectivity",function(e,t){this.application.urls.registerRtmpConnectivityResult(e.serverUrl,t)},this)},this),this._updateUrls(),this.set("webrtcstreaming",this.application.data.get("webrtc_streaming")),this.set("webrtcstreamingifnecessary",this.application.data.get("webrtc_streaming_if_necessary")),this.set("webrtconmobile",this.application.data.get("webrtc_on_mobile"))):Logger.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):Logger.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(e,t,i){this.application.analytics.track("2",e,{audio_token:this.get("audio"),stream_token:this.get("stream")},Objs.extend({embed_type:this.__hadInitialaudio?"rerecorder":"recorder"},t),Objs.extend({creation_type:this.get("creation-type"),duration:this.get("duration"),tags:this.get("tags")},i))},functions:{reset:function(){this.get("audio")&&!this.__hadInitialaudio&&this.set("audio",null),this.__had_processed=!1,t.functions.reset.call(this)},ready_to_play:function(){this.__had_processed||(this.trigger("processing",1),this.trigger("processed")),t.functions.ready_to_play.call(this)}},_updateUrls:function(){this.set("playerattrs.audio",this.get("audio"));var t=this.application.audio_streams.rtmpStreamName(this.get("audio"),this.get("stream"),this.get("auth"));this.set("uploadoptions",{rtmp:this.application.urls.rtmpAudioRecordingUrls().map(function(e){return{serverUrl:e,streamName:t}}),webrtcStreaming:{wssUrl:this.application.data.get("webrtc_streaming")||this.application.data.get("webrtc_streaming_if_necessary")?this.application.urls.wssUrl():undefined,streamInfo:this.application.data.get("webrtc_streaming")||this.application.data.get("webrtc_streaming_if_necessary")?{applicationName:this.application.urls.webrtcStreamingApp(Info.isFirefox()?"udp":""),streamName:this.application.streams.webrtcStreamName(this.get("audio"),this.get("stream"),this.get("auth"))}:undefined,delay:4750,stopDelay:2750},audio:Objs.extend({resilienceCheck:function(e){return!e||!e.duration}},this.application.audio_streams.attachUploaderConfig(this.get("audio"),this.get("stream"),this.get("auth")))})},__createParams:function(){var e={};try{var t=this.activeElement().cloneNode();t.innerHTML="",e=t.outerHTML}catch(i){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):undefined,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):undefined,key:this.get("key"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),force_overwrite:this.get("force-overwrite"),audio_profile:this.get("audio-profile"),meta_profile:this.get("meta-profile"),enforce_duration:this.get("enforce-duration"),recover_streams:this.get("recover-streams"),max_duration:this.get("timelimit"),user_language:navigator.language||navigator.userLanguage,audio_file_name:this._audioFileName,device_info:Objs.extend({api_version:2,embed_code:e},Device.info)}},__recordingTypeParams:function(){return this.isFlash()?{flash_recording:!0}:this.recorder?{webrtc_recording:!0,create_stream:!0,webrtc_streaming:this.isWebrtcStreaming()}:{create_stream:!0}},_prepareRecording:function(){return this.get("audio")?this.application.audio_streams.create(this.get("audio"),this.__recordingTypeParams(),this.get("auth")).mapSuccess(function(e){this.set("stream",e.token),this.set("stream_data",e),this._updateUrls()},this):this.application.audios.create(Objs.extend(this.__createParams(),this.__recordingTypeParams()),this.get("auth")).mapSuccess(function(e){this.set("audio",e.audio.token),this.set("audio_data",e.audio),this.set("stream",e.stream.token),this.set("stream_data",e.stream),this._updateUrls()},this)},_verifyRecording:function(){var e=Promise.create();return Async.eventually(function(){this.get("audio")&&(this.get("simulate")?Promise.value(!0):this.application.audio_streams.submit(this.get("audio"),this.get("stream"),{},this.get("auth"),50)).success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("audio")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.audios.cacheInvalidate(this.get("audio"))},this).forwardCallback(e)},this,2500),e},_afterActivate:function(e){t._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),e.parentElement.appendChild(this.__inputBindElement)),this.get("audio")&&(this.__inputBindElement.value=this.get("audio")))}}}],function(e){return{recorderStates:function(){return e.recorderStates.call(this).concat([AudioRecorderStates])}}}).register("ba-ziggeoaudiorecorder").register("ziggeoaudiorecorder").registerFunctions({testing:function(obj){with(obj)return testing}}).attachStringTable(Locale.mainLocale).addStrings({})}),Scoped.define("module:AudioRecorderStates.Recording",["mediacomponents:AudioRecorder.Dynamics.RecorderStates.Recording"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("audio_record_start")},_hasStopped:function(){e._hasStopped.call(this),this.dyn._track("audio_record_end",{media_time:this.dyn.get("duration")})}}})}),Scoped.define("module:AudioRecorderStates.Chooser",["mediacomponents:AudioRecorder.Dynamics.RecorderStates.Chooser"],function(e,t){return e.extend({scoped:t},function(t){return{_uploadFile:function(e){t._uploadFile.call(this,e),this.dyn._track("audio_upload_start",{data_size:e.size})}}})}),Scoped.define("module:AudioRecorderStates.Uploading",["mediacomponents:AudioRecorder.Dynamics.RecorderStates.Uploading","base:Time"],function(e,t,i){return e.extend({scoped:i},function(e){return{_started:function(){e._started.call(this),this.dyn.__had_processed=!1,this.dyn._track("audio_uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){e._finished.call(this),this.dyn._track("audio_uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",t.now())}}})}),Scoped.define("module:PopupAudioRecorder",["module:AudioRecorder","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),Scoped.define("private:Dynamics",["dynamics:DomObserver","dynamics:Parser","dynamics:Registries","base:Async","browser:Dom","module:Application"],function(e,t,i,a,s,r){t.secureMode=!0;var n=new e({allowed_dynamics:["ziggeoplayer","ziggeorecorder","ziggeoaudioplayer","ziggeoaudiorecorder","ziggeoimageviewer","ziggeoimagecapture","ziggeoiframeplayer","ziggeoiframerecorder"],enabled:!(i.prefixes.ziggeo=!0)});return s.ready(function(){a.eventually(function(){r.onUndefer(function(){n.enable()})})}),{domObserver:n}}),Scoped.define("private:ZiggeoDynamicMixin",["module:Application","base:Types"],function(e,t){return{_obtainApplication:function(){this.get("application")&&(this.application=t.is_string(this.get("application"))?e.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||e.getDefault()},_deferActivate:function(){return this._obtainApplication(),!(this.application||!this.get("lazy-application"))&&(e.events.once("set-default",function(e){this.application=e,this.activate()},this),!0)}}}),Scoped.define("module:ImageCapture",["mediacomponents:ImageCapture.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","module:ImageRecorderStates","base:Types","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info","private:ZiggeoDynamicMixin"],function(ImageCapture,Application,Device,Logger,Environment,ImageRecorderStates,Types,Time,Strings,Locale,Supplementary,Objs,Promise,Async,DomEvents,Info,ZiggeoDynamicMixin,scoped){return ImageCapture.extend({scoped:scoped},[ZiggeoDynamicMixin,function(t){return{template:t.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynimageviewer:"ziggeoimageviewer","effect-profile":null,"preview-effect-profile":null,"image-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,image:null,description:null,title:null,tags:null,"custom-data":null,key:null,"auto-crop":null,"auto-pad":null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"input-bind":null,"form-accept":null,playermodeifexists:!1,rerecordableifexists:!1},types:{tags:"array","custom-data":"object","auto-crop":"bool","auto-pad":"bool","expiration-days":"int","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","effect-profile":"array","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()})},processed:function(){this.__had_processed=!0}},create:function(){this._invokeCallback=Supplementary.eventInvokeCallback,this.set("ready",!1),t.create.call(this),this.get("image")&&!this.get("key")&&Strings.starts_with(this.get("image"),"_")&&this.set("key",Strings.strip_start(this.get("image"),"_")),this.get("simulate")&&this.set("localplayback",!0),Types.is_string(this.get("effect-profile"))&&this.set("effect-profile",Types.parseArray(this.get("effect-profile"))),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialimage=!!this.get("image"),this.get("image")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new DomEvents),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.__had_processed=!1},_notifications:{_activate:"_createWithApplication"},_deferActivate:function(){if(this._obtainApplication(),(this.application||!this.get("lazy-application"))&&!this.get("playermodeifexists")&&!this.get("rerecordableifexists"))return!1;var t=Promise.create();return this.application?t.asyncSuccess(!0):Application.events.once("set-default",function(e){this.application=e,t.asyncSuccess(!0)},this),(this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(t=t.mapSuccess(function(){return this.application.images.get(this.get("image"),{auth:this.get("auth")}).success(function(e){e&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1))},this)},this)),t.success(this.activate,this),!0},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.set("playerattrs",{application:this.application,"effect-profile":this.get("preview-effect-profile"),"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),image:this.get("image"),"force-refresh":Time.now()}),this._track("image_embedding_loaded"),this._updateUrls()):Logger.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):Logger.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(e,t,i){this.application.analytics.track("2",e,{image_token:this.get("image"),stream_token:this.get("stream")},Objs.extend({embed_type:this.__hadInitialimage?"rerecorder":"recorder"},t),Objs.extend({creation_type:this.get("creation-type"),width:this.get("recordingwidth"),height:this.get("recordingheight"),tags:this.get("tags")},i))},functions:{reset:function(){this.get("image")&&!this.__hadInitialimage&&this.set("image",null),this.__had_processed=!1,t.functions.reset.call(this)},ready_to_play:function(){this.__had_processed||(this.trigger("processing",1),this.trigger("processed")),t.functions.ready_to_play.call(this)}},_updateUrls:function(){this.set("playerattrs.image",this.get("image")),this.set("uploadoptions",{image:this.application.image_streams.attachUploaderConfig(this.get("image"),this.get("stream"),this.get("auth"))})},_readDeviceOrientation:function(){return window.orientation+90||undefined},__createParams:function(){var e={};try{var t=this.activeElement().cloneNode();t.innerHTML="",e=t.outerHTML}catch(i){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):undefined,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):undefined,key:this.get("key"),auto_crop:this.get("auto-crop"),auto_pad:this.get("auto-pad"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),effect_profile:this.get("effect-profile")?this.get("effect-profile").join(","):undefined,force_overwrite:this.get("force-overwrite"),image_profile:this.get("image-profile"),meta_profile:this.get("meta-profile"),recover_streams:this.get("recover-streams"),user_language:navigator.language||navigator.userLanguage,image_file_name:this._imageFileName,device_info:Objs.extend({api_version:2,embed_code:e},Device.info)}},_prepareRecording:function(){return this._requiresDeviceOrientation=Info.isMobile()&&Info.isiOS()&&window.orientation!==undefined&&this.recorder,this.get("image")?this.application.image_streams.create(this.get("image"),{},this.get("auth")).mapSuccess(function(e){this.set("stream",e.token),this.set("stream_data",e),this._updateUrls()},this):this.application.images.create(Objs.extend(this.__createParams(),{}),this.get("auth")).mapSuccess(function(e){this.set("image",e.image.token),this.set("image_data",e.image),this.set("stream",e.stream.token),this.set("stream_data",e.stream),this._updateUrls()},this)},_verifyRecording:function(){var e=Promise.create();return Async.eventually(function(){this.get("image")&&(this.get("simulate")?Promise.value(!0):this.application.streams._recorder_submit(this.get("image"),this.get("stream"),{rotation:this._requiresDeviceOrientation?this._readDeviceOrientation():undefined},this.get("auth"),50)).success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("image")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.images.cacheInvalidate(this.get("image"))},this).forwardCallback(e)},this,2500),e},_afterActivate:function(e){t._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),e.parentElement.appendChild(this.__inputBindElement)),this.get("image")&&(this.__inputBindElement.value=this.get("image")))}}}],function(e){return{recorderStates:function(){return e.recorderStates.call(this).concat([ImageRecorderStates])}}}).register("ba-ziggeoimagecapture").register("ziggeoimagecapture").registerFunctions({testing:function(obj){with(obj)return testing}}).attachStringTable(Locale.mainLocale).addStrings({})}),Scoped.define("module:ImageRecorderStates.Recording",["mediacomponents:ImageCapture.Dynamics.RecorderStates.Recording"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("image_record_start")},_hasStopped:function(){e._hasStopped.call(this),this.dyn._track("image_record_end",{media_time:this.dyn.get("duration")})}}})}),Scoped.define("module:ImageRecorderStates.Chooser",["mediacomponents:ImageCapture.Dynamics.RecorderStates.Chooser"],function(e,t){return e.extend({scoped:t},function(t){return{_uploadFile:function(e){t._uploadFile.call(this,e),this.dyn._track("image_upload_start",{data_size:e.size})}}})}),Scoped.define("module:ImageRecorderStates.Uploading",["mediacomponents:ImageCapture.Dynamics.RecorderStates.Uploading","base:Time"],function(e,t,i){return e.extend({scoped:i},function(e){return{_started:function(){e._started.call(this),this.dyn.__had_processed=!1,this.dyn._track("image_uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){e._finished.call(this),this.dyn._track("image_uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",t.now())}}})}),Scoped.define("module:PopupImageCapture",["module:ImageCapture","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),Scoped.define("module:ImageViewer",["mediacomponents:ImageViewer.Dynamics.ImageViewer","private:Logger","module:Application","base:Types","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Promise","base:TimeFormat","private:ZiggeoDynamicMixin"],function(e,t,i,a,s,r,n,l,o,c,d,u,p){return e.extend({scoped:p},[u,function(e){return{attrs:{"stream-width":null,"stream-height":null,"effect-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,image:null,stream:null,application:null,forcerefresh:!1},types:{"lazy-application":"bool"},create:function(){if(this._invokeCallback=n.eventInvokeCallback,this.get("source")||0<this.get("sources").length)return e.create.call(this);this.set("ready",!1),this.get("effect-profile")&&a.is_array(this.get("effect-profile"))&&this.set("effect-profile",this.get("effect-profile")[0]),e.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.set("image_status",null)},_notifications:{_activate:"_createWithApplication"},_obtainApplication:function(){this.get("application")&&(this.application=a.is_string(this.get("application"))?i.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||i.getDefault()},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.get("source")||this.__setImageSources(),this.set("ready",!0),this._track("image_embedding_loaded")},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this)):t.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):t.warn("No application (token) defined. We need an application (token) to include an embedding.")},destroy:function(){this.application.embed_events.off(null,null,this),e.destroy.call(this)},events:{"change:image":function(){this.set("stream",null),this.__setImageSources()}},__setImageSources:function(){this.get("image")&&this.get("application_status")&&(this.set("shareimageurl",this.application.images.publicImageUrl(this.get("image")).replace("http://","https://")),this.get("stream")||this.set("refresh_token",this.application.images.refreshToken(this.get("image"))),this.__setSources(),this.application.images.cache(this.get("image"),{auth:this.get("auth")}).callback(this.__imageUpdate,this),this.get("ready")&&this.reattachImage())},__sourceByImage:function(t,e){var i=this.get("image_data"),a=l.filter(i&&i.streams?i.streams:[],function(e){return!(e.token!==i.original_stream.token&&e.parent_stream!==i.original_stream.token||5!==e.state||3!==e.streamable||this.get("effect-profile")&&e.effect_profile!==this.get("effect-profile"))},this);if(e||this.get("stream-width")||this.get("stream-height")||a.length<2){var s=e?this.application.image_streams:this.application.images,r=[t];return e&&r.push(e),r.push({auth:this.get("auth"),params:{stream_width:this.get("stream-width"),stream_height:this.get("stream-height"),effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh")}}),{source:s.imageUrl.apply(s,r),token:t}}var n=[],o=[],c={effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh"),auth:this.get("auth")};l.iter(a,function(e){n.push({src:this.application.image_streams.imageUrl(t,e.token,c),token:e.token}),o.push({width:e.image_width,height:e.image_height,filter:{token:e.token}})},this);var d=o[0];return{source:null,sources:n,streams:o,currentstream:d,token:t}},__setSources:function(){this.setAll(this.__sourceByImage(this.get("image"),this.get("stream")))},__imageUpdate:function(e,t){if(!this.destroyed())if(e)this.set("image_status",!1),e.status_code()===s.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("image-not-found")}):e.status_code()===s.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("image-access-forbidden")}):this.state().next("FatalError",{message:this.string("image-unknown-error")});else{if(this.set("image_data",t),this.get("title")||this.set("title",t.title),this.set("totalduration",t.duration),!1===t.approved&&!this.get("intermediate-token"))return void this.state().next("FatalError",{message:t.moderation_reason||this.string("image-rejected")});if(t.state<4)return void this.state().next("FatalError",{message:this.string("image-unknown-error")});if(this.set("image_status",!0),4===t.state)return void("ImageProcessing"!==this.state().state_name()&&this.state().next("ImageProcessing"));if(this.get("effect-profile")){var i=!1;if(l.iter(t.streams,function(e){e.effect_profile===this.get("effect-profile")&&4<e.state&&(i=!0)},this),!i)return void("ImageProcessing"!==this.state().state_name()&&this.state().next("ImageProcessing"));if("ImageProcessing"===this.state().state_name())return this.set("forcerefresh",o.now()),this.__setSources(),void this.state().next("LoadPlayer")}if("ImageProcessing"===this.state().state_name())return this.set("refresh_token",this.application.images.refreshToken(this.get("image"))),this.set("forcerefresh",o.now()),this.__setSources(),void this.state().next("LoadPlayer");if(!this.get("stream")&&!this.get("refresh_token")&&this.application.images.refreshToken(this.get("image")))return this.set("refresh_token",this.application.images.refreshToken(this.get("image"))),this.__setSources(),void this.state().next("LoadPlayer");this.__setSources()}},_track:function(e,t,i){if(this.application){var a=o.now(),s=c.create();s.success(function(){this.application.analytics.track("2",e,{image_token:this.get("image_data").token,stream_token:this.get("stream")?this.get("stream"):undefined},l.extend({embed_type:"player"},t),l.extend({width:this.get("stream")?this.get("stream").width:this.imageWidth(),height:this.get("stream")?this.get("stream").height:this.imageHeight(),tags:this.get("image_data").tags},i),a)},this),this.get("image_data")?s.asyncSuccess():this.once("change:image_data",function(){s.asyncSuccess()},this)}}}}]).register("ba-ziggeoimageviewer").register("ziggeoimageviewer").attachStringTable(r.mainLocale).addStrings({"image-not-found":"We could not find the specified image file.","image-access-forbidden":"You are not permitted to access this image file.","image-unknown-error":"We cannot access this image at the moment. Please try again later.","image-rejected":"The image has been rejected.","image-processing":"The image is processing - stay tuned.","image-access-error":"The image is currently under moderation. You may click to retry."})}),Scoped.define("module:PopupImageViewer",["module:ImageViewer","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),Scoped.define("module:Player",["mediacomponents:VideoPlayer.Dynamics.Player","private:Logger","module:Application","base:Types","module:PlayerStates","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Promise","base:TimeFormat","private:ZiggeoDynamicMixin"],function(e,t,i,a,s,o,r,n,l,c,d,u,p,h){return e.extend({scoped:h},[p,function(e){return{attrs:{"stream-width":null,"stream-height":null,"effect-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,video:null,stream:null,application:null,forcerefresh:!1,pauseonplay:!1,"audio-transcription-as-subtitles":!1},types:{playlist:"array",pauseonplay:"bool","lazy-application":"bool","audio-transcription-as-subtitles":"bool"},create:function(){if(this._invokeCallback=n.eventInvokeCallback,this.get("source")||0<this.get("sources").length)return e.create.call(this);this.set("ready",!1),this.__playlist=this.get("playlist"),this.set("playlist",null),this.get("effect-profile")&&a.is_array(this.get("effect-profile"))&&this.set("effect-profile",this.get("effect-profile")[0]),e.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.set("video_status",null)},_notifications:{_activate:"_createWithApplication"},_createWithApplication:function(){if(this._obtainApplication(),this.application)if(this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")){if(this.application.embed_events.delegateEvents(null,this,null,[this]),this.__playlist){this.set("playlist",this.__playlist.map(function(e){return this.__sourceByVideo(e)},this));var e=this.get("playlist")[0];this.set("poster",e.poster),this.set("source",e.source),this.set("video",e.token),this.on("playlist-next",function(e){this.set("video",e.token)},this)}this.application.on("ready",function(){this.set("application_status",!0),this.get("playlist")||this.get("source")||this.__setVideoSources(),this.set("ready",!0),this._track("embedding_loaded")},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.get("pauseonplay")&&this.application.embed_events.on("playing",function(e){e!==this&&this.get("playing")&&this.execute("pause")},this)}else t.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false.");else t.warn("No application (token) defined. We need an application (token) to include an embedding.")},destroy:function(){this.application.embed_events.off(null,null,this),e.destroy.call(this)},events:{"change:video":function(){this.set("stream",null),this.__setVideoSources()},paused:function(){this._track("play_pause",{media_time:this.get("position")})},playing:function(){this._track("play_playing",{media_time:this.get("position")})},ended:function(){this._track("play_end",{media_time:this.get("duration")})},seek:function(e){this._track("play_seek",{media_time:e})}},__setVideoSources:function(){this.get("video")&&this.get("application_status")&&(this.set("sharevideourl",this.application.videos.publicVideoUrl(this.get("video")).replace("http://","https://")),this.get("stream")||this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.__setSources(),this.application.videos.cache(this.get("video"),{auth:this.get("auth")}).callback(this.__videoUpdate,this),this.get("ready")&&this.reattachVideo())},__sourceByVideo:function(t,e){var i=this.get("video_data");i&&i.duration&&i.duration&&this.set("duration",i.duration);var a=l.filter(i&&i.streams?i.streams:[],function(e){return!(e.token!==i.original_stream.token&&e.parent_stream!==i.original_stream.token||5!==e.state||3!==e.streamable||(this.get("effect-profile")||e.effect_profile)&&e.effect_profile!==this.get("effect-profile"))},this);if(this.get("playlist")&&(a=[],e=null),e||this.get("stream-width")||this.get("stream-height")||a.length<2){var s=e?this.application.streams:this.application.videos,r=[t];return e&&r.push(e),r.push({auth:this.get("auth"),params:{stream_width:this.get("stream-width"),stream_height:this.get("stream-height"),effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh")}}),{poster:s.imageUrl.apply(s,r),source:s.videoUrl.apply(s,r),token:t}}var n=[],o=[],c={effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh"),auth:this.get("auth")};l.iter(a,function(e){n.push({src:this.application.streams.videoUrl(t,e.token,c),poster:this.application.streams.imageUrl(t,e.token,c),token:e.token}),o.push({width:e.video_width,height:e.video_height,filter:{token:e.token}})},this);var d=o[0];return{poster:null,source:null,sources:n,streams:o,currentstream:d,token:t}},__setSources:function(){this.set("uploadoptions",{textTracks:this.application.streams.subtitleAttachUploaderUrl(this.get("video"),this.get("stream")||this.properties().getProp("video_data.original_stream.token"),this.get("auth"))}),this.setAll(this.__sourceByVideo(this.get("video"),this.get("stream")))},__audioTranscriptionToVTT:function(e,t,i){i=i||5;for(var a=e.length,s=0,r=["WEBVTT"];s<a;){var n=t[s].start,o=t[s].end,c=[e[s]];for(s++,j=i-1;0<j&&s<a;)o=t[s].end,c.push(e[s]),s++,j--;r.push(""),r.push(u.format("HH:MM:ss.l",n)+" --\x3e "+u.format("HH:MM:ss.l",o)),r.push(c.join(" "))}return r.join("\n")},__videoUpdate:function(e,t){if(!this.destroyed())if(e)this.set("video_status",!1),e.status_code()===o.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("video-not-found")}):e.status_code()===o.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("video-access-forbidden")}):this.state().next("FatalError",{message:this.string("video-unknown-error")});else{this.set("video_data",t);var i=[];try{var a=t.default_stream.audio_transcription||t.original_stream.audio_transcription;a&&this.get("audio-transcription-as-subtitles")&&i.push({lang:"en",kind:"subtitles",label:"Transcription",content:this.__audioTranscriptionToVTT(a.words,a.times)});var s=t.default_stream.subtitles||t.original_stream.subtitles;s&&l.iter(s,function(e,t){i.push({lang:t,kind:"subtitles",label:e.label,content:e.data})})}catch(n){}if(this.set("tracktags",i),this.get("title")||this.set("title",t.title),this.set("totalduration",t.duration),!1===t.approved&&!this.get("intermediate-token"))return void this.state().next("FatalError",{message:t.moderation_reason||this.string("video-rejected")});if(t.state<4)return void this.state().next("FatalError",{message:this.string("video-unknown-error")});if(this.set("video_status",!0),4===t.state)return void("VideoProcessing"!==this.state().state_name()&&this.state().next("VideoProcessing"));if(this.get("effect-profile")){var r=!1;if(l.iter(t.streams,function(e){e.effect_profile===this.get("effect-profile")&&4<e.state&&(r=!0)},this),!r)return void("VideoProcessing"!==this.state().state_name()&&this.state().next("VideoProcessing"));if("VideoProcessing"===this.state().state_name())return this.set("forcerefresh",c.now()),this.__setSources(),void this.state().next("LoadPlayer")}if("VideoProcessing"===this.state().state_name())return this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.set("forcerefresh",c.now()),this.__setSources(),void this.state().next("LoadPlayer");if(!this.get("stream")&&!this.get("refresh_token")&&this.application.videos.refreshToken(this.get("video")))return this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.__setSources(),void this.state().next("LoadPlayer");this.__setSources()}},_track:function(e,t,i){if(this.application){var a=c.now(),s=d.create();s.success(function(){this.application.analytics.track("2",e,{video_token:this.get("video_data").token,stream_token:this.get("stream")?this.get("stream"):undefined},l.extend({embed_type:"player"},t),l.extend({duration:this.get("video_data").duration||this.get("duration"),width:this.get("stream")?this.get("stream").width:this.videoWidth(),height:this.get("stream")?this.get("stream").height:this.videoHeight(),tags:this.get("video_data").tags},i),a)},this),this.get("video_data")?s.asyncSuccess():this.once("change:video_data",function(){s.asyncSuccess()},this)}}}}],function(e){return{playerStates:function(){return e.playerStates.call(this).concat([s])}}}).register("ba-ziggeoplayer").register("ziggeoplayer").attachStringTable(r.mainLocale).addStrings({"video-not-found":"We could not find the specified video file.","video-access-forbidden":"You are not permitted to access this video file.","video-unknown-error":"We cannot access this video at the moment. Please try again later.","video-rejected":"The video has been rejected.","video-processing":"The video is processing - stay tuned.","video-access-error":"The video is currently under moderation. You may click to retry."})}),Scoped.define("module:PopupPlayer",["module:Player","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),Scoped.define("module:IframePlayer",["mediacomponents:IframeHelper","private:Core","private:ZiggeoDynamicMixin"],function(e,t,i,a){return e.extend({scoped:a},[i,{getAllowModifiers:function(){return t.video.iframe["allow-player-mods"]},getSrc:function(){return this.application.videos.iframeVideoUrl(this.get("video"))}}]).register("ba-ziggeoiframeplayer").register("ziggeoiframeplayer")}),Scoped.define("module:PlayerStates.PosterError",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.State"],function(e,t){return e.extend({scoped:t},{dynamics:["loader"],_fail:function(){4!==this.dyn.get("video_data").state?(this.dyn.set("loader_active",!1),this.dyn.set("message_active",!0),this.dyn.set("message",this.dyn.string("video-access-error")),this.listenOn(this.dyn,"message:click",function(){this.next("LoadPlayer")},this)):this.next("VideoProcessing")},_started:function(){!0===this.dyn.get("video_status")&&this._fail(),this.listenOn(this.dyn,"change:video_status",function(){!0===this.dyn.get("video_status")&&this._fail()})}})}),Scoped.define("module:PlayerStates.VideoProcessing",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.State","base:Time","base:Timers.Timer"],function(e,a,t,i){return e.extend({scoped:i},function(e){return{dynamics:["loader","message"],_started:function(){this.dyn.set("message",this.dyn.string("video-processing")),this.__video=this.dyn.get("video"),this.dyn.application.videos.watch(this.__video,{auth:this.dyn.get("auth"),maxage:2500},this.dyn.__videoUpdate,this.dyn),this.dyn.set("start-processing-time",a.now()),this.dyn._track("processing_start"),this.auto_destroy(new t({delay:100,context:this,fire:function(){var e=1e3;this.dyn.get("duration")&&1e3<this.dyn.get("duration")/60*1e3&&(e=this.dyn.get("duration")/60*1e3);var t=(a.now()-this.dyn.get("start-processing-time"))/e,i=1-1/(1+Math.sqrt(Math.sqrt(t)));this.dyn.trigger("processing",i),this.dyn.parent()&&this.dyn.parent().trigger("processing",i)}})),this.dyn.reattachImage()},_end:function(){this.dyn.application.videos.unwatch(this.__video,this),this.dyn.set("end-processing-time",a.now()),this.dyn._track("processing_end",{media_time:this.dyn.get("end-processing-time")-this.dyn.get("start-processing-time")}),this.dyn.trigger("processed"),this.dyn.parent()&&this.dyn.parent().trigger("processed"),e._end.call(this)}}})}),Scoped.define("module:PlayerStates.PlayVideo",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.PlayVideo"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn.application&&this.dyn.application.videos._playback(this.dyn.get("video"),null,this.dyn.get("auth")),this.dyn._track("play_start")}}})}),Scoped.define("module:Recorder",["mediacomponents:VideoRecorder.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","module:RecorderStates","base:Types","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info","private:ZiggeoDynamicMixin"],function(Recorder,Application,Device,Logger,Environment,RecorderStates,Types,Time,Strings,Locale,Supplementary,Objs,Promise,Async,DomEvents,Info,ZiggeoDynamicMixin,scoped){return Recorder.extend({scoped:scoped},[ZiggeoDynamicMixin,function(t){return{template:t.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynvideoplayer:"ziggeoplayer","effect-profile":null,"preview-effect-profile":null,"video-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,video:null,description:null,title:null,tags:null,"custom-data":null,key:null,"auto-crop":null,"auto-pad":null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"transcript-language":"en-US","input-bind":null,"form-accept":null,playermodeifexists:!1,rerecordableifexists:!1,chrome_extension_id:null,opera_extension_id:null,chrome_extension_install_link:null,opera_extension_install_link:null},types:{tags:"array","custom-data":"object","auto-crop":"bool","auto-pad":"bool","expiration-days":"int","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","effect-profile":"array","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()})},processed:function(){this.__had_processed=!0}},create:function(){this._invokeCallback=Supplementary.eventInvokeCallback,this.set("ready",!1),this.set("rtmpstreamtype",Environment.isLocal?"flv":"mp4"),t.create.call(this),this.get("video")&&!this.get("key")&&Strings.starts_with(this.get("video"),"_")&&this.set("key",Strings.strip_start(this.get("video"),"_")),this.get("simulate")&&this.set("localplayback",!0),Types.is_string(this.get("effect-profile"))&&this.set("effect-profile",Types.parseArray(this.get("effect-profile"))),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialVideo=!!this.get("video"),this.get("video")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new DomEvents),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.__had_processed=!1},_notifications:{_activate:"_createWithApplication"},_deferActivate:function(){if(this._obtainApplication(),(this.application||!this.get("lazy-application"))&&!this.get("playermodeifexists")&&!this.get("rerecordableifexists"))return!1;var t=Promise.create();return this.application?t.asyncSuccess(!0):Application.events.once("set-default",function(e){this.application=e,t.asyncSuccess(!0)},this),(this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(t=t.mapSuccess(function(t){return this.application.videos.get(this.get("video"),{auth:this.get("auth")}).mapSuccess(function(e){return e&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1)),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),t},this)},this)),t.success(this.activate,this),!0},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.get("chrome_extension_id")&&!this.get("chrome_extension_install_link")&&this.set("chrome_extension_install_link","https://chrome.google.com/webstore/detail/"+this.get("chrome_extension_id")),this.set("screen",{chromeExtensionId:this.get("chrome_extension_id")||this.application.data.get("chrome_extension_id"),operaExtensionId:this.get("opera_extension_id")||this.application.data.get("opera_extension_id"),chromeExtensionInstallLink:this.get("chrome_extension_install_link")||this.application.data.get("chrome_extension_install_link"),operaExtensionInstallLink:this.get("opera_extension_install_link")||this.application.data.get("opera_extension_install_link")}),this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.set("playerattrs",{application:this.application,"effect-profile":this.get("preview-effect-profile"),"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),video:this.get("video"),"force-refresh":Time.now()}),this._track("embedding_loaded"),this.on("attached",function(){this.recorder.isFlash()&&this.recorder.on("endpoint_connectivity",function(e,t){this.application.urls.registerRtmpConnectivityResult(e.serverUrl,t)},this)},this),this._updateUrls(),this.set("webrtcstreaming",this.application.data.get("webrtc_streaming")),this.set("webrtcstreamingifnecessary",this.application.data.get("webrtc_streaming_if_necessary")),this.set("webrtconmobile",this.application.data.get("webrtc_on_mobile"))):Logger.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):Logger.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(e,t,i){this.application.analytics.track("2",e,{video_token:this.get("video"),stream_token:this.get("stream")},Objs.extend({embed_type:this.__hadInitialVideo?"rerecorder":"recorder"},t),Objs.extend({creation_type:this.get("creation-type"),duration:this.get("duration"),width:this.get("recordingwidth"),height:this.get("recordingheight"),tags:this.get("tags")},i))},functions:{reset:function(){this.get("video")&&!this.__hadInitialVideo&&this.set("video",null),this.__had_processed=!1,t.functions.reset.call(this)},ready_to_play:function(){this.__had_processed||(this.trigger("processing",1),this.trigger("processed")),t.functions.ready_to_play.call(this)}},_updateUrls:function(){this.set("playerattrs.video",this.get("video"));var t=this.application.streams.rtmpStreamName(this.get("video"),this.get("stream"),this.get("auth"));this.set("uploadoptions",{rtmp:this.application.urls.rtmpRecordingUrls().map(function(e){return{serverUrl:e,streamName:t}}),webrtcStreaming:{wssUrl:this.application.data.get("webrtc_streaming")||this.application.data.get("webrtc_streaming_if_necessary")?this.application.urls.wssUrl():undefined,streamInfo:this.application.data.get("webrtc_streaming")||this.application.data.get("webrtc_streaming_if_necessary")?{applicationName:this.application.urls.webrtcStreamingApp(Info.isFirefox()?"udp":""),streamName:this.application.streams.webrtcStreamName(this.get("video"),this.get("stream"),this.get("auth"))}:undefined,delay:4750,stopDelay:2750},image:this.application.streams.imageAttachUploaderConfig(this.get("video"),this.get("stream"),this.get("auth")),video:Objs.extend({resilienceCheck:function(e){return!e||!e.duration}},this.application.streams.videoAttachUploaderConfig(this.get("video"),this.get("stream"),this.get("auth"))),audio:this.application.streams.audioAttachUploaderConfig(this.get("video"),this.get("stream"),this.get("auth")),textTracks:this.application.streams.subtitleAttachUploaderUrl(this.get("video"),this.get("stream"),this.get("auth"))})},_readDeviceOrientation:function(){return window.orientation+90||undefined},__createParams:function(){var e={};try{var t=this.activeElement().cloneNode();t.innerHTML="",e=t.outerHTML}catch(i){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):undefined,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):undefined,key:this.get("key"),auto_crop:this.get("auto-crop"),auto_pad:this.get("auto-pad"),only_audio:this.get("onlyaudio"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),effect_profile:this.get("effect-profile")?this.get("effect-profile").join(","):undefined,force_overwrite:this.get("force-overwrite"),video_profile:this.get("video-profile"),meta_profile:this.get("meta-profile"),enforce_duration:this.get("enforce-duration"),recover_streams:this.get("recover-streams"),max_duration:this.get("timelimit"),user_language:navigator.language||navigator.userLanguage,video_file_name:this._videoFileName,transcript_language:"auto"==this.get("transcript-language").toLowerCase()?navigator.language||navigator.userLanguage:this.get("transcript-language"),device_info:Objs.extend({api_version:2,embed_code:e,media_source:this.__getMediaSource(),capture_type:this.__getCaptureType()},Device.info)}},__recordingTypeParams:function(){return this.isFlash()?{flash_recording:!0}:this.recorder?{webrtc_recording:!0,create_stream:!0,webrtc_streaming:this.isWebrtcStreaming()}:{create_stream:!0}},__getMediaSource:function(){var e=this.__recordingTypeParams();return"screen"==this.get("record_media")?"screen":!0===e.flash_recording||!0===e.webrtc_recording?"record":"upload"},__getCaptureType:function(){var e=this.__recordingTypeParams();return!0===e.flash_recording?"flash":!0===e.webrtc_streaming?"webrtc_streaming":!0===e.webrtc_recording?"webrtc":"file_capture"},_prepareRecording:function(){return this._requiresDeviceOrientation=Info.isMobile()&&Info.isiOS()&&window.orientation!==undefined&&this.recorder,this.get("video")?this.application.streams.create(this.get("video"),this.__recordingTypeParams(),this.get("auth")).mapSuccess(function(e){this.set("stream",e.token),this.set("stream_data",e),this._updateUrls()},this):this.application.videos.create(Objs.extend(this.__createParams(),this.__recordingTypeParams()),this.get("auth")).mapSuccess(function(e){this.set("video",e.video.token),this.set("video_data",e.video),this.set("stream",e.stream.token),this.set("stream_data",e.stream),this._updateUrls()},this)},_verifyRecording:function(){var e=Promise.create();return Async.eventually(function(){this.get("video")&&(this.get("simulate")?Promise.value(!0):this.application.streams._recorder_submit(this.get("video"),this.get("stream"),{rotation:this._requiresDeviceOrientation?this._readDeviceOrientation():undefined},this.get("auth"),50)).success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("video")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.videos.cacheInvalidate(this.get("video"))},this).forwardCallback(e)},this,2500),e},_afterActivate:function(e){t._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),e.parentElement.appendChild(this.__inputBindElement)),this.get("video")&&(this.__inputBindElement.value=this.get("video")))}}}],function(e){return{recorderStates:function(){return e.recorderStates.call(this).concat([RecorderStates])}}}).register("ba-ziggeorecorder").register("ziggeorecorder").registerFunctions({testing:function(obj){with(obj)return testing}}).attachStringTable(Locale.mainLocale).addStrings({})}),Scoped.define("module:PopupRecorder",["module:Recorder","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),Scoped.define("module:IframeRecorder",["mediacomponents:IframeHelper","private:Core","private:ZiggeoDynamicMixin"],function(e,t,i,a){return e.extend({scoped:a},[i,{getAllowModifiers:function(){return t.video.iframe["allow-recorder-mods"]},getSrc:function(){return this.application.videos.iframeRecorderUrl()}}]).register("ba-ziggeoiframerecorder").register("ziggeoiframerecorder")}),Scoped.define("module:RecorderStates.Recording",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Recording"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("record_start")},_hasStopped:function(){e._hasStopped.call(this),this.dyn._track("record_end",{media_time:this.dyn.get("duration")})}}})}),Scoped.define("module:RecorderStates.Chooser",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Chooser"],function(e,t){return e.extend({scoped:t},function(t){return{_uploadFile:function(e){t._uploadFile.call(this,e),this.dyn._track("upload_start",{data_size:e.size})}}})}),Scoped.define("module:RecorderStates.CovershotSelection",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.CovershotSelection"],function(e,t){return e.extend({scoped:t},function(t){return{_nextUploading:function(e){this.dyn._track(e?"cover_skip":"cover_select"),t._nextUploading.call(this,e)}}})}),Scoped.define("module:RecorderStates.Uploading",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Uploading","base:Time"],function(e,t,i){return e.extend({scoped:i},function(e){return{_started:function(){e._started.call(this),this.dyn.__had_processed=!1,this.dyn._track("uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){e._finished.call(this),this.dyn._track("uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",t.now())}}})}),Scoped.define("private:Application.VideosApiMixin",function(){return{index:function(e,t,i){return this.application.connect.request("/videos/",{method:"GET",auth:t,resilience:i,data:e})},destroy:function(e,t,i){return this.application.connect.request("/videos/"+e,{method:"DELETE",auth:t,resilience:i})},create:function(e,t,i){return this.application.connect.request("/videos",{method:"POST",auth:t,resilience:i,data:e})},update:function(e,t,i,a){return this.application.connect.request("/videos/"+e,{method:"POST",auth:i,resilience:a,data:t})},_playback:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/playback",{method:"POST",auth:i,resilience:a,data:t})},get:function(e,t,i){return this.application.connect.request("/videos/"+e,{method:"GET",auth:t,resilience:i})}}}),Scoped.define("private:Application.StreamsApiMixin",function(){return{index:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/",{method:"GET",auth:i,resilience:a,data:t})},destroy:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t,{method:"DELETE",auth:i,resilience:a})},create:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams",{method:"POST",auth:i,resilience:a,data:t})},accept:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/accept",{method:"POST",auth:i,resilience:a})},_image_attach:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/imageattach",{method:"POST",auth:a,resilience:s,data:i})},_audio_attach:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/audioattach",{method:"POST",auth:a,resilience:s,data:i})},_recorder_submit:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/recordersubmit",{method:"POST",auth:a,resilience:s,data:i})},_uploader_state:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/uploaderstate",{method:"GET",auth:i,resilience:a})},_subtitle_attach:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/subtitleattach",{method:"POST",auth:i,resilience:a})}}}),Scoped.define("private:Application.AudiosApiMixin",function(){return{index:function(e,t,i){return this.application.connect.request("/audios/",{method:"GET",auth:t,resilience:i,data:e})},destroy:function(e,t,i){return this.application.connect.request("/audios/"+e,{method:"DELETE",auth:t,resilience:i})},create:function(e,t,i){return this.application.connect.request("/audios",{method:"POST",auth:t,resilience:i,data:e})},update:function(e,t,i,a){return this.application.connect.request("/audios/"+e,{method:"POST",auth:i,resilience:a,data:t})},get:function(e,t,i){return this.application.connect.request("/audios/"+e,{method:"GET",auth:t,resilience:i})}}}),Scoped.define("private:Application.AudioStreamsApiMixin",function(){return{index:function(e,t,i,a){return this.application.connect.request("/audios/"+e+"/streams/",{method:"GET",auth:i,resilience:a,data:t})},destroy:function(e,t,i,a){return this.application.connect.request("/audios/"+e+"/streams/"+t,{method:"DELETE",auth:i,resilience:a})},create:function(e,t,i,a){return this.application.connect.request("/audios/"+e+"/streams",{method:"POST",auth:i,resilience:a,data:t})},submit:function(e,t,i,a,s){return this.application.connect.request("/audios/"+e+"/streams/"+t+"/submit",{method:"POST",auth:a,resilience:s,data:i})},get:function(e,t,i,a){return this.application.connect.request("/audios/"+e+"/streams/"+t,{method:"GET",auth:i,resilience:a})}}}),Scoped.define("private:Application.ImagesApiMixin",function(){return{index:function(e,t,i){return this.application.connect.request("/images/",{method:"GET",auth:t,resilience:i,data:e})},destroy:function(e,t,i){return this.application.connect.request("/images/"+e,{method:"DELETE",auth:t,resilience:i})},create:function(e,t,i){return this.application.connect.request("/images",{method:"POST",auth:t,resilience:i,data:e})},update:function(e,t,i,a){return this.application.connect.request("/images/"+e,{method:"POST",auth:i,resilience:a,data:t})},get:function(e,t,i){return this.application.connect.request("/images/"+e,{method:"GET",auth:t,resilience:i})}}}),Scoped.define("private:Application.ImageStreamsApiMixin",function(){return{index:function(e,t,i,a){return this.application.connect.request("/images/"+e+"/streams/",{method:"GET",auth:i,resilience:a,data:t})},destroy:function(e,t,i,a){return this.application.connect.request("/images/"+e+"/streams/"+t,{method:"DELETE",auth:i,resilience:a})},create:function(e,t,i,a){return this.application.connect.request("/images/"+e+"/streams",{method:"POST",auth:i,resilience:a,data:t})},submit:function(e,t,i,a,s){return this.application.connect.request("/images/"+e+"/streams/"+t+"/submit",{method:"POST",auth:a,resilience:s,data:i})},get:function(e,t,i,a){return this.application.connect.request("/images/"+e+"/streams/"+t,{method:"GET",auth:i,resilience:a})}}})}).call(Scoped);