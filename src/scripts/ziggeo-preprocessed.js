/*!
ziggeo-js-sdk - v2.43.1 - 2023-04-07
Copyright (c) Ziggeo
Closed Source Software License.
*/
!function(){var e=this.subScope();e.define("module:",function(){return{guid:"6c65838a-53fd-4fd1-8d48-e571a0500135"}}),e.define("private:Core",function(){return{servers:{local:{whitedomains:["*"],"server.api.server.public.domain":"localhost:91","server.api.server.public.protocol":"http","assets.api.server.public.domain":"localhost:92","assets.api.server.public.protocol":"http","embed.api.server.public.domain":"localhost:93","embed.api.server.public.protocol":"http","analytics.api.server.public.domain":"localhost:1197","analytics.api.server.public.protocol":"http","server.js-api.server.public.domain":"localhost:1197","server.js-api.server.public.protocol":"http","embed-cdn.api.server.public.domain":"localhost:7342","embed-cdn.api.server.public.protocol":"http","media-cdn.api.server.public.domain":"localhost:7343","media-cdn.api.server.public.protocol":"http","streaming-cdn.api.server.public.domain":"localhost:90","streaming-cdn.api.server.public.protocol":"http","webserver.public.domain":"localhost:98","webserver.public.protocol":"http","web-api-server.public.domain":"localhost:96","web-api-server.public.protocol":"http","cdn-api-server.public.domain":"localhost:2396","cdn-api-server.public.protocol":"http","hosted.pages.server.public.domain":"localhost:99","hosted.pages.server.public.protocol":"http","wowza.api.record.rtmp.protocol":"rtmp","wowza.api.record.rtmp.domain":"localhost","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.rtmp.audiopath":"audiorecord/_definst_","wowza.api.record.webrtc.wssurl":"wss://localhost:4444/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo","wowza.api.record.webrtc.audioapp":"webrtcziggeoaudio",prefix:"",location:"Home",account_number_prefix:"01","server.default-date-format":"M j, Y","server.default-time-format":"h:i a",regions:{other:{prefix:"r1",location:"Somewhere",account_number_prefix:"02","server.api.server.public.domain":"localhost:191","embed.api.server.public.domain":"localhost:193","analytics.api.server.public.domain":"localhost:2197","server.js-api.server.public.domain":"localhost:2197","embed-cdn.api.server.public.domain":"localhost:11193","streaming-cdn.api.server.public.domain":"localhost:190","webserver.public.domain":"localhost:198","web-api-server.public.domain":"localhost:196","cdn-api-server.public.domain":"localhost:23196","hosted.pages.server.public.domain":"localhost:199","server.default-date-format":"d-m-Y","server.default-time-format":"H:i"}},tags:{local:!0,development:!0}},production:{whitedomains:["*.ziggeo.com","ziggeo.com","localhost"],"server.api.server.public.domain":"srv-api.ziggeo.com","server.api.server.public.protocol":"https","assets.api.server.public.domain":"assets.ziggeo.com","assets.api.server.public.protocol":"https","embed.api.server.public.domain":"embed-api.ziggeo.com","embed.api.server.public.protocol":"https","analytics.api.server.public.domain":"api-us-east-1.ziggeo.com","analytics.api.server.public.protocol":"https","server.js-api.server.public.domain":"api-us-east-1.ziggeo.com","server.js-api.server.public.protocol":"https","embed-cdn.api.server.public.domain":"video-cdn.ziggeo.com","embed-cdn.api.server.public.protocol":"https","streaming-cdn.api.server.public.domain":"streaming-cdn.ziggeo.com","streaming-cdn.api.server.public.protocol":"https","media-cdn.api.server.public.domain":"media-cdn.ziggeo.com","media-cdn.api.server.public.protocol":"https","webserver.public.domain":"ziggeo.com","webserver.public.protocol":"https","web-api-server.public.domain":"webapi.ziggeo.com","web-api-server.public.protocol":"https","cdn-api-server.public.domain":"cdnapi.ziggeo.com","cdn-api-server.public.protocol":"https","hosted.pages.server.public.domain":"ziggeo.io","hosted.pages.server.public.protocol":"https","wowza.api.record.rtmp.protocol":"rtmps","wowza.api.record.rtmp.domain":"wowza.ziggeo.com","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.rtmp.audiopath":"audiorecord/_definst_","wowza.api.record.webrtc.wssurl":"wss://wowza.ziggeo.com:443/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo","wowza.api.record.webrtc.audioapp":"webrtcziggeoaudio",prefix:"",location:"U.S. / International",account_number_prefix:"01","server.default-date-format":"M j, Y","server.default-time-format":"h:i a",regions:{"eu-west-1":{prefix:"r1",location:"Ireland / EU",account_number_prefix:"02","server.api.server.public.domain":"srv-api-eu-west-1.ziggeo.com","embed.api.server.public.domain":"embed-api-eu-west-1.ziggeo.com","analytics.api.server.public.domain":"api-eu-west-1.ziggeo.com","server.js-api.server.public.domain":"api-eu-west-1.ziggeo.com","embed-cdn.api.server.public.domain":"video-cdn-eu-west-1.ziggeo.com","streaming-cdn.api.server.public.domain":"streaming-cdn-eu-west-1.ziggeo.com","media-cdn.api.server.public.domain":"media-cdn-eu-west-1.ziggeo.com","webserver.public.domain":"eu-west-1.ziggeo.com","web-api-server.public.domain":"webapi-eu-west-1.ziggeo.com","cdn-api-server.public.domain":"cdnapi-eu-west-1.ziggeo.com","hosted.pages.server.public.domain":"eu-west-1.ziggeo.io","wowza.api.record.rtmp.domain":"wowza-eu-west-1.ziggeo.com","wowza.api.record.webrtc.wssurl":"wss://wowza-eu-west-1.ziggeo.com:443/webrtc-session.json","server.default-date-format":"d-m-Y","server.default-time-format":"H:i"}},tags:{production:!0}},development:{whitedomains:["*.ziggeo.com","ziggeo.com","localhost"],"server.api.server.public.domain":"srv-api-dev.ziggeo.com","server.api.server.public.protocol":"https","assets.api.server.public.domain":"assets-dev.ziggeo.com","assets.api.server.public.protocol":"https","embed.api.server.public.domain":"embed-api-dev.ziggeo.com","embed.api.server.public.protocol":"https","analytics.api.server.public.domain":"api-us-east-1-dev.ziggeo.com","analytics.api.server.public.protocol":"https","embed-cdn.api.server.public.domain":"video-dev-cdn.ziggeo.com","embed-cdn.api.server.public.protocol":"https","server.js-api.server.public.domain":"api-us-east-1-dev.ziggeo.com","server.js-api.server.public.protocol":"https","streaming-cdn.api.server.public.domain":"streaming-cdn-dev.ziggeo.com","streaming-cdn.api.server.public.protocol":"https","media-cdn.api.server.public.domain":"media-cdn-dev.ziggeo.com","media-cdn.api.server.public.protocol":"https","webserver.public.domain":"www-dev.ziggeo.com","webserver.public.protocol":"https","web-api-server.public.domain":"webapi-dev.ziggeo.com","web-api-server.public.protocol":"https","cdn-api-server.public.domain":"cdnapi-dev.ziggeo.com","cdn-api-server.public.protocol":"https","hosted.pages.server.public.domain":"dev.ziggeo.io","hosted.pages.server.public.protocol":"https","wowza.api.record.rtmp.protocol":"rtmps","wowza.api.record.rtmp.domain":"wowza-dev.ziggeo.com","wowza.api.record.rtmp.path":"record/_definst_","wowza.api.record.rtmp.audiopath":"audiorecord/_definst_","wowza.api.record.webrtc.wssurl":"wss://wowza-dev.ziggeo.com:443/webrtc-session.json","wowza.api.record.webrtc.app":"webrtcziggeo","wowza.api.record.webrtc.audioapp":"webrtcziggeoaudio",prefix:"",location:"U.S. (US Law)",account_number_prefix:"01","server.default-date-format":"M j, Y","server.default-time-format":"h:i a",regions:{"eu-west-1":{prefix:"r1",location:"Ireland (European Law)",account_number_prefix:"02","server.api.server.public.domain":"srv-api-dev-eu-west-1.ziggeo.com","embed.api.server.public.domain":"embed-api-dev-eu-west-1.ziggeo.com","analytics.api.server.public.domain":"api-eu-west-1.ziggeo.com","embed-cdn.api.server.public.domain":"video-dev-cdn-eu-west-1.ziggeo.com","server.js-api.server.public.domain":"api-eu-west-1.ziggeo.com","streaming-cdn.api.server.public.domain":"streaming-cdn-dev-eu-west-1.ziggeo.com","media-cdn.api.server.public.domain":"media-cdn-dev-eu-west-1.ziggeo.com","webserver.public.domain":"dev-eu-west-1.ziggeo.com","web-api-server.public.domain":"webapi-dev-eu-west-1.ziggeo.com","cdn-api-server.public.domain":"cdnapi-dev-eu-west-1.ziggeo.com","hosted.pages.server.public.domain":"dev-eu-west-1.ziggeo.io","wowza.api.record.rtmp.domain":"wowza-dev-eu-west-1.ziggeo.com","wowza.api.record.webrtc.wssurl":"wss://wowza-dev-eu-west-1.ziggeo.com:443/webrtc-session.json","server.default-date-format":"d-m-Y","server.default-time-format":"H:i"}},tags:{development:!0}}},models:{session_cookie_prefix:"i07af2jp98rvoctt26y5egy3"},revision:{version:1,revision:43,latest:!0,prerelease:!0},video:{iframe:{"allow-player-mods":["speakers","autoplay","fullscreen"],"allow-recorder-mods":["speakers","autoplay","fullscreen","microphone","camera","usermedia"],"allow-audio-player-mods":["speakers","autoplay","fullscreen"],"allow-audio-recorder-mods":["speakers","autoplay","fullscreen","microphone","usermedia"],"allow-image-viewer-mods":["fullscreen"],"allow-image-capture-mods":["fullscreen","camera","usermedia"]}}}}),e.define("private:Application.Analytics",["base:Class","base:Events.EventsMixin","base:Objs","base:Time","base:Timers.Timer","browser:Info","private:Application.AnalyticsApiMixin","private:Core","private:Environment","private:Logger"],function(e,t,r,o,i,a,s,c,n,d,l){var u=o.now();return e.extend({scoped:l},[t,s,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__google_analytics_events={},e.data.get("google_analytics")&&(this.__google_analytics_events=r.objectify(e.data.get("google_analytics_track"))),this.__queue=[],this.__trackFailed=0,this.__trackSuccess=0,this.application.data.get("analytics")&&(this.__timer=this.auto_destroy(new i({context:this,fire:this.__pushEvents,delay:5e3})))},_generateEvent:function(e,t,i,a,s,n){return n=n||o.now(),i=i||{},a=a||{},s=s||{},{tokens:r.extend({application_token:this.application.data.get("token")},i),client:{type:"web",version:"v"+c.revision.version+"-"+c.revision.revision,revision:c.revision.revision,sdk_version:e},environment:{location:document.location.href,time:n-u},device:{navigator_appname:navigator.appName,navigator_appcodename:navigator.appCodeName,navigator_appversion:navigator.appVersion,navigator_cookieenabled:navigator.cookieEnabled,navigator_language:navigator.language||navigator.userLanguage||"",navigator_platform:navigator.platform,navigator_useragent:navigator.userAgent,navigator_window_chrome:"chrome"in window,navigator_window_opera:"opera"in window},event:{time:n,type:t,media_time:a.media_time||null,embed_type:a.embed_type||null,data_size:a.data_size||null,bandwidth:a.bandwidth||null},media:{duration:s.duration||null,width:s.width||null,height:s.height||null,tags:s.tags?s.tags.join(","):null,creation_type:s.creation_type||null,hd:s.width&&s.height&&921600<=s.width*s.height}}},track:function(e,t,i,a,s,n){try{var r=this._generateEvent(e,t,i,a,s,n);this.application.data.get("analytics")&&this.__queue.push(r),this.__google_analytics_events[t]&&ga("send","event","Ziggeo",t,"Ziggeo Campaign",a.media_time||s.duration||a.data_size||undefined),this.trigger("track",r)}catch(o){}},userTrack:function(e){this.track("2",e)},__pushEvents:function(){var e;!this.application.data.get("analytics")||0===this.__queue.length||10<this.__trackFailed&&this.__trackSuccess/this.__trackFailed<.5||(e=this.__queue,this.__queue=[],this._push({events:JSON.stringify(e)}).error(function(){this.__trackFailed++,this.__queue=e.concat(this.__queue)},this).success(function(){this.__trackSuccess++},this))}}}])}),e.define("module:Application",["base:Class","base:Objs","base:Events.EventsMixin","base:Events.Events","base:Async","base:Promise","browser:Dom","module:Locale","private:Application.Data","private:Application.Urls","private:Application.Cache","private:Application.Connect","private:Application.Videos","private:Application.Streams","private:Application.Audios","private:Application.AudioStreams","private:Application.Images","private:Application.ImageStreams","private:Application.VideoCalls","private:Application.Analytics","private:Application.Debugger","module:Supplementary"],function(e,i,t,a,s,n,r,o,c,d,l,u,h,p,g,m,_,f,v,y,b,w,k){o.mainLocale.register({error_503:"We are maintaining our service. We will be back shortly.",error_404:"We cannot recognize your api key. Please make sure to specify it in your website's header.",error_401:"You are not allowed to access the application from this site.",error_412:"You need to confirm / upgrade your account.",error_unknown:"An unknown error occurred. Our team has been notified and will resolve the issue."},"application");var x=e.extend({scoped:k},[t,function(t){return{constructor:function(e){"lazy"===window.ZiggeoObserverConfig&&x.undefer(),t.constructor.call(this),this.__authCache={},this.data=this.auto_destroy(new c(this,e)),this.data.get("debug")&&(this.debug=this.auto_destroy(new b(this))),this.urls=this.auto_destroy(new d(this)),this.cache=this.auto_destroy(new l(this)),this.connect=this.auto_destroy(new u(this)),this.videos=this.auto_destroy(new h(this)),this.streams=this.auto_destroy(new p(this)),this.audios=this.auto_destroy(new g(this)),this.audio_streams=this.auto_destroy(new m(this)),this.images=this.auto_destroy(new _(this)),this.image_streams=this.auto_destroy(new f(this)),this.video_calls=this.auto_destroy(new v(this)),this.analytics=this.auto_destroy(new y(this)),this.embed_events=this.auto_destroy(new a),this.embed_events._invokeCallback=w.eventInvokeCallback,this._invokeCallback=w.eventInvokeCallback,this.cls.register(this),this.__init()},destroy:function(){this.cls.unregister(this),t.destroy.call(this)},__init:function(){this.connect.request("session",{method:"POST",params:{noauth:!this.data.get("auth")},resilience:5}).success(function(e){this.data.set("cookie_changed",e.token!==this.data.get("cookie_value")),this.data.set("cookie_value",e.token),this.data.set("testing_application",e.testing_application),this.data.set("ready",!0),this.analytics.track("2","init_application",{}),r.ready(function(){s.eventually(function(){this.persistentTrigger("ready")},this)},this)},this).error(function(e){this.data.set("error",e.status_code());var t=o.mainLocale.get("error_"+e.status_code(),"application");this.data.set("error_message",t||o.mainLocale.get("error_unknown","application")),this.persistentTrigger("error",e.status_code(),this.data.get("error_message"))},this)},authMediaReady:function(e,t,i){if(t&&e){var a=e.client_auth||e.server_auth;if(a&&!this.__authCache[a])return this[i].get(t,{auth:e}).callback(function(){this.__authCache[a]=!0},this)}return n.value(!0)},authVideoReady:function(e,t){return this.authMediaReady(e,t,"videos")},authAudioReady:function(e,t){return this.authMediaReady(e,t,"audios")}}}],{__default:null,__instances:{},__deferred:0,events:new a,setDefault:function(e){this.__default=e,this.events.trigger("set-default",e)},getDefault:function(){return this.__default},getByToken:function(e){return this.__instances[e]},instanceByToken:function(e,t){return this.getByToken(e)||new this(i.extend({token:e},t))},register:function(e){var t=e.data.get("token");if(t in this.__instances)throw"Application Instance already existing for this application token.";this.__instances[t]=e,this.__default||this.setDefault(e)},unregister:function(e){var t=e.data.get("token");this.__instances[t]===e&&delete this.__instances[t],this.getDefault()===e&&this.setDefault(null)},isDeferred:function(){return 0<this.__deferred},defer:function(){this.__deferred++},undefer:function(){this.__deferred--,0===this.__deferred&&this.events.trigger("undefer")},onUndefer:function(e,t){this.isDeferred()?this.events.once("undefer",e,t):e.call(t||this)}});return window.ZiggeoDefer&&x.__deferred++,["lazy","manual"].includes(window.ZiggeoObserverConfig)&&x.__deferred++,x}),e.define("private:Application.AudioStreams",["base:Class","base:Objs","private:Application.AudioStreamsApiMixin"],function(e,a,t,i){return e.extend({scoped:i},[t,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e},audioUrl:function(e,t,i){return this.application.urls.apiStreamingResourceUrl("audios/"+e+"/streams/"+t+"/audio.aac",{auth:(i=i||{}).auth,params:a.extend({download:!!i.download||null},i.params)})},webrtcStreamName:function(e,t,i){return"applications___"+this.application.data.get("token")+"___audios___"+e+"___streams___"+t+"___audio"}}}])}),e.define("private:Application.Audios",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Types","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.AudiosApiMixin"],function(e,s,c,d,l,u,t,n,h,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__cache={}},audioUrl:function(e,t){return this.application.urls.apiStreamingResourceUrl("audios/"+e+"/audio.aac",{auth:(t=t||{}).auth,params:c.extend({refresh:this.refreshToken(e),download:!!t.download||null},t.params)})},refreshToken:function(e){try{var t=this.cache(e,{weak:!0}).value();return t&&t.submission_date!==t.resubmission_date?86400<d.now()/1e3-t.resubmission_date?null:t.resubmission_date:null}catch(i){return null}},__cacheGet:function(e){return this.__cache[e]||(this.__cache[e]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[e]},__cacheUpdate:function(r,e){var t,o=this.__cacheGet(r);o.updating||o.next_update&&o.next_update<=e||(o.next_update&&(l.clearEventually(o.next_update_timer),o.next_update=null),(t=d.now())<e?(o.next_update=e,o.next_update_timer=l.eventually(function(){this.__cacheUpdate(r)},this,e-t)):(o.updating=!0,this.get(r,o.auth).callback(function(t,i){i=i&&i.audio?i.audio:i,o.ready=!0,o.updating=!1;var e=d.now(),a=o.last_update?e-o.last_update:null,s=(o.last_update=e,o.next_update=null,o.data),n=t;o.data=i,o.error=t,l.clearEventually(o.next_update_timer),c.iter(o.promises,function(e){e.asyncCallback(t,i)},this),o.promises=[],u.is_empty(o.watchers)||((!t||t.equals(n))&&h.deepEqual(i,s,10)||c.iter(o.watchers,function(e){e.callback.call(e.context,t,i)},this),null===a?c.iter(o.watchers,function(e){e.weak||(a=null===a?e.initialage:Math.min(e.initialage,a))},this):a*=2,null!==a&&(c.iter(o.watchers,function(e){!e.weak&&e.maxage&&(a=Math.min(a,e.maxage))},this),this.__cacheUpdate(r,e+a)))},this)))},cacheInvalidate:function(e){this.__cacheGet(e).ready=!1},cache:function(e,t){var i=this.__cacheGet(e);if((t=c.extend({auth:null,weak:!1,force:!1,age:null},t)).weak&&!i.ready)return s.error(!0);if(i.ready&&!t.force&&(!t.age||now-i.last_update<t.age))return i.data?s.value(i.data):s.error(i.error);t.auth&&(i.auth=t.auth);t=s.create();return i.promises.push(t),this.__cacheUpdate(e),t},watch:function(e,t,i,a){var s=this.__cacheGet(e);(t=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},t)).auth&&(s.auth=t.auth),s.watchers[n.objectId(a)]={context:a,callback:i,weak:t.weak,maxage:t.maxage,age:t.initialage},t.weak||this.__cacheUpdate(e,t.initialage+d.now())},unwatch:function(e,t){delete this.__cacheGet(e).watchers[n.objectId(t)]},createByUpload:function(a){return this.create(c.extend(c.clone(a.data,1),{create_stream:!0}),a.auth,5).mapSuccess(function(e){var t=s.create(),i=this.application.data.getSignedUploader(e.url_data.url,e.url_data.fields,a.audio_data);return a.progress&&i.on("progress",a.progress,a.context),i.on("error",function(e){t.asyncError(e)},this),i.on("success",function(){this.application.audio_streams.confirm(e.audio.token,e.audio_stream.token,{},a.auth,50).forwardCallback(t)},this),i.upload(),t},this)}}}])}),e.define("private:Application.Cache",["base:Class","base:Promise"],function(e,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this._cache={audios:{},videos:{},images:{}}},store:function(e,t,i){return this.getTable(i)[e]?this.update(e,t,i):this.create(e,t,i)},create:function(e,t,i){return this.getTable(i)[e]?a.error("Already exists"):(this.getTable(i)[e]=t,a.value(t))},read:function(e,t){return this.getTable(t)[e]?a.value(this.getTable(t)[e]):a.error("Not found")},update:function(e,t,i){return this.getTable(i)[e]?(this.getTable(i)[e]=t,a.value(t)):a.error("Not found")},remove:function(e,t){return this.getTable(t)[e]?(delete this.getTable(t)[e],a.value()):a.error("Not found")},getTable:function(e){return this._cache[(e||"video")+"s"]}}})}),e.define("private:Application.Connect",["base:Class","base:Objs","base:Ajax.AjaxWrapper"],["browser:Ajax.IframePostmessageAjax","browser:Ajax.JsonpScriptAjax","browser:Ajax.XDomainRequestAjax","browser:Ajax.XmlHttpRequestAjax"],function(e,i,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.ajax=new a({sendContentType:!1,contentType:"urlencoded",resilience:5,resilience_delay:2500,resilience_filter:function(e){return 400<=e.status_code()&&e.status_code()<500},wrapStatus:!0,wrapStatusParam:"_wrapstatus",noCache:!0,noCacheParam:"_nocache"})},destroy:function(){this.ajax.destroy(),t.destroy.call(this)},rawRequest:function(e,t){return this.ajax.execute({method:t.method,data:t.data,query:t.query,uri:e,resilience:t.resilience,sendContentType:t.sendContentType})},request:function(e,t){return this.rawRequest(this.application.urls.httpApiResourceUrl(e,t),t)},apiRequest:function(e,t){return this.rawRequest(this.application.urls.apiResourceUrl(e,t),i.extend({sendContentType:!0},t))}}})}),e.define("private:Application.Data",["base:Properties.Properties","base:Objs","browser:Cookies","private:Core","browser:Upload.FileUploader","dynamics:Parser"],["browser:Upload.ChunkedFileUploader"],function(e,a,s,n,r,o,t){return e.extend({scoped:t},function(i){return{constructor:function(e,t){if(i.constructor.call(this),this.set("token",(t=t||{}).token),!this.get("token"))throw"You need to specify an application token when creating an application";this.set("webrtc_streaming","boolean"==typeof t.webrtc_streaming&&t.webrtc_streaming),this.set("webrtc_streaming_if_necessary","boolean"!=typeof t.webrtc_streaming_if_necessary||t.webrtc_streaming_if_necessary),this.set("webrtc_on_mobile","boolean"==typeof t.webrtc_on_mobile&&t.webrtc_on_mobile),this.set("track_tags",Array.isArray(t.track_tags)?t.track_tags:[]),this.set("auth","boolean"==typeof t.auth&&t.auth),this.set("analytics","boolean"!=typeof t.analytics||t.analytics),this.set("google_analytics","boolean"==typeof t.google_analytics&&t.google_analytics),this.set("google_analytics_track","undefined"!=typeof t.google_analytics_track?t.google_analytics_track:["init_application","embedding_loaded","record_start","record_end","rerecord_confirm","upload_start"]),this.compute("cookie_key",function(){return n.models.session_cookie_prefix+this.get("token")},["token"]),this.set("cookie_value",this.get("auth")?s.get(this.get("cookie_key")):""),this.on("change:cookie_value",function(e){this.get("auth")&&s.set(this.get("cookie_key"),e)},this),this.set("testing_application",!1),this.set("debug","debug"in t&&t.debug!==undefined?t.debug:n.revision.prerelease),this.set("chrome_extension_id",t.chrome_extension_id),this.set("opera_extension_id",t.opera_extension_id),this.set("chrome_extension_install_link",t.chrome_extension_install_link),this.set("opera_extension_install_link",t.opera_extension_install_link),t.disable_secure_templates&&(o.secureMode=!1)},getUploaderConfig:function(e,t,i){e={url:e,serverSupportPostMessage:!0,resilience:5};return t&&(e.source=t),a.extend(e,i)},getUploader:function(e,t,i){return r.create(this.getUploaderConfig(e,t,i))},getSignedUploaderConfig:function(e,t,i){return this.getUploaderConfig(e,i,{data:t})},getSignedUploader:function(e,t,i){return r.create(this.getSignedUploaderConfig(e,t,i))}}})}),e.define("private:Application.Debugger",["base:Class","base:Timers.Timer","browser:Events"],function(e,i,a,t){return e.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__events=this.auto_destroy(new a),this.__events.on(window,"error",function(e){this.__logError({message:e.message,source:e.filename,lineno:e.lineno,colno:e.colno,time:e.timeStamp})},this),this.__queue=[],this.__quota=25,this.__timer=this.auto_destroy(new i({context:this,fire:this.__pushErrors,delay:5e3}))},__logError:function(e){this.__queue.length>=this.__quota||this.__queue.push(e)},__pushErrors:function(){var e;0!==this.__queue.length&&(e=this.__queue,this.__queue=[],this.__quota-=e.length,this.application.connect.request("/debugger",{data:{events:JSON.stringify(e)},method:"POST"}))}}})}),e.define("private:Application.ImageStreams",["base:Class","base:Objs","private:Application.ImageStreamsApiMixin"],function(e,a,t,i){return e.extend({scoped:i},[t,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e},imageUrl:function(e,t,i){return this.application.urls.apiStreamingResourceUrl("images/"+e+"/streams/"+t+"/image.jpg",{auth:(i=i||{}).auth,params:a.extend({download:!!i.download||null},i.params)})},webrtcStreamName:function(e,t,i){return"applications___"+this.application.data.get("token")+"___images___"+e+"___streams___"+t+"___image"},dataUploader:function(e,t,i){return this.imageAttachUploader(e,t,i.auth,i.image_data)}}}])}),e.define("private:Application.Images",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.ImagesApiMixin"],function(e,s,c,d,l,t,n,u,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__cache={}},imageUrl:function(e,t){return this.application.urls.apiStreamingResourceUrl("images/"+e+"/image.jpg",{auth:(t=t||{}).auth,params:c.extend({refresh:this.refreshToken(e),download:!!t.download||null},t.params)})},refreshToken:function(e){try{var t=this.cache(e,{weak:!0}).value();return t&&t.submission_date!==t.resubmission_date?86400<d.now()/1e3-t.resubmission_date?null:t.resubmission_date:null}catch(i){return null}},__cacheGet:function(e){return this.__cache[e]||(this.__cache[e]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[e]},__cacheUpdate:function(r,e){var t,o=this.__cacheGet(r);o.updating||o.next_update&&o.next_update<=e||(o.next_update&&(l.clearEventually(o.next_update_timer),o.next_update=null),(t=d.now())<e?(o.next_update=e,o.next_update_timer=l.eventually(function(){this.__cacheUpdate(r)},this,e-t)):(o.updating=!0,this.get(r,o.auth).callback(function(t,i){i=i&&i.image?i.image:i,o.ready=!0,o.updating=!1;var e=d.now(),a=o.last_update?e-o.last_update:null,s=(o.last_update=e,o.next_update=null,o.data),n=t;o.data=i,o.error=t,l.clearEventually(o.next_update_timer),c.iter(o.promises,function(e){e.asyncCallback(t,i)},this),(!t||t.equals(n))&&u.deepEqual(i,s,10)||c.iter(o.watchers,function(e){e.callback.call(e.context,t,i)},this),null===a?c.iter(o.watchers,function(e){e.weak||(a=null===a?e.initialage:Math.min(e.initialage,a))},this):a*=2,null!==a&&(c.iter(o.watchers,function(e){!e.weak&&e.maxage&&(a=Math.min(a,e.maxage))},this),this.__cacheUpdate(r,e+a))},this)))},cacheInvalidate:function(e){this.__cacheGet(e).ready=!1},cache:function(e,t){var i=this.__cacheGet(e);if((t=c.extend({auth:null,weak:!1,force:!1,age:null},t)).weak&&!i.ready)return s.error(!0);if(i.ready&&!t.force&&(!t.age||now-i.last_update<t.age))return i.data?s.value(i.data):s.error(i.error);t.auth&&(i.auth=t.auth);t=s.create();return i.promises.push(t),this.__cacheUpdate(e),t},watch:function(e,t,i,a){var s=this.__cacheGet(e);(t=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},t)).auth&&(s.auth=t.auth),s.watchers[n.objectId(a)]={context:a,callback:i,weak:t.weak,maxage:t.maxage,age:t.initialage},t.weak||this.__cacheUpdate(e,t.initialage+d.now())},unwatch:function(e,t){delete this.__cacheGet(e).watchers[n.objectId(t)]},createByUpload:function(a){return this.create(c.extend(c.clone(a.data,1),{create_stream:!0}),a.auth).mapSuccess(function(e){var t=s.create(),i=this.application.image_streams.dataUploader(e.image.token,e.stream.token,{auth:a.auth,image_data:a.image_data});return a.progress&&i.on("progress",a.progress,a.context),i.on("error",function(e){t.asyncError(e)},this),i.on("success",function(){this.application.image_streams.submit(e.image.token,e.stream.token,null,a.auth,50).forwardCallback(t)},this),i.upload(),t},this)}}}])}),e.define("private:Application.Streams",["base:Class","base:Objs","private:Application.StreamsApiMixin","browser:Upload.MultiUploader"],function(e,a,t,s,i){return e.extend({scoped:i},[t,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e},imageUrl:function(e,t,i){return this.application.urls.httpStreamingResourceUrl("videos/"+e+"/streams/"+t+"/image",{auth:(i=i||{}).auth,params:i.params})},videoUrl:function(e,t,i){return this.application.urls.httpStreamingResourceUrl("videos/"+e+"/streams/"+t+"/video.mp4",{auth:(i=i||{}).auth,params:a.extend({download:!!i.download||null},i.params)})},videoAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/videoattach",{auth:i})},videoAttachUploaderConfig:function(e,t,i,a){return this.application.data.getUploaderConfig(this.videoAttachUrl(e,t,i),a)},videoAttachUploader:function(e,t,i,a){return this.application.data.getUploader(this.videoAttachUrl(e,t,i),a)},imageAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/imageattach",{auth:i})},imageAttachUploaderConfig:function(e,t,i,a){return this.application.data.getUploaderConfig(this.imageAttachUrl(e,t,i),a,{nonessential:!1})},imageAttachUploader:function(e,t,i,a){return this.application.data.getUploader(this.imageAttachUrl(e,t,i),a,{essential:!1})},audioAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/audioattach",{auth:i})},subtitleAttachUrl:function(e,t,i){return this.application.urls.httpApiResourceUrl("/videos/"+e+"/streams/"+t+"/subtitleattach",{auth:i})},audioAttachUploaderConfig:function(e,t,i,a){return this.application.data.getUploaderConfig(this.audioAttachUrl(e,t,i),a)},subtitleAttachUploaderUrl:function(e,t,i){return this.subtitleAttachUrl(e,t,i)},audioAttachUploader:function(e,t,i,a){return this.application.data.getUploader(this.audioAttachUrl(e,t,i),a)},webrtcStreamName:function(e,t,i){return"applications___"+this.application.data.get("token")+"___videos___"+e+"___streams___"+t+"___video"},dataUploader:function(e,t,i){var a=new s;return i.video_data&&a.addUploader(this.videoAttachUploader(e,t,i.auth,i.video_data)),i.audio_data&&a.addUploader(this.audioAttachUploader(e,t,i.auth,i.audio_data)),i.image_data&&a.addUploader(this.imageAttachUploader(e,t,i.auth,i.image_data)),a},signedDataUploader:function(e,t,i){var a=new s;return i.video_data&&a.addUploader(this.application.data.getSignedUploader(i.url_data.url,i.url_data.fields,i.video_data)),i.audio_data&&a.addUploader(this.application.data.getSignedUploader(i.audio_url_data.url,i.audio_url_data.fields,i.audio_data)),i.image_data&&a.addUploader(this.application.data.getSignedUploader(i.image_url_data.url,i.image_url_data.fields,i.image_data)),a}}}])}),e.define("private:Application.Urls",["base:Class","base:Objs","base:Sort","base:Types","base:Comparators","base:Net.Uri","base:Async","browser:Info","media:WebRTC.RecorderWrapper","private:Environment"],function(e,i,a,t,s,n,r,o,c,d,l){return e.extend({scoped:l},function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__servers=d.serversByToken(this.application.data.get("token"))},httpApiBaseUrl:function(){return(d.sslRequired?"https":"http")+"://"+this.__servers["embed.api.server.public.domain"]},httpStreamingBaseUrl:function(){return(d.sslRequired?"https":"http")+"://"+this.__servers["embed-cdn.api.server.public.domain"]},apiStreamingBaseUrl:function(){return(d.sslRequired?"https":"http")+"://"+this.__servers["media-cdn.api.server.public.domain"]},webrtcStreamingApp:function(e){return this.__servers["wowza.api.record.webrtc.app"]+(e||"")},wssUrl:function(){return this.__servers["wowza.api.record.webrtc.wssurl"]},webrtcAudioStreamingApp:function(e){return this.__servers["wowza.api.record.webrtc.audioapp"]+(e||"")},httpApiAppUrl:function(){return this.httpApiBaseUrl()+"/v1/applications/"+this.application.data.get("token")},apiBaseUrl:function(){return(d.isLocal?"http":"https")+"://"+this.__servers["server.js-api.server.public.domain"]},apiAppUrl:function(){return this.apiBaseUrl()+"/embed/v1/applications/"+this.application.data.get("token")},apiResourceUrl:function(e,t){return this.resourceUrl(this.apiAppUrl(),e,i.extend({auth:!0},t))},httpApiResourceUrl:function(e,t){return this.resourceUrl(this.httpApiAppUrl(),e,i.extend({auth:!0},t))},httpStreamingAppUrl:function(){return this.httpStreamingBaseUrl()+"/v1/applications/"+this.application.data.get("token")},httpStreamingResourceUrl:function(e,t){return this.resourceUrl(this.httpStreamingAppUrl(),e,t)},apiStreamingAppUrl:function(){return this.apiStreamingBaseUrl()+"/v1/applications/"+this.application.data.get("token")},apiStreamingResourceUrl:function(e,t){return this.resourceUrl(this.apiStreamingAppUrl(),e,t)},urlParams:function(e){var t=i.extend({},i.filter((e=e||{}).params,function(e,t){return null!==e&&""!==e}));return e.auth&&this.application.data.get("auth")&&((t=i.extend(t,i.filter(e.auth,function(e,t){return null!==e&&""!==e})))[this.application.data.get("cookie_key")]=this.application.data.get("cookie_value")),a.sort_object(t,s.byValue)},hostedBaseUrl:function(){return(d.sslRequired?"https":"http")+"://"+this.__servers["hosted.pages.server.public.domain"]},hostedUrl:function(e){return this.hostedBaseUrl()+e},resourceUrl:function(e,t,i){return n.appendUriParams(e+(t&&0!==t.indexOf("/")?"/":"")+t,this.urlParams(i))},liveCallsSignUrl:function(e){return this.apiResourceUrl("",e)+"/live-calls-sign-request"}}})}),e.define("private:Application.VideoCalls",["base:Class","private:Application.VideoCallsApiMixin"],function(e,t,i){return e.extend({scoped:i},[t,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e}}}])}),e.define("private:Application.Videos",["base:Class","base:Promise","base:Objs","base:Time","base:Async","base:Types","base:Net.HttpHeader","base:Ids","base:Comparators","private:Application.VideosApiMixin"],function(e,s,c,d,l,u,t,n,h,i,a){return e.extend({scoped:a},[i,function(t){return{constructor:function(e){t.constructor.call(this),this.application=e,this.__cache={}},imageUrl:function(e,t){return this.application.urls.httpStreamingResourceUrl("videos/"+e+"/image",{auth:(t=t||{}).auth,params:c.extend({refresh:this.refreshToken(e)},t.params)})},publicVideoUrl:function(e){return this.application.urls.hostedUrl("/v/"+e)},iframeVideoUrl:function(e){return this.application.urls.hostedUrl("/p/"+e)},iframeRecorderUrl:function(){return this.application.urls.hostedUrl("/r/"+this.application.data.get("token"))},videoUrl:function(e,t){return this.application.urls.httpStreamingResourceUrl("videos/"+e+"/video.mp4",{auth:(t=t||{}).auth,params:c.extend({refresh:this.refreshToken(e),download:!!t.download||null},t.params)})},refreshToken:function(e){try{var t=this.cache(e,{weak:!0}).value();return t&&t.submission_date!==t.resubmission_date?86400<d.now()/1e3-t.resubmission_date?null:t.resubmission_date:null}catch(i){return null}},__cacheGet:function(e){return this.__cache[e]||(this.__cache[e]={ready:!1,data:null,error:null,last_update:null,auth:null,next_update:null,next_update_timer:null,updating:!1,promises:[],watchers:{}}),this.__cache[e]},__cacheUpdate:function(r,e){var t,o=this.__cacheGet(r);o.updating||o.next_update&&o.next_update<=e||(o.next_update&&(l.clearEventually(o.next_update_timer),o.next_update=null),(t=d.now())<e?(o.next_update=e,o.next_update_timer=l.eventually(function(){this.__cacheUpdate(r)},this,e-t)):(o.updating=!0,this.get(r,o.auth).callback(function(t,i){o.ready=!0,o.updating=!1;var e=d.now(),a=o.last_update?e-o.last_update:null,s=(o.last_update=e,o.next_update=null,o.data),n=t;o.data=i,o.error=t,l.clearEventually(o.next_update_timer),c.iter(o.promises,function(e){e.asyncCallback(t,i)},this),o.promises=[],u.is_empty(o.watchers)||((!t||t.equals(n))&&h.deepEqual(i,s,10)||c.iter(o.watchers,function(e){e.callback.call(e.context,t,i)},this),null===a?c.iter(o.watchers,function(e){e.weak||(a=null===a?e.initialage:Math.min(e.initialage,a))},this):a*=2,null!==a&&(c.iter(o.watchers,function(e){!e.weak&&e.maxage&&(a=Math.min(a,e.maxage))},this),this.__cacheUpdate(r,e+a)))},this)))},cacheInvalidate:function(e){this.__cacheGet(e).ready=!1},cache:function(e,t){var i=this.__cacheGet(e);if((t=c.extend({auth:null,weak:!1,force:!1,age:null},t)).weak&&!i.ready)return s.error(!0);if(i.ready&&!t.force&&(!t.age||now-i.last_update<t.age))return i.data?s.value(i.data):s.error(i.error);t.auth&&(i.auth=t.auth);t=s.create();return i.promises.push(t),this.__cacheUpdate(e),t},watch:function(e,t,i,a){var s=this.__cacheGet(e);(t=c.extend({auth:null,weak:!1,maxage:null,initialage:1e3},t)).auth&&(s.auth=t.auth),s.watchers[n.objectId(a)]={context:a,callback:i,weak:t.weak,maxage:t.maxage,age:t.initialage},t.weak||this.__cacheUpdate(e,t.initialage+d.now())},unwatch:function(e,t){delete this.__cacheGet(e).watchers[n.objectId(t)]},createByUpload:function(a){return this._create(c.extend(c.clone(a.data,1),{create_stream:!0,image_url:!!a.image_data,audio_url:!!a.audio_data}),a.auth,5).mapSuccess(function(e){var t=s.create(),i=this.application.streams.signedDataUploader(e.video.token,e.stream.token,{auth:a.auth,video_data:a.video_data,audio_data:a.audio_data,image_data:a.image_data,url_data:e.url_data});return a.progress&&i.on("progress",a.progress,a.context),i.on("error",function(e){t.asyncError(e)},this),i.on("success",function(){this.application.streams._confirm(e.video.token,e.stream.token,{},a.auth,50).forwardCallback(t)},this),i.upload(),t},this)}}}])}),e.define("module:Config",["private:Environment","base:Properties.Properties","base:Functions"],function(e,t,i){t=new t;return{set:i.as_method(t.set,t),get:i.as_method(t.get,t)}}),e.define("module:Device",["base:Events.Events","base:Functions","base:Async","base:Promise","media:Recorder.WebRTCVideoRecorderWrapper","media:WebRTC.Support","browser:Info","private:Core"],function(e,t,i,a,s,n,r,o){var c=function(e,t){try{return e()}catch(i){return t||!1}},d=new e,l={info:c(function(){return{location:document.location.href,userAgent:navigator.userAgent,device:r.formatDevice(),os:r.formatOS(),browser:r.formatBrowser(),version:r.formatBrowserVersion(),revision:o.revision}},{}),on:t.as_method(d.on,d),webrtc:c(function(){return s.supported({})}),cameras:null,microphones:null,camera_count:null,microphone_count:null},u=function(){l.devices=null,d.persistentTrigger("device_error")};return l.media=function(){if("devices"in l)return l.devices?a.value(l.devices):a.error("failed");var t=a.create();try{n.enumerateMediaSources().success(function(e){t.asyncSuccess(e),l.devices=e=e,l.cameras=e.video,l.microphones=e.audio,l.camera_count=e.videoCount,l.microphone_count=e.audioCount,d.persistentTrigger("device_info",l.cameras,l.microphones,l.camera_count,l.microphone_count),d.persistentTrigger(0<l.camera_count?"has_camera":"no_camera"),d.persistentTrigger(0<l.microphone_count?"has_microphone":"no_microphone")}).error(function(){t.asyncError("failed"),u()})}catch(e){t.asyncError("failed"),u()}return t},l}),e.define("private:Environment",["private:Logger","private:Core","browser:Info","browser:Loader","base:Objs","base:Types","base:Net.Uri"],function(e,t,i,a,s,n,r){t.revision.prerelease&&e.warn("You are currently using a prerelease version of the Ziggeo JS SDK. We suggest using the stable revision for production use, and prereleases for staging environments and tests only.");var o=!!window.ZiggeoLocal||!!window.ZiggeoWeb&&-1===location.hostname.indexOf("ziggeo.com"),c=!1;o||(c=!0);try{0!==location.protocol.indexOf("file")||i.isCordova()||e.warn("In order to use Ziggeo's recording technology, this page needs to be served via https. The file:// protocol is not supported. For more details contact us at support@ziggeo.com")}catch(w){}try{0===location.protocol.indexOf("https")?window.location!==window.parent.location&&0===document.referrer.indexOf("https")&&e.warn("Accessing the camera and the microphone on insecure origins (HTTP) is deprecated, and future browser versions will stop to support insecure origins. We highly recommend upgrading to SSL (HTTPS). For more details contact us at support@ziggeo.com"):0===location.protocol.indexOf("http")&&e.warn("Accessing the camera and the microphone on insecure origins (HTTP) is deprecated, and future browser versions will stop to support insecure origins. We highly recommend upgrading to SSL (HTTPS). For more details contact us at support@ziggeo.com")}catch(w){}var i=!o,e=o||!!window.ZiggeoDev||!!window.ZiggeoWeb&&i&&-1!==location.hostname.indexOf("dev"),d=!e,l=o?"local":d?"production":"development",u=s.clone(t.servers[l],1),h={};if(d&&(h.cdn=u["assets.api.server.public.domain"].replace("assets.","assets-cdn.")),h.normal=u["assets.api.server.public.domain"],o)try{window.location.hostname&&/^\d+\.\d+\.\d+\.\d+$/.test(window.location.hostname)&&(u=s.map(u,function(e){return n.is_string(e)?e.replace("localhost",window.location.hostname):e}),h.local=u["assets.api.server.public.domain"])}catch(w){}var p,g=u["assets.api.server.public.domain"],m="/v"+t.revision.version+"-r"+t.revision.revision+"/",_=c?"https":"http",f=null;for(p in h)try{var v=h[p],y=a.findScript(v);if(y&&-1!==y.src.indexOf("ziggeo.js")){var b=r.parse(y.src),_=c?"https":b.protocol,g=b.host;b.port&&(g+=":"+b.port),m=b.directory;break}}catch(w){}return{isLocal:o,isServer:i,isDevelopment:e,isProduction:d,environment:l,serverEnvironments:t.servers,servers:u,serversByToken:function(t){var i=s.clone(u,-1);return s.iter(u.regions,function(e){0===t.indexOf(e.prefix)&&(i=s.extend(i,e))}),i},assetsDomain:g,assetsPath:m,assetsBase:f=f||_+"://"+g+m,sslRequired:c}}),e.define("module:Locale",["base:Classes.LocaleAggregator","base:Classes.LocaleTable","browser:Info","mediacomponents:Assets"],function(e,t,i,a){var s=new e,e=new t;return s.register(e),s.register(a.strings),s.setWeakLocale(i.language()),{setLocale:function(e){s.setLocale(e)},mainLocale:e,mediaLocale:a.strings}}),e.define("private:Logger",[],function(){return{__console:function(e,t){try{console&&console[e]&&console[e].apply(console,t)}catch(i){}return this},warn:function(){return this.__console("warn",arguments)},log:function(){return this.__console("log",arguments)}}}),e.define("module:Ads",["mediacomponents:Ads.AdSenseVideoAdProvider","mediacomponents:Ads.VastVideoAdProvider"],function(e,t){return{AdSenseVideoAdProvider:e,VastVideoAdProvider:t}}),e.define("private:S3.Config",[],function(){return{chunkSize:5242880,numberOfUrlsPerRequest:1e3,minNumberOfUrls:5}}),e.define("private:S3.MediaUploader",["base:Maths","base:Objs","browser:Upload.FileUploader","browser:Upload.MultiUploader","browser:Upload.S3MultipartSupport","private:S3.Config"],function(i,a,s,n,e,r,t){return s.extend({scoped:t},function(t){return{constructor:function(e){t.constructor.call(this,e),this._chunks=[],this._chunksSize=0,this._currentPartNumber=1,this._parts=[],this._urls={},this._multiUploader=this.auto_destroy(new n({uploadLimit:this._options.uploadLimit}))},reset:function(){t.reset.call(this),this._chunks=[],this._chunksSize=0,this._currentPartNumber=1,this._parts=[],this._urls={},this._multiUploader.destroy(),this._multiUploader=this.auto_destroy(new n({uploadLimit:this._options.uploadLimit}))},getUploadId:function(){return this.uploadId||this._options.uploadId},setUploadId:function(e){this.uploadId=e},getUploadUrls:function(e){return e=e||i.range(this._currentPartNumber,this._currentPartNumber+r.numberOfUrlsPerRequest),this.getUploadUrlsPromise(e.toString()).mapSuccess(function(e){this.getUploadId()||this.setUploadId(e.url_data.uploadId),this._urls=a.extend(this._urls,e.url_data.urls)},this)},getUploadUrlsPromise:function(e){return this._uploadUrlsPromise(e)},setUploadUrlsPromise:function(e){this._uploadUrlsPromise=e},_upload:function(){this._multiUploader.on("error",this._errorCallback,this).on("progress",this._progressCallback,this).on("success",function(){this._successCallback(0<this._parts.length?e.sortParts(this._parts):undefined)},this),this._multiUploader.upload()},upload:function(e){if(e&&(this._chunks.push(e),this._chunksSize+=e.size),0<this._chunksSize&&(this._chunksSize>=r.chunkSize||!e)&&this.uploadChunk(new Blob(this._chunks,{type:this._chunks[0].type})),!e)return t.upload.call(this)},_shouldRequestNewUrls:function(){return a.count(this._urls)-this._currentPartNumber===r.minNumberOfUrls},uploadChunk:function(e){this._shouldRequestNewUrls()&&this.getUploadUrls();var i=this._currentPartNumber,e=this._multiUploader.auto_destroy(s.create({method:"PUT",url:this._urls[this._currentPartNumber],source:e,resilience:this._options.resilience,noFormData:!0}));this._multiUploader.addUploader(e),e.on("success",function(e,t){this._parts.push({ETag:JSON.parse(t.getResponseHeader("ETag")),PartNumber:i})},this),e.upload(),this._chunks=[],this._chunksSize=0,this._currentPartNumber++}}})}),e.define("module:Supplementary",["base:Async"],function(s){return{eventInvokeCallback:function(e,t,i){try{e.apply(t,i)}catch(a){s.eventually(function(){throw console.warn(a,e,t,i),a})}}}}),e.define("module:AudioPlayer",["mediacomponents:AudioPlayer.Dynamics.Player","private:Logger","module:Application","base:Types","module:AudioPlayerStates.Initial","module:AudioPlayerStates","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Timers.Timer","base:Promise","base:TimeFormat","private:ZiggeoDynamicMixin"],function(e,i,t,a,s,n,r,o,c,d,l,u,h,p,g,m){return e.extend({scoped:m},[g,function(e){return{attrs:{"client-auth":null,"server-auth":null,"intermediate-token":null,audio:null,stream:null,application:null,cache:!1,forcerefresh:!1,pauseonplay:!1,"use-cache":!1},types:{playlist:"array",cache:"bool",pauseonplay:"bool","use-cache":"bool","lazy-application":"bool"},loadDataFromCache:function(){(this.get("use-cache")||this.get("usecache"))&&this.application.cache.read(this.get("audio"),this.getMediaType()).success(function(e){e.data&&this.set("audio_data",e.data),e.audioFile&&this.set("source",e.audioFile)}.bind(this))},create:function(){if(this.loadDataFromCache(),this._invokeCallback=c.eventInvokeCallback,this.get("source")||0<this.get("sources").length)return e.create.call(this);this.set("ready",!1),this.__playlist=this.get("playlist"),this.set("playlist",null),e.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.set("audio_status",null)},_initialState:s,_notifications:{_activate:"_createWithApplication"},_trackProcessing:function(){this.__tempa=this.get("audio"),this.application.audios.watch(this.__tempa,{auth:this.get("auth"),maxage:2500},this.__audioUpdate,this),this.set("start-processing-time",l.now()),this._track("audio_processing_start"),this._processingTimer=this.auto_destroy(new u({delay:100,context:this,fire:function(){var e=1e3,e=(this.get("duration")&&1e3<this.get("duration")/60*1e3&&(e=this.get("duration")/60*1e3),(l.now()-this.get("start-processing-time"))/e),e=1-1/(1+Math.sqrt(Math.sqrt(e)));(this.parent()?this.parent():this).trigger("processing",e)}}))},_stopTrackingProcessing:function(){this._processingTimer.destroy(),this.application.audios.unwatch(this.__tempa,this),this.set("end-processing-time",l.now()),this._track("audio_processing_end",{media_time:this.get("end-processing-time")-this.get("start-processing-time")}),(this.parent()?this.parent():this).trigger("processed")},_audioWasProcessing:function(){return!!this._processingTimer},_createWithApplication:function(){var e,t;this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.__playlist&&(this.set("playlist",this.__playlist.map(function(e){return this.__sourceByAudio(e)},this)),e=this.get("playlist")[0],this.set("source",e.source),this.set("audio",e.token),this.on("playlist-next",function(e){this.set("audio",e.token)},this)),t=this.parent()&&this.parent().record!==undefined&&this.parent().host!==undefined,this.listenOn(this.application,"ready",function(){this.application.authAudioReady(this.get("auth"),this.get("audio")).callback(function(){this.set("application_status",!0),this.get("playlist")?(this.__setAudioSources(),this.set("ready",!0)):t?this.application.audios.get(this.get("audio"),{auth:this.get("auth")}).callback(function(e,t){this.get("localplayback")&&this.parent()&&this.parent().once("verified",function(){this.destroyed()||this._trackProcessing()},this),this.get("source")||this.__setAudioSources(),t&&4===t.state&&!this.get("localplayback")&&this.state().next("AudioProcessing"),this.set("ready",!0)},this):(this.get("source")||this.__setAudioSources(),this.set("ready",!0)),this._track("embedding_loaded")},this)},this).listenOn(this.application,"error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.get("pauseonplay")&&this.application.embed_events.on("playing",function(e){e!==this&&this.get("playing")&&this.execute("pause")},this),this.set("tracktags",this.application.data.get("track_tags"))):i.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):i.warn("No application (token) defined. We need an application (token) to include an embedding.")},destroy:function(){this.application.embed_events.off(null,null,this),e.destroy.call(this)},events:{"change:audio":function(){var e;this.host&&(this.set("stream",null),e=0<=this.host.state().state_name().indexOf("Error"),this.__setAudioSources(),e)&&this.host.next("Initial")},paused:function(){this._track("audio_play_pause",{media_time:this.get("position")})},playing:function(){this._track("audio_play_playing",{media_time:this.get("position")})},ended:function(){this._track("audio_play_end",{media_time:this.get("duration")})},seek:function(e){this._track("audio_play_seek",{media_time:e})}},__setAudioSources:function(){this.get("audio")&&this.get("application_status")&&(this.get("stream")||this.set("refresh_token",this.application.audios.refreshToken(this.get("audio"))),this.__setSources(),this.application.audios.cache(this.get("audio"),{auth:this.get("auth")}).callback(this.__audioUpdate,this),this.get("ready"))&&this.reattachAudio()},__sourceByAudio:function(t,e){var i,a,s,n,r,o=this.get("audio_data"),c=(o&&o.duration&&this.set("duration",o.duration),d.filter(o&&o.streams?o.streams:[],function(e){return(e.token===o.original_stream.token||e.parent_stream===o.original_stream.token)&&5===e.state&&3===e.streamable},this));return this.get("playlist")&&(c=[],e=null),e||c.length<2?(i=e?this.application.audio_streams:this.application.audios,a=[t],e&&a.push(e),a.push({auth:this.get("auth"),params:{force_refresh:this.get("forcerefresh")}}),{source:i.audioUrl.apply(i,a),token:t}):(s=[],n=[],r={force_refresh:this.get("forcerefresh"),auth:this.get("auth")},d.iter(c,function(e){s.push({src:this.application.audio_streams.audioUrl(t,e.token,r),token:e.token}),n.push({filter:{token:e.token}})},this),{source:null,sources:s,streams:n,currentstream:n[0],token:t})},__setSources:function(){this.setAll(this.__sourceByAudio(this.get("audio"),this.get("stream")))},__audioUpdate:function(e,t){this.destroyed()||(e?(this.set("audio_status",!1),e.status_code()===r.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("audio-not-found")}):e.status_code()===r.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("audio-access-forbidden")}):this.state().next("LoadError")):(this.set("audio_data",t),this.get("title")||this.set("title",t.title),this.set("totalduration",t.duration),!1!==t.approved||this.get("intermediate-token")?t.state<4?this.state().next("FatalError",{message:this.string("audio-unknown-error")}):(this.set("audio_status",!0),4!==t.state||this.get("localplayback")?(this._audioWasProcessing()&&this._stopTrackingProcessing(),"AudioProcessing"===this.state().state_name()?(this.set("refresh_token",this.application.audios.refreshToken(this.get("audio"))),this.set("forcerefresh",l.now()),this.__setSources(),this.state().next("LoadPlayer")):this.get("stream")||this.get("refresh_token")||!this.application.audios.refreshToken(this.get("audio"))?this.__setSources():(this.set("refresh_token",this.application.audios.refreshToken(this.get("audio"))),this.__setSources(),this.state().next("LoadPlayer"))):"AudioProcessing"!==this.state().state_name()&&this.state().next("AudioProcessing")):this.state().next("FatalError",{message:t.moderation_reason||this.string("audio-rejected")})))},_track:function(e,t,i){var a,s;this.application&&(a=l.now(),(s=h.create()).success(function(){this.application.analytics.track("2",e,{audio_token:this.get("audio_data").token,stream_token:this.get("stream")?this.get("stream"):undefined},d.extend({embed_type:"player"},t),d.extend({duration:this.get("audio_data").duration||this.get("duration"),tags:this.get("audio_data").tags},i),a)},this),this.get("audio_data")?s.asyncSuccess():this.once("change:audio_data",function(){s.asyncSuccess()},this))}}}],function(e){return{playerStates:function(){return e.playerStates.call(this).concat([n])}}}).register("ba-ziggeoaudioplayer").register("ziggeoaudioplayer").attachStringTable(o.mainLocale).addStrings({"audio-not-found":"We could not find the specified audio file.","audio-access-forbidden":"You are not permitted to access this audio file.","audio-unknown-error":"We cannot access this audio at the moment. Please try again later.","audio-rejected":"The audio has been rejected.","audio-processing":"The audio is processing - stay tuned.","audio-access-error":"The audio is currently under moderation. You may click to retry."})}),e.define("module:PopupAudioPlayer",["module:AudioPlayer","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),e.define("module:AudioPlayerStates.Initial",["mediacomponents:AudioPlayer.Dynamics.PlayerStates.Initial"],function(e,t){return e.extend({scoped:t},function(e){return{dynamics:["loader"],_started:function(){this.dyn.get("audio_data")&&4===this.dyn.get("audio_data").state?this.next("AudioProcessing"):e._started.call(this)}}})}),e.define("module:AudioPlayerStates.AudioProcessing",["mediacomponents:AudioPlayer.Dynamics.PlayerStates.State"],function(e,t){return e.extend({scoped:t},function(e){return{dynamics:["loader","message"],_started:function(){this.dyn.set("message",this.dyn.string("audio-processing")),this.__shareaudio=this.dyn.get("shareaudio"),this.dyn.set("shareaudio",[]),this.dyn._trackProcessing()},_end:function(){this.dyn.set("shareaudio",this.__shareaudio),e._end.call(this)}}})}),e.define("module:AudioPlayerStates.LoadAudio",["mediacomponents:AudioPlayer.Dynamics.PlayerStates.LoadAudio"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){this.dyn.loadDataFromCache(),e._started.call(this)}}})}),e.define("module:AudioPlayerStates.PlayAudio",["mediacomponents:AudioPlayer.Dynamics.PlayerStates.PlayAudio"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("audio_play_start")}}})}),e.define("module:AudioRecorder",["mediacomponents:AudioRecorder.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","module:AudioRecorderStates","base:Types","base:MediaTypes","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info","private:ZiggeoDynamicMixin"],function(e,i,a,s,t,n,r,o,c,d,l,u,h,p,g,m,_,f,v){return e.extend({scoped:v},[f,function(t){return{template:t.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynaudioplayer:"ziggeoaudioplayer","audio-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,audio:null,description:null,title:null,tags:null,"custom-data":null,key:null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"input-bind":null,"form-accept":null,cache:!1,playermodeifexists:!1,rerecordableifexists:!1},types:{tags:"array","custom-data":"object","expiration-days":"int",cache:"bool","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()})}},create:function(){this._invokeCallback=u.eventInvokeCallback,this.set("ready",!1),t.create.call(this),this.get("audio")&&(!this.get("key")&&d.starts_with(this.get("audio"),"_")?this.set("key",d.strip_start(this.get("audio"),"_")):this.set("token",this.get("audio"))),this.get("simulate")&&this.set("localplayback",!0),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialaudio=!!this.get("audio"),this.get("audio")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new m),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.scopes.player.on("change:audio_data",function(e){this.set("audio_data",e);e=e.streams.find(function(e){return e.token===this.get("stream")},this);e&&this.set("stream_data",e)},this)},_notifications:{_activate:"_createWithApplication"},_deferActivate:function(){var t;return this._obtainApplication(),!!(!this.application&&this.get("lazy-application")||this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(t=p.create(),this.application?t.asyncSuccess(!0):i.events.once("set-default",function(e){this.application=e,t.asyncSuccess(!0)},this),(t=this.get("playermodeifexists")||this.get("rerecordableifexists")?t.mapSuccess(function(t){return this.application.audios.get(this.get("audio")||(this.get("key")?"_"+this.get("key"):null),{auth:this.get("auth")}).success(function(e){return e&&"EMPTY"!==e.state_string&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1)),!this.get("audio")&&this.get("key")&&this.set("audio","_"+this.get("key")),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),t},this)},this).mapError(function(e){return this.get("audio")&&404===e.status_code()&&this.set("audio",null),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),p.value(!0)},this):t).success(this.activate,this),!0)},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.set("playerattrs",{application:this.application,"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),audio:this.get("audio"),"force-refresh":c.now()}),this._track("audio_embedding_loaded"),this.set("webrtcstreaming",this.application.data.get("webrtc_streaming")),this.set("webrtcstreamingifnecessary",this.application.data.get("webrtc_streaming_if_necessary")),this.set("webrtconmobile",this.application.data.get("webrtc_on_mobile")),_.isSafari()&&_.isDesktop()&&!this.get("webrtcstreaming")&&!this.get("webrtcstreamingifnecessary")&&this.set("webrtcstreamingifnecessary",!0),!this.get("webrtcstreaming")&&!this.get("webrtcstreamingifnecessary")||this.get("timeminlimit")||this.set("timeminlimit",5),this._updateUrls()):s.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):s.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(e,t,i){this.application.analytics.track("2",e,{audio_token:this.get("audio"),stream_token:this.get("stream")},h.extend({embed_type:this.__hadInitialaudio?"rerecorder":"recorder"},t),h.extend({creation_type:this.get("creation-type"),duration:this.get("duration"),tags:this.get("tags")},i))},functions:{reset:function(){this.get("audio")&&!this.__hadInitialaudio&&this.set("audio",null),t.functions.reset.call(this)}},_updateUrls:function(e){this.set("playerattrs.audio",this.get("audio")),this.set("uploadoptions",{webrtcStreaming:{wssUrl:this.get("webrtcstreaming")||this.get("webrtcstreamingifnecessary")?this.application.urls.wssUrl():undefined,streamInfo:this.get("webrtcstreaming")||this.get("webrtcstreamingifnecessary")?{applicationName:this.application.urls.webrtcStreamingApp(_.isFirefox()?"udp":""),streamName:this.application.streams.webrtcStreamName(this.get("audio"),this.get("stream"),this.get("auth"))}:undefined,delay:4750,stopDelay:2750},audio:e?h.extend({resilienceCheck:function(e){return!e||!e.duration}},this.application.data.getSignedUploaderConfig(e.url,e.fields)):undefined})},__createParams:function(){var e={};try{var t=this.activeElement().cloneNode();t.innerHTML="",e=t.outerHTML}catch(i){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):undefined,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):undefined,key:this.get("key"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),force_overwrite:this.get("force-overwrite"),audio_profile:this.get("audio-profile"),meta_profile:this.get("meta-profile"),enforce_duration:this.get("enforce-duration"),recover_streams:this.get("recover-streams"),max_duration:this.get("timelimit"),user_language:navigator.language||navigator.userLanguage,audio_file_name:this._audioFileName,device_info:h.extend({api_version:2,embed_code:e,media_source:this.__getMediaSource(),capture_type:this.__getCaptureType()},a.info)}},__recordingTypeParams:function(){var e={create_stream:!0};if(this.recorder){try{var t=this.recorder._recorder._recorder._mediaRecorder.mimeType;t&&h.extend(e,{audio_type:o.getExtension(t)})}catch(i){}return h.extend(e,{webrtc_recording:!0,webrtc_streaming:this.isWebrtcStreaming()})}return this._audioFile&&h.extend(e,{audio_type:d.last_after(this._audioFile.name,".")}),e},__getMediaSource:function(){return this.__recordingTypeParams().webrtc_recording?"record":"upload"},__getCaptureType:function(){var e=this.__recordingTypeParams();return e.webrtc_streaming?"webrtc_streaming":e.webrtc_recording?"webrtc":"file_capture"},_prepareRecording:function(){return this.get("audio")?this.application.audio_streams.create(this.get("audio"),this.__recordingTypeParams(),this.get("auth"),5).mapSuccess(function(e){this.set("token",e.audio.token),this.set("audio_data",e.audio),this.set("stream",e.audio_stream.token),this.set("stream_data",e.audio_stream),this._updateUrls(e.url_data)},this):this.application.audios.create(h.extend(this.__createParams(),this.__recordingTypeParams()),this.get("auth"),5).mapSuccess(function(e){this.set("token",e.audio.token),this.set("audio",e.audio.token),this.set("audio_data",e.audio),this.set("stream",e.audio_stream.token),this.set("stream_data",e.audio_stream),this._updateUrls(e.url_data)},this)},_verifyRecording:function(){var e=p.create();return g.eventually(function(){this.get("audio")&&(this.get("simulate")?p.value(!0):this.application.audio_streams.confirm(this.get("audio"),this.get("stream"),{},this.get("auth"),50)).success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("audio")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.audios.cacheInvalidate(this.get("audio"))},this).forwardCallback(e)},this,2500),e},_afterActivate:function(e){t._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),e.parentElement.appendChild(this.__inputBindElement)),this.get("audio"))&&(this.__inputBindElement.value=this.get("audio"))}}}],function(e){return{recorderStates:function(){return e.recorderStates.call(this).concat([n])}}}).register("ba-ziggeoaudiorecorder").register("ziggeoaudiorecorder").registerFunctions({testing:function(e){return e.testing}}).attachStringTable(l.mainLocale).addStrings({})}),e.define("module:PopupAudioRecorder",["module:AudioRecorder","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),e.define("module:AudioRecorderStates.Recording",["mediacomponents:AudioRecorder.Dynamics.RecorderStates.Recording"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("audio_record_start")},_hasStopped:function(){e._hasStopped.call(this),this.dyn._track("audio_record_end",{media_time:this.dyn.get("duration")})}}})}),e.define("module:AudioRecorderStates.Chooser",["mediacomponents:AudioRecorder.Dynamics.RecorderStates.Chooser"],function(e,t){return e.extend({scoped:t},function(t){return{_uploadFile:function(e){t._uploadFile.call(this,e),this.dyn._track("audio_upload_start",{data_size:e.size})}}})}),e.define("module:AudioRecorderStates.Uploading",["mediacomponents:AudioRecorder.Dynamics.RecorderStates.Uploading","base:Time"],function(e,i,t){return e.extend({scoped:t},function(t){return{_started:function(){var e;this.dyn.get("cache")&&(e={data:this.dyn.get("audio_data"),audioFile:this.dyn.getAudioFile()},this.dyn.get("token")&&this.dyn.application.cache.store(this.dyn.get("token"),e,this.dyn.getMediaType()),this.dyn.get("key")&&this.dyn.application.cache.store("_"+this.dyn.get("key"),e,this.dyn.getMediaType()),this.dyn.setProp("playerattrs.cache",!0),this.dyn.setProp("playerattrs.use-cache",!0)),t._started.call(this),this.dyn._track("audio_uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){t._finished.call(this),this.dyn._track("audio_uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",i.now())}}})}),e.define("private:Dynamics",["dynamics:DomObserver","dynamics:Parser","dynamics:Registries","base:Async","browser:Dom","module:Application"],function(e,t,i,a,s,n){t.secureMode=!0;var r=new e({allowed_dynamics:["ziggeoplayer","ziggeorecorder","ziggeoaudioplayer","ziggeoaudiorecorder","ziggeoimageviewer","ziggeoimagecapture","ziggeoiframeplayer","ziggeoiframerecorder","ziggeovideocall"],enabled:!(i.prefixes.ziggeo=!0)}),o="active";return["lazy","manual","once"].includes(window.ZiggeoObserverConfig)&&(o=window.ZiggeoObserverConfig),window.ZiggeoObserverConfig&&window.ZiggeoDefer&&console.warn("You are using both ZiggeoObserverConfig and ZiggeoDefer together. In most cases you do not want to do that and instead want to use ZiggeoObserverConfig only. Feel free to reach out to our support team at support@ziggeo.com for more info."),s.ready(function(){a.eventually(function(){n.onUndefer(function(){r.enable(),"once"===o&&r.disable()})})}),{domObserver:r}}),e.define("private:ZiggeoDynamicMixin",["module:Application","base:Types"],function(e,t){return{_obtainApplication:function(){this.get("application")&&(this.application=t.is_string(this.get("application"))?e.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||e.getDefault()},_deferActivate:function(){return this._obtainApplication(),!(this.application||!this.get("lazy-application")||(e.events.once("set-default",function(e){this.application=e,this.activate()},this),0))}}}),e.define("module:ImageCapture",["mediacomponents:ImageCapture.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","module:ImageRecorderStates","base:Types","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info","private:ZiggeoDynamicMixin"],function(e,i,a,s,t,n,r,o,c,d,l,u,h,p,g,m,_,f){return e.extend({scoped:f},[_,function(t){return{template:t.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynimageviewer:"ziggeoimageviewer","effect-profile":null,"preview-effect-profile":null,"image-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,image:null,description:null,title:null,tags:null,"custom-data":null,key:null,"auto-crop":null,"auto-pad":null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"input-bind":null,"form-accept":null,cache:!1,playermodeifexists:!1,rerecordableifexists:!1,"use-cache":!1},types:{tags:"array","custom-data":"object","auto-crop":"bool","auto-pad":"bool",cache:"bool","expiration-days":"int","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","effect-profile":"array","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool","use-cache":"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()})}},create:function(){this._invokeCallback=l.eventInvokeCallback,this.set("ready",!1),t.create.call(this),this.get("image")&&(!this.get("key")&&c.starts_with(this.get("image"),"_")?this.set("key",c.strip_start(this.get("image"),"_")):this.set("token",this.get("image"))),this.get("simulate")&&this.set("localplayback",!0),r.is_string(this.get("effect-profile"))&&this.set("effect-profile",r.parseArray(this.get("effect-profile"))),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialimage=!!this.get("image"),this.get("image")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new g),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.scopes.player.on("change:image_data",function(e){this.set("image_data",e);e=e.streams.find(function(e){return e.token===this.get("stream")},this);e&&this.set("stream_data",e)},this)},_notifications:{_activate:"_createWithApplication"},_deferActivate:function(){var t;return this._obtainApplication(),!!(!this.application&&this.get("lazy-application")||this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(t=h.create(),this.application?t.asyncSuccess(!0):i.events.once("set-default",function(e){this.application=e,t.asyncSuccess(!0)},this),(t=this.get("playermodeifexists")||this.get("rerecordableifexists")?t.mapSuccess(function(t){return this.application.images.get(this.get("image")||(this.get("key")?"_"+this.get("key"):null),{auth:this.get("auth")}).success(function(e){return e&&"EMPTY"!==e.state_string&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1)),!this.get("image")&&this.get("key")&&this.set("image","_"+this.get("key")),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),t},this)},this).mapError(function(e){return this.get("image")&&404===e.status_code()&&this.set("image",null),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),h.value(!0)}):t).success(this.activate,this),!0)},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.set("playerattrs",{application:this.application,"effect-profile":this.get("preview-effect-profile"),"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),image:this.get("image"),"force-refresh":o.now()}),this._track("image_embedding_loaded"),this._updateUrls()):s.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):s.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(e,t,i){this.application.analytics.track("2",e,{image_token:this.get("image"),stream_token:this.get("stream")},u.extend({embed_type:this.__hadInitialimage?"rerecorder":"recorder"},t),u.extend({creation_type:this.get("creation-type"),width:this.get("recordingwidth"),height:this.get("recordingheight"),tags:this.get("tags")},i))},functions:{reset:function(){this.get("image")&&!this.__hadInitialimage&&this.set("image",null),t.functions.reset.call(this)}},_updateUrls:function(){this.set("playerattrs.image",this.get("image")),this.set("uploadoptions",{image:this.application.image_streams.attachUploaderConfig(this.get("image"),this.get("stream"),this.get("auth"))})},_readDeviceOrientation:function(){return window.orientation+90||undefined},__createParams:function(){var e={};try{var t=this.activeElement().cloneNode();t.innerHTML="",e=t.outerHTML}catch(i){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):undefined,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):undefined,key:this.get("key"),auto_crop:this.get("auto-crop"),auto_pad:this.get("auto-pad"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),effect_profile:this.get("effect-profile")?this.get("effect-profile").join(","):undefined,force_overwrite:this.get("force-overwrite"),image_profile:this.get("image-profile"),meta_profile:this.get("meta-profile"),recover_streams:this.get("recover-streams"),user_language:navigator.language||navigator.userLanguage,image_file_name:this._imageFileName,device_info:u.extend({api_version:2,embed_code:e},a.info)}},_prepareRecording:function(){return this._requiresDeviceOrientation=m.isMobile()&&m.isiOS()&&window.orientation!==undefined&&this.recorder,this.get("image")?this.application.image_streams.create(this.get("image"),{},this.get("auth")).mapSuccess(function(e){this.set("token",e.image.token),this.set("image_data",e.image),this.set("stream",e.image_stream.token),this.set("stream_data",e.image_stream),this._updateUrls()},this):this.application.images.create(u.extend(this.__createParams(),{}),this.get("auth")).mapSuccess(function(e){this.set("token",e.image.token),this.set("image",e.image.token),this.set("image_data",e.image),this.set("stream",e.stream.token),this.set("stream_data",e.stream),this._updateUrls()},this)},_verifyRecording:function(){var e=h.create();return p.eventually(function(){this.get("image")&&(this.get("simulate")?h.value(!0):this.application.streams._recorder_submit(this.get("image"),this.get("stream"),{rotation:this._requiresDeviceOrientation?this._readDeviceOrientation():undefined},this.get("auth"),50)).success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("image")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.images.cacheInvalidate(this.get("image"))},this).forwardCallback(e)},this,2500),e},_afterActivate:function(e){t._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),e.parentElement.appendChild(this.__inputBindElement)),this.get("image"))&&(this.__inputBindElement.value=this.get("image"))}}}],function(e){return{recorderStates:function(){return e.recorderStates.call(this).concat([n])}}}).register("ba-ziggeoimagecapture").register("ziggeoimagecapture").registerFunctions({testing:function(e){return e.testing}}).attachStringTable(d.mainLocale).addStrings({})}),e.define("module:ImageRecorderStates.Recording",["mediacomponents:ImageCapture.Dynamics.RecorderStates.Recording"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("image_record_start")},_hasStopped:function(){e._hasStopped.call(this),this.dyn._track("image_record_end",{media_time:this.dyn.get("duration")})}}})}),e.define("module:ImageRecorderStates.Chooser",["mediacomponents:ImageCapture.Dynamics.RecorderStates.Chooser"],function(e,t){return e.extend({scoped:t},function(t){return{_uploadFile:function(e){t._uploadFile.call(this,e),this.dyn._track("image_upload_start",{data_size:e.size})}}})}),e.define("module:ImageRecorderStates.Uploading",["mediacomponents:ImageCapture.Dynamics.RecorderStates.Uploading","base:Time"],function(e,i,t){return e.extend({scoped:t},function(t){return{_started:function(){var e;this.dyn.get("cache")&&(e={data:this.dyn.get("image_data"),imageFile:this.dyn.getImageFile()},this.dyn.get("token")&&this.dyn.application.cache.store(this.dyn.get("token"),e,this.dyn.getMediaType()),this.dyn.get("key")&&this.dyn.application.cache.store("_"+this.dyn.get("key"),e,this.dyn.getMediaType()),this.dyn.setProp("playerattrs.cache",!0),this.dyn.setProp("playerattrs.use-cache",!0)),t._started.call(this),this.dyn._track("image_uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){t._finished.call(this),this.dyn._track("image_uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",i.now())}}})}),e.define("module:PopupImageCapture",["module:ImageCapture","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),e.define("module:ImageViewer",["mediacomponents:ImageViewer.Dynamics.ImageViewer","private:Logger","module:Application","base:Types","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Promise","base:TimeFormat","private:ZiggeoDynamicMixin"],function(e,t,i,a,s,n,r,d,o,c,l,u,h){return e.extend({scoped:h},[u,function(e){return{attrs:{"stream-width":null,"stream-height":null,"effect-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,image:null,stream:null,application:null,cache:!1,forcerefresh:!1},types:{cache:"bool","lazy-application":"bool"},loadDataFromCache:function(){(this.get("use-cache")||this.get("usecache"))&&this.application.cache.read(this.get("image"),this.getMediaType()).success(function(e){this.set("image_data",e.data),this.set("source",e.imageFile)}.bind(this))},create:function(){if(this.loadDataFromCache(),this._invokeCallback=r.eventInvokeCallback,this.get("source")||0<this.get("sources").length)return e.create.call(this);this.set("ready",!1),this.get("effect-profile")&&a.is_array(this.get("effect-profile"))&&this.set("effect-profile",this.get("effect-profile")[0]),e.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.set("image_status",null)},_notifications:{_activate:"_createWithApplication"},_obtainApplication:function(){this.get("application")&&(this.application=a.is_string(this.get("application"))?i.instanceByToken(this.get("application")):this.get("application")),this.application=this.application||i.getDefault()},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.get("source")||this.__setImageSources(),this.set("ready",!0),this._track("image_embedding_loaded")},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this)):t.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):t.warn("No application (token) defined. We need an application (token) to include an embedding.")},destroy:function(){this.application.embed_events.off(null,null,this),e.destroy.call(this)},events:{"change:image":function(){this.set("stream",null),this.__setImageSources()}},__setImageSources:function(){this.get("image")&&this.get("application_status")&&(this.set("shareimageurl",this.application.images.publicImageUrl(this.get("image")).replace("http://","https://")),this.get("stream")||this.set("refresh_token",this.application.images.refreshToken(this.get("image"))),this.__setSources(),this.application.images.cache(this.get("image"),{auth:this.get("auth")}).callback(this.__imageUpdate,this),this.get("ready"))&&this.reattachImage()},__sourceByImage:function(t,e){var i,a,s,n,r,o=this.get("image_data"),c=d.filter(o&&o.streams?o.streams:[],function(e){return!(e.token!==o.original_stream.token&&e.parent_stream!==o.original_stream.token||5!==e.state||3!==e.streamable||this.get("effect-profile")&&e.effect_profile!==this.get("effect-profile"))},this);return e||this.get("stream-width")||this.get("stream-height")||c.length<2?(i=e?this.application.image_streams:this.application.images,a=[t],e&&a.push(e),a.push({auth:this.get("auth"),params:{stream_width:this.get("stream-width"),stream_height:this.get("stream-height"),effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh")}}),{source:i.imageUrl.apply(i,a),token:t}):(s=[],n=[],r={effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh"),auth:this.get("auth")},d.iter(c,function(e){s.push({src:this.application.image_streams.imageUrl(t,e.token,r),token:e.token}),n.push({width:e.image_width,height:e.image_height,filter:{token:e.token}})},this),{source:null,sources:s,streams:n,currentstream:n[0],token:t})},__setSources:function(){this.setAll(this.__sourceByImage(this.get("image"),this.get("stream")))},__imageUpdate:function(e,t){if(!this.destroyed())if(e)this.set("image_status",!1),e.status_code()===s.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("image-not-found")}):e.status_code()===s.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("image-access-forbidden")}):this.state().next("FatalError",{message:this.string("image-unknown-error")});else if(this.set("image_data",t),this.get("title")||this.set("title",t.title),this.set("totalduration",t.duration),!1!==t.approved||this.get("intermediate-token"))if(t.state<4)this.state().next("FatalError",{message:this.string("image-unknown-error")});else if(this.set("image_status",!0),4===t.state)"ImageProcessing"!==this.state().state_name()&&this.state().next("ImageProcessing");else{if(this.get("effect-profile")){var i=!1;if(d.iter(t.streams,function(e){e.effect_profile===this.get("effect-profile")&&4<e.state&&(i=!0)},this),!i)return void("ImageProcessing"!==this.state().state_name()&&this.state().next("ImageProcessing"));if("ImageProcessing"===this.state().state_name())return this.set("forcerefresh",o.now()),this.__setSources(),void this.state().next("LoadPlayer")}"ImageProcessing"===this.state().state_name()?(this.set("refresh_token",this.application.images.refreshToken(this.get("image"))),this.set("forcerefresh",o.now()),this.__setSources(),this.state().next("LoadPlayer")):this.get("stream")||this.get("refresh_token")||!this.application.images.refreshToken(this.get("image"))?this.__setSources():(this.set("refresh_token",this.application.images.refreshToken(this.get("image"))),this.__setSources(),this.state().next("LoadPlayer"))}else this.state().next("FatalError",{message:t.moderation_reason||this.string("image-rejected")})},_track:function(e,t,i){var a,s;this.application&&(a=o.now(),(s=c.create()).success(function(){this.application.analytics.track("2",e,{image_token:this.get("image_data").token,stream_token:this.get("stream")?this.get("stream"):undefined},d.extend({embed_type:"player"},t),d.extend({width:this.get("stream")?this.get("stream").width:this.imageWidth(),height:this.get("stream")?this.get("stream").height:this.imageHeight(),tags:this.get("image_data").tags},i),a)},this),this.get("image_data")?s.asyncSuccess():this.once("change:image_data",function(){s.asyncSuccess()},this))}}}]).register("ba-ziggeoimageviewer").register("ziggeoimageviewer").attachStringTable(n.mainLocale).addStrings({"image-not-found":"We could not find the specified image file.","image-access-forbidden":"You are not permitted to access this image file.","image-unknown-error":"We cannot access this image at the moment. Please try again later.","image-rejected":"The image has been rejected.","image-processing":"The image is processing - stay tuned.","image-access-error":"The image is currently under moderation. You may click to retry."})}),e.define("module:PopupImageViewer",["module:ImageViewer","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),e.define("module:Player",["mediacomponents:VideoPlayer.Dynamics.Player","private:Logger","module:Application","base:Types","module:PlayerStates.Initial","module:PlayerStates","base:Net.HttpHeader","module:Locale","module:Supplementary","base:Objs","base:Time","base:Timers.Timer","base:Promise","base:TimeFormat","private:ZiggeoDynamicMixin"],function(e,i,t,a,s,n,c,r,o,l,d,u,h,p,g,m){return e.extend({scoped:m},[g,function(e){return{attrs:{"stream-width":null,"stream-height":null,"effect-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,video:null,stream:null,application:null,cache:!1,forcerefresh:!1,pauseonplay:!1,"use-cache":!1,"audio-transcription-as-subtitles":!1,"default-fallback":!1},types:{playlist:"array",cache:"bool",pauseonplay:"bool","use-cache":"bool","lazy-application":"bool","audio-transcription-as-subtitles":"bool","default-fallback":"bool"},loadDataFromCache:function(){(this.get("use-cache")||this.get("usecache"))&&this.application.cache.read(this.get("video"),this.getMediaType()).success(function(e){e.data&&this.set("video_data",e.data),e.videoFile&&this.set("source",e.videoFile),e.covershotFile&&this.set("poster",e.covershotFile)}.bind(this))},create:function(){if(this.loadDataFromCache(),this._invokeCallback=o.eventInvokeCallback,this.get("source")||0<this.get("sources").length)return e.create.call(this);this.set("ready",!1),this.__playlist=this.get("playlist"),this.set("playlist",null),this.get("effect-profile")&&a.is_array(this.get("effect-profile"))&&this.set("effect-profile",this.get("effect-profile")[0]),e.create.call(this),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.set("video_status",null)},_initialState:s,_notifications:{_activate:"_createWithApplication"},_trackProcessing:function(){this.__tempv=this.get("video"),this.application.videos.watch(this.__tempv,{auth:this.get("auth"),maxage:2500},this.__videoUpdate,this),this.set("start-processing-time",d.now()),this._track("processing_start"),this._processingTimer=this.auto_destroy(new u({delay:100,context:this,fire:function(){var e=1e3,e=(this.get("duration")&&1e3<this.get("duration")/60*1e3&&(e=this.get("duration")/60*1e3),(d.now()-this.get("start-processing-time"))/e),e=1-1/(1+Math.sqrt(Math.sqrt(e)));(this.parent()?this.parent():this).trigger("processing",e)}}))},_stopTrackingProcessing:function(){this._processingTimer.destroy(),this.application.videos.unwatch(this.__tempv,this),this.set("end-processing-time",d.now()),this._track("processing_end",{media_time:this.get("end-processing-time")-this.get("start-processing-time")}),(this.parent()?this.parent():this).trigger("processed")},_videoWasProcessing:function(){return!!this._processingTimer},_createWithApplication:function(){var e,t;this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.application.embed_events.delegateEvents(null,this,null,[this]),this.__playlist&&(this.set("playlist",this.__playlist.map(function(e){return this.__sourceByVideo(e)},this)),e=this.get("playlist")[0],this.set("poster",e.poster),this.set("source",e.source),this.set("video",e.token),this.on("playlist-next",function(e){this.set("video",e.token)},this)),t=this.parent()&&this.parent().record!==undefined&&this.parent().host!==undefined&&!this.get("postersource"),this.listenOn(this.application,"ready",function(){this.application.authVideoReady(this.get("auth"),this.get("video")).callback(function(){this.set("application_status",!0),this.get("playlist")?(this.__setVideoSources(),this.set("ready",!0)):t?this.application.videos.get(this.get("video"),{auth:this.get("auth")}).callback(function(e,t){this.get("localplayback")&&this.parent()&&this.parent().once("verified",function(){this.destroyed()||this._trackProcessing()},this),this.get("source")||this.__setVideoSources(),t&&4===t.state&&!this.get("localplayback")&&this.state().next("VideoProcessing"),this.get("effect-profile")||this.set("ready",!0)},this):(this.get("source")||this.__setVideoSources(),this.get("effect-profile")||this.set("ready",!0)),this._track("embedding_loaded")},this)},this).listenOn(this.application,"error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.get("pauseonplay")&&this.application.embed_events.on("playing",function(e){e!==this&&this.get("playing")&&this.execute("pause")},this),this.set("tracktags",this.application.data.get("track_tags"))):i.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):i.warn("No application (token) defined. We need an application (token) to include an embedding.")},destroy:function(){this.application.embed_events.off(null,null,this),e.destroy.call(this)},getSubtitle:function(){var e=this.get("video_data").streams[0].audio_transcription;return!!e&&this.__audioTranscriptionToVTT(e.words,e.times)},events:{"change:video":function(){var e;this.host&&(this.set("stream",null),e=0<=this.host.state().state_name().indexOf("Error"),this.__setVideoSources(),e)&&this.host.next("Initial")},paused:function(){this._track("play_pause",{media_time:this.get("position")})},playing:function(){this._track("play_playing",{media_time:this.get("position")})},ended:function(){this._track("play_end",{media_time:this.get("duration")})},seek:function(e){this._track("play_seek",{media_time:e})}},__setShareVideoUrl:function(e){this.set("sharevideourl",this.application.videos.iframeVideoUrl(e).replace("http://","https://"))},__setVideoSources:function(){this.get("video")&&this.get("application_status")&&(this.__setShareVideoUrl(this.get("video")),this.get("stream")||this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.__setSources(),this.application.videos.cache(this.get("video"),{auth:this.get("auth")}).callback(this.__videoUpdate,this),this.get("ready"))&&this.reattachVideo()},__sourceByVideo:function(t,e){var i,a,s,n,r,o=this.get("video_data"),c=(o&&null!==o.title&&this.set("posteralt",o.title),o&&o.duration&&o.duration&&this.set("duration",o.duration),o&&o.description&&this.set("description",o.description),o&&("undefined"!=typeof o.created&&this.set("uploaddate",o.created),"undefined"!=typeof o.embed_image_url&&this.set("thumbnailurl","https://"+o.embed_image_url),"undefined"!=typeof o.embed_video_url)&&(-1===o.embed_video_url.indexOf(".mp4")?this.set("contenturl","https://"+o.embed_video_url+".mp4"):this.set("contenturl","https://"+o.embed_video_url)),this.get("effect-profile")),d=(o&&o.default_stream&&o.default_stream.effect_profile&&!this.get("effect-profile")&&(c=o.default_stream.effect_profile),l.filter(o&&o.streams?o.streams:[],function(e){return!(e.token!==o.original_stream.token&&e.parent_stream!==o.original_stream.token||5!==e.state||3!==e.streamable||(c||e.effect_profile)&&e.effect_profile!==c)},this));return this.get("playlist")&&(d=[],e=null),o&&"_"===this.get("video")[0]&&this.__setShareVideoUrl(o.token),e||this.get("stream-width")||this.get("stream-height")||d.length<2?(i=e?this.application.streams:this.application.videos,a=[t],e&&a.push(e),a.push({auth:this.get("auth"),params:{stream_width:this.get("stream-width"),stream_height:this.get("stream-height"),effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh")}}),{poster:this.get("poster")||i.imageUrl.apply(i,a),source:i.videoUrl.apply(i,a),token:t}):(s=[],n=[],r={effect_profile:this.get("effect-profile"),force_refresh:this.get("forcerefresh"),auth:this.get("auth")},l.iter(d,function(e){s.push({src:this.application.streams.videoUrl(t,e.token,r),poster:this.application.streams.imageUrl(t,e.token,r),token:e.token}),n.push({width:e.video_width,height:e.video_height,filter:{token:e.token}})},this),{poster:null,source:null,sources:s,streams:n,currentstream:n[0],token:t})},__setSources:function(){this.set("uploadoptions",{textTracks:this.application.streams.subtitleAttachUploaderUrl(this.get("video"),this.get("stream")||this.properties().getProp("video_data.original_stream.token"),this.get("auth"))}),this.setAll(this.__sourceByVideo(this.get("video"),this.get("stream")))},__audioTranscriptionToVTT:function(e,t,i){i=i||5;for(var a=e.length,s=0,n=["WEBVTT"];s<a;){var r=t[s].start,o=t[s].end,c=[e[s]];for(s++,j=i-1;0<j&&s<a;)o=t[s].end,c.push(e[s]),s++,j--;n.push(""),n.push(p.format("HH:MM:ss.l",r)+" --\x3e "+p.format("HH:MM:ss.l",o)),n.push(c.join(" "))}return n.join("\n")},__videoUpdate:function(e,t){if(!this.destroyed())if(e)this.set("video_status",!1),e.status_code()===c.HTTP_STATUS_NOT_FOUND?this.state().next("FatalError",{message:this.string("video-not-found")}):e.status_code()===c.HTTP_STATUS_FORBIDDEN?this.state().next("FatalError",{message:this.string("video-access-forbidden")}):this.state().next("LoadError");else{this.set("video_data",t);var i=[];try{var a=t.default_stream.audio_transcription||t.original_stream.audio_transcription,s=(a&&this.get("audio-transcription-as-subtitles")&&i.push({lang:"en",kind:"subtitles",label:"Transcription",content:this.__audioTranscriptionToVTT(a.words,a.times)}),t.default_stream.subtitles||t.original_stream.subtitles);s&&l.iter(s,function(e,t){i.push({lang:t,kind:"subtitles",label:e.label,content:e.data})})}catch(o){}if(this.set("tracktags",this.get("tracktags").concat(i)),this.get("title")||this.set("title",t.title),this.set("totalduration",t.duration),!1!==t.approved||this.get("intermediate-token"))if(t.state<4)this.state().next("FatalError",{message:this.string("video-unknown-error")});else if(this.set("video_status",!0),4!==t.state||this.get("localplayback")){if(this.get("effect-profile")){var n=!1,r=!1;if(l.iter(t.streams,function(e){e.effect_profile===this.get("effect-profile")&&4<e.state&&(n=!0),e.effect_profile!==this.get("effect-profile")||"EMPTY"!=e.state_string&&"PROCESSING"!=e.state_string||(r=!0)},this),null!=t.effect_profile&&-1!=t.effect_profile.indexOf(this.get("effect-profile"))&&(r=!0),!n&&!this.get("default-fallback"))return r?void this.state().next("VideoProcessing"):void("VideoProcessing"!==this.state().state_name()&&(this._detachImage(),this._detachVideo(),this.on("image-attached",function(){this._detachImage()},this),this.on("video-attached",function(){this._detachVideo()},this),this._error("effectprofile","effect profile not found"),this.state().next("FatalError",{message:this.string("video-effect-profile-not-found")})));if(this.set("ready",!0),"VideoProcessing"===this.state().state_name())return this.set("forcerefresh",d.now()),this.__setSources(),void this.state().next("LoadPlayer")}this._videoWasProcessing()&&this._stopTrackingProcessing(),"VideoProcessing"===this.state().state_name()?(this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.set("forcerefresh",d.now()),this.__setSources(),this.state().next("LoadPlayer")):this.get("stream")||this.get("refresh_token")||!this.application.videos.refreshToken(this.get("video"))?this.__setSources():(this.set("refresh_token",this.application.videos.refreshToken(this.get("video"))),this.__setSources(),this.state().next("LoadPlayer"))}else"VideoProcessing"!==this.state().state_name()&&this.state().next("VideoProcessing");else this.state().next("FatalError",{message:t.moderation_reason||this.string("video-rejected")})}},_track:function(e,t,i){var a,s;this.application&&(a=d.now(),(s=h.create()).success(function(){this.application.analytics.track("2",e,{video_token:this.get("video_data").token,stream_token:this.get("stream")?this.get("stream"):undefined},l.extend({embed_type:"player"},t),l.extend({duration:this.get("video_data").duration||this.get("duration"),width:this.get("stream")?this.get("stream").width:this.videoWidth(),height:this.get("stream")?this.get("stream").height:this.videoHeight(),tags:this.get("video_data").tags},i),a)},this),this.get("video_data")?s.asyncSuccess():this.once("change:video_data",function(){s.asyncSuccess()},this))}}}],function(e){return{playerStates:function(){return e.playerStates.call(this).concat([n])}}}).register("ba-ziggeoplayer").register("ziggeoplayer").attachStringTable(r.mainLocale).addStrings({"video-not-found":"We could not find the specified video file.","video-access-forbidden":"You are not permitted to access this video file.","video-unknown-error":"We cannot access this video at the moment. Please try again later.","video-rejected":"The video has been rejected.","video-processing":"The video is processing - stay tuned.","video-access-error":"The video is currently under moderation. You may click to retry.","video-effect-profile-not-found":"Video is unavailable at the moment"})}),e.define("module:PopupPlayer",["module:Player","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),e.define("module:IframePlayer",["mediacomponents:IframeHelper","private:Core","private:ZiggeoDynamicMixin"],function(e,t,i,a){return e.extend({scoped:a},[i,{getAllowModifiers:function(){return t.video.iframe["allow-player-mods"]},getSrc:function(){return this.application.videos.iframeVideoUrl(this.get("video"))}}]).register("ba-ziggeoiframeplayer").register("ziggeoiframeplayer")}),e.define("module:PlayerStates.Initial",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.Initial"],function(e,t){return e.extend({scoped:t},function(e){return{dynamics:["loader"],_started:function(){this.dyn.get("video_data")&&4===this.dyn.get("video_data").state?this.next("VideoProcessing"):e._started.call(this)}}})}),e.define("module:PlayerStates.PosterError",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.State"],function(e,t){return e.extend({scoped:t},{dynamics:["loader"],_fail:function(){4===this.dyn.get("video_data").state?this.next("VideoProcessing"):window.navigator.onLine?(this.dyn.set("loader_active",!1),this.dyn.set("message_active",!0),this.dyn.set("message",this.dyn.string("video-access-error")),this.listenOn(this.dyn,"message:click",function(){this.next("LoadPlayer")},this)):this.next("LoadError")},_started:function(){!0===this.dyn.get("video_status")?this._fail():this.listenOn(this.dyn,"change:video_status",function(){!0===this.dyn.get("video_status")&&this._fail()})}})}),e.define("module:PlayerStates.VideoProcessing",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.State"],function(e,t){return e.extend({scoped:t},function(e){return{dynamics:["loader","message"],_started:function(){this.dyn.set("message",this.dyn.string("video-processing")),this.__sharevideo=this.dyn.get("sharevideo"),this.dyn.set("sharevideo",[]),this.dyn._trackProcessing()},_end:function(){this.dyn.set("sharevideo",this.__sharevideo),e._end.call(this)}}})}),e.define("module:PlayerStates.LoadVideo",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.LoadVideo"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){this.dyn.loadDataFromCache(),e._started.call(this)}}})}),e.define("module:PlayerStates.PlayVideo",["mediacomponents:VideoPlayer.Dynamics.PlayerStates.PlayVideo"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("play_start")}}})}),e.define("module:Recorder",["mediacomponents:VideoRecorder.Dynamics.Recorder","module:Application","module:Device","private:Logger","private:Environment","private:S3.MediaUploader","module:RecorderStates","base:Types","base:MediaTypes","base:Time","base:Strings","module:Locale","module:Supplementary","base:Objs","base:Promise","base:Async","browser:Events","browser:Info","browser:Upload.S3MultipartSupport","private:ZiggeoDynamicMixin"],function(e,i,a,s,t,n,r,o,c,d,l,u,h,p,g,m,_,f,v,y,b){return e.extend({scoped:b},[y,function(t){return{template:t.template.replace('"overlay">','"overlay"><a class="ziggeo-v2-testing" ba-if="{{testing}}" href="https://ziggeo.com/pricing" target="_blank"></a>'),attrs:{dynvideoplayer:"ziggeoplayer","effect-profile":null,"preview-effect-profile":null,"video-profile":null,"meta-profile":null,"client-auth":null,"server-auth":null,"intermediate-token":null,application:null,video:null,description:null,title:null,tags:null,"custom-data":null,key:null,"auto-crop":null,"default-image-selector":.1,"auto-pad":null,"expiration-days":null,"force-overwrite":null,"recover-streams":null,"transcript-language":"en-US","input-bind":null,"form-accept":null,cache:!1,playermodeifexists:!1,rerecordableifexists:!1,chrome_extension_id:null,opera_extension_id:null,chrome_extension_install_link:null,opera_extension_install_link:null},types:{tags:"array","custom-data":"object","auto-crop":"bool","auto-pad":"bool",cache:"bool","expiration-days":"int","delete-old-streams":"bool","force-overwrite":"bool","recover-streams":"bool","default-image-selector":"float","effect-profile":"array","lazy-application":"bool",playermodeifexists:"bool",rerecordableifexists:"bool"},events:{rerecord:function(){this.__inputBindElement&&(this.__inputBindElement.value=""),this.get("form-accept")&&this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()})}},create:function(){this._invokeCallback=h.eventInvokeCallback,this.set("ready",!1),t.create.call(this),this.get("video")&&(!this.get("key")&&l.starts_with(this.get("video"),"_")?this.set("key",l.strip_start(this.get("video"),"_")):this.set("token",this.get("video"))),this.get("simulate")&&this.set("localplayback",!0),o.is_string(this.get("effect-profile"))&&this.set("effect-profile",o.parseArray(this.get("effect-profile"))),this.set("auth",{client_auth:this.get("client-auth"),server_auth:this.get("server-auth"),intermediate_token:this.get("intermediate-token")}),this.set("application_status",null),this.__hadInitialVideo=!!this.get("video"),this.get("video")||(this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),this.get("form-accept")&&(this._formAcceptEvents=this.auto_destroy(new _),this._formAcceptEvents.on(document.querySelector(this.get("form-accept")),"submit",function(e){e.preventDefault()}))),this.on("rerecord",function(){this._track("rerecord_confirm")},this),this.scopes.player.on("change:video_data",function(e){this.set("video_data",e);e=e.streams.find(function(e){return e.token===this.get("stream")},this);e&&this.set("stream_data",e)},this)},_notifications:{_activate:"_createWithApplication"},_deferActivate:function(){var t;return this._obtainApplication(),!!(!this.application&&this.get("lazy-application")||this.get("playermodeifexists")||this.get("rerecordableifexists"))&&(t=g.create(),this.application?t.asyncSuccess(!0):i.events.once("set-default",function(e){this.application=e,t.asyncSuccess(!0)},this),(t=this.get("playermodeifexists")||this.get("rerecordableifexists")?t.mapSuccess(function(t){return this.application.videos.get(this.get("video")||(this.get("key")?"_"+this.get("key"):null),{auth:this.get("auth")}).mapSuccess(function(e){return e&&"EMPTY"!==e.state_string&&(this.get("playermodeifexists")&&this.set("recordermode",!1),this.get("rerecordableifexists")||this.set("rerecordable",!1)),!this.get("video")&&this.get("key")&&this.set("video","_"+this.get("key")),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),t},this)},this).mapError(function(e){return this.get("video")&&404===e.status_code()&&this.set("video",null),this.set("playermodeifexists",!1),this.set("rerecordableifexists",!1),g.value(!0)},this):t).success(this.activate,this),!0)},_createWithApplication:function(){this._obtainApplication(),this.application?this.application.data.get("auth")||!this.get("client-auth")&&!this.get("server-auth")?(this.get("chrome_extension_id")&&!this.get("chrome_extension_install_link")&&this.set("chrome_extension_install_link","https://chrome.google.com/webstore/detail/"+this.get("chrome_extension_id")),this.set("screen",{chromeExtensionId:this.get("chrome_extension_id")||this.application.data.get("chrome_extension_id"),operaExtensionId:this.get("opera_extension_id")||this.application.data.get("opera_extension_id"),chromeExtensionInstallLink:this.get("chrome_extension_install_link")||this.application.data.get("chrome_extension_install_link"),operaExtensionInstallLink:this.get("opera_extension_install_link")||this.application.data.get("opera_extension_install_link")}),this.application.embed_events.delegateEvents(null,this,null,[this]),this.application.on("ready",function(){this.set("application_status",!0),this.set("ready",!0),this.set("testing",this.application.data.get("testing_application"))},this).on("error",function(e,t){this.set("application_status",!1),this.state().next("FatalError",{message:t})},this),this.set("playerattrs",{application:this.application,"effect-profile":this.get("preview-effect-profile"),"client-auth":this.get("client-auth"),"server-auth":this.get("server-auth"),"intermediate-token":this.get("intermediate-token"),video:this.get("video"),"force-refresh":d.now()}),this._track("embedding_loaded"),this.set("webrtcstreaming",this.application.data.get("webrtc_streaming")),this.set("webrtcstreamingifnecessary",this.application.data.get("webrtc_streaming_if_necessary")),this.set("webrtconmobile",this.application.data.get("webrtc_on_mobile")),f.isSafari()&&f.isDesktop()&&!this.get("webrtcstreaming")&&!this.get("webrtcstreamingifnecessary")&&this.set("webrtcstreamingifnecessary",!0),!this.get("webrtcstreaming")&&!this.get("webrtcstreamingifnecessary")||this.get("timeminlimit")||this.set("timeminlimit",5),this._updateUrls()):s.warn("You are specifying auth tokens on your embedding yet your application is initialized with auth = false."):s.warn("No application (token) defined. We need an application (token) to include an embedding.")},_track:function(e,t,i){this.application.analytics.track("2",e,{video_token:this.get("video"),stream_token:this.get("stream")},p.extend({embed_type:this.__hadInitialVideo?"rerecorder":"recorder"},t),p.extend({creation_type:this.get("creation-type"),duration:this.get("duration"),width:this.get("recordingwidth"),height:this.get("recordingheight"),tags:this.get("tags")},i))},functions:{reset:function(){this.get("video")&&!this.__hadInitialVideo&&this.set("video",null),t.functions.reset.call(this)}},_updateUrls:function(i,a,s){var e=this._videoFile?(e=g.create(),this.application.streams._get_video_upload_urls(this.get("video"),this.get("stream"),{parts:v.calculateNumberOfChunks(this._videoFile.size)},this.auth,50)):g.value();return e.mapSuccess(function(e){var t;(e||i)&&(t={resilienceCheck:function(e){return!e||!e.duration}},e&&p.extend(t,{s3:!0,uploadId:e.url_data.uploadId,urls:e.url_data.urls,noFormData:!0}),i)&&p.extend(t,this.application.data.getSignedUploaderConfig(i.url,i.fields)),this.set("playerattrs.video",this.get("video")),this.set("uploadoptions",{webrtcStreaming:{wssUrl:this.get("webrtcstreaming")||this.get("webrtcstreamingifnecessary")?this.application.urls.wssUrl():undefined,streamInfo:this.get("webrtcstreaming")||this.get("webrtcstreamingifnecessary")?{applicationName:this.application.urls.webrtcStreamingApp(f.isFirefox()?"udp":""),streamName:this.application.streams.webrtcStreamName(this.get("video"),this.get("stream"),this.get("auth"))}:undefined,delay:4750,stopDelay:2750},image:a?this.application.data.getSignedUploaderConfig(a.url,a.fields):undefined,video:t,audio:s?this.application.data.getSignedUploaderConfig(s.url,s.fields):undefined,textTracks:this.application.streams.subtitleAttachUploaderUrl(this.get("video"),this.get("stream"),this.get("auth")),noUploading:"webrtc"===this.get("creation-type")&&!this.isWebrtcStreaming()})},this)},_readDeviceOrientation:function(){var e=this.recorder.getCameraFacingMode();switch(window.orientation){case 0:return 90;case 90:return"environment"===e?0:180;case-90:return"environment"===e?180:0;case 180:return 270}},_startRecording:function(){var e;return this.isWebrtcStreaming()?t._startRecording.call(this):(e=this._initializeRecorderUploader().mapSuccess(function(){return t._startRecording.call(this)},this),this.recorder.on("dataavailable",function(e){this._videoUploader.upload(e.data)},this),e)},_initializeRecorderUploader:function(){return this._videoUploader=new n,this._dataUploader.addUploader(this._videoUploader),this._videoUploader.setUploadUrlsPromise(function(e){return this.application.streams._get_video_upload_urls(this.get("video"),this.get("stream"),{parts:e,uploadId:this._videoUploader.getUploadId()},this.auth,50)}.bind(this)),this._videoUploader.getUploadUrls(1e3)},__createParams:function(){var e={};try{var t=this.activeElement().cloneNode();t.innerHTML="",e=t.outerHTML}catch(i){}return{description:this.get("description"),title:this.get("title"),tags:this.get("tags")?this.get("tags").join(","):undefined,data:this.get("custom-data")?JSON.stringify(this.get("custom-data")):undefined,key:this.get("key"),auto_crop:this.get("auto-crop"),auto_pad:this.get("auto-pad"),only_audio:this.get("onlyaudio"),expiration_days:this.get("expiration-days"),delete_old_streams:this.get("delete-old-streams"),effect_profile:this.get("effect-profile")?this.get("effect-profile").join(","):undefined,force_overwrite:this.get("force-overwrite"),video_profile:this.get("video-profile"),meta_profile:this.get("meta-profile"),enforce_duration:this.get("enforce-duration"),recover_streams:this.get("recover-streams"),max_duration:this.get("timelimit"),user_language:navigator.language||navigator.userLanguage,video_file_name:this._videoFileName,transcript_language:"auto"==this.get("transcript-language").toLowerCase()?navigator.language||navigator.userLanguage:this.get("transcript-language"),default_image_selector:this.get("default-image-selector"),device_info:p.extend({api_version:2,embed_code:e,media_source:this.__getMediaSource(),capture_type:this.__getCaptureType()},a.info)}},__recordingTypeParams:function(){var e={create_stream:!0};if(this.recorder){try{var t=this.recorder._recorder._recorder._mediaRecorder.mimeType;t&&p.extend(e,{video_type:c.getExtension(t)})}catch(i){}return p.extend(e,{webrtc_recording:!0,webrtc_streaming:this.isWebrtcStreaming(),audio_url:!this.isWebrtcStreaming(),image_url:!0})}return this._videoFile&&p.extend(e,{video_type:l.last_after(this._videoFile.name,".")}),this.get("snapshotfromuploader")?p.extend(e,{image_url:!0}):e},__getMediaSource:function(){var e=this.__recordingTypeParams();return"screen"==this.get("record_media")?"screen":!0===e.webrtc_recording?"record":"upload"},__getCaptureType:function(){var e=this.__recordingTypeParams();return!0===e.webrtc_streaming?"webrtc_streaming":!0===e.webrtc_recording?"webrtc":"file_capture"},_prepareRecording:function(){return this._requiresDeviceOrientation=f.isMobile()&&f.isiOS()&&window.orientation!==undefined&&this.isWebrtcStreaming(),this.get("video")?this.application.streams._create(this.get("video"),this.__recordingTypeParams(),this.get("auth"),5).mapSuccess(function(e){return this.set("token",e.stream.video_token),this.set("stream",e.stream.token),this.set("stream_data",e.stream),this._updateUrls(e.url_data,e.image_url_data,e.audio_url_data)},this):this.application.videos._create(p.extend(this.__createParams(),this.__recordingTypeParams()),this.get("auth"),5).mapSuccess(function(e){return this.set("token",e.video.token),this.set("video",e.video.token),this.set("video_data",e.video),this.set("stream",e.stream.token),this.set("stream_data",e.stream),this._updateUrls(e.url_data,e.image_url_data,e.audio_url_data)},this)},_verifyRecording:function(){var i=g.create();return m.eventually(function(){var e,t;this.get("video")&&(e={},t={},this.isWebrtcStreaming()||p.extend(e,{parts:JSON.stringify(this._videoUploader.data()),uploadId:this._videoUploader.getUploadId()}),this._requiresDeviceOrientation&&p.extend(e,{rotation:this._readDeviceOrientation()}),this.get("starttime")&&p.extend(e,{start_time:this.get("starttime")}),this.get("endtime")&&p.extend(e,{end_time:this.get("endtime")}),0<this.get("duration")&&p.extend(e,{duration:this.get("duration")}),this.imageUploaded()&&p.extend(t,{confirm_image:!0}),this.audioUploaded()&&p.extend(t,{confirm_audio:!0}),(this.get("simulate")?g.value(!0):this.application.streams._confirm(this.get("video"),this.get("stream"),e,this.get("auth"),50,t)).success(function(){this.__inputBindElement&&(this.__inputBindElement.value=this.get("video")),this.get("form-accept")&&this._formAcceptEvents.off(document.querySelector(this.get("form-accept")),"submit"),this.application.videos.cacheInvalidate(this.get("video"))},this).forwardCallback(i))},this,2500),i},_afterActivate:function(e){t._afterActivate.apply(this,arguments),this.get("input-bind")&&(this.__inputBindElement=document.getElementsByName(this.get("input-bind"))[0],this.__inputBindElement||(this.__inputBindElement=document.createElement("input"),this.__inputBindElement.type="hidden",this.__inputBindElement.id=this.get("input-bind"),this.__inputBindElement.name=this.get("input-bind"),e.parentElement.appendChild(this.__inputBindElement)),this.get("video"))&&(this.__inputBindElement.value=this.get("video"))}}}],function(e){return{recorderStates:function(){return e.recorderStates.call(this).concat([r])}}}).register("ba-ziggeorecorder").register("ziggeorecorder").registerFunctions({testing:function(e){return e.testing}}).attachStringTable(u.mainLocale).addStrings({})}),e.define("module:PopupRecorder",["module:Recorder","mediacomponents:PopupHelper"],function(e,t,i){return e.extend({scoped:i},t.mixin)}),e.define("module:IframeRecorder",["mediacomponents:IframeHelper","private:Core","private:ZiggeoDynamicMixin"],function(e,t,i,a){return e.extend({scoped:a},[i,{getAllowModifiers:function(){return t.video.iframe["allow-recorder-mods"]},getSrc:function(){return this.application.videos.iframeRecorderUrl()}}]).register("ba-ziggeoiframerecorder").register("ziggeoiframerecorder")}),e.define("module:RecorderStates.Recording",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Recording"],function(e,t){return e.extend({scoped:t},function(e){return{_started:function(){e._started.call(this),this.dyn._track("record_start")},_hasStopped:function(){this.dyn._requiresDeviceOrientation&&(this.dyn._rotation=this.dyn._readDeviceOrientation()),e._hasStopped.call(this),this.dyn._track("record_end",{media_time:this.dyn.get("duration")})}}})}),e.define("module:RecorderStates.Chooser",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Chooser"],function(e,t){return e.extend({scoped:t},function(t){return{_uploadFile:function(e){t._uploadFile.call(this,e),this.dyn._track("upload_start",{data_size:e.size})}}})}),e.define("module:RecorderStates.CovershotSelection",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.CovershotSelection"],function(e,t){return e.extend({scoped:t},function(t){return{_next:function(e){this.dyn._track(e?"cover_skip":"cover_select"),t._next.call(this,e)}}})}),e.define("module:RecorderStates.CovershotSelectionFromGallery",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.CovershotSelectionFromGallery"],function(e,t){return e.extend({scoped:t},function(t){return{_next:function(e){this.dyn._track(e?"cover_skip":"cover_select"),t._next.call(this,e)}}})}),e.define("module:RecorderStates.CovershotSelectionFromPlayer",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.CovershotSelectionFromPlayer"],function(e,t){return e.extend({scoped:t},function(t){return{_next:function(e){this.dyn._track(e?"cover_skip":"cover_select"),t._next.call(this,e)}}})}),e.define("module:RecorderStates.Uploading",["mediacomponents:VideoRecorder.Dynamics.RecorderStates.Uploading","base:Time"],function(e,i,t){return e.extend({scoped:t},function(t){return{_started:function(){var e;this.dyn.get("cache")&&(e={data:this.dyn.get("video_data"),videoFile:this.dyn.getVideoFile(),covershotFile:this.dyn.getCovershotFile()},this.dyn.get("token")&&this.dyn.application.cache.store(this.dyn.get("token"),e,this.dyn.getMediaType()),this.dyn.get("key")&&this.dyn.application.cache.store("_"+this.dyn.get("key"),e,this.dyn.getMediaType()),this.dyn.setProp("playerattrs.cache",!0),this.dyn.setProp("playerattrs.use-cache",!0)),t._started.call(this),this.dyn._track("uploading_start",{data_size:this.dyn._dataUploader.totalBytes()})},_finished:function(){t._finished.call(this),this.dyn._track("uploading_end",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn._track("upstream_bandwidth",{media_time:this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"),data_size:this.dyn._dataUploader.totalBytes(),bandwidth:this.dyn._dataUploader.totalBytes()/(this.dyn.get("end-upload-time")-this.dyn.get("start-upload-time"))}),this.dyn.setProp("playerattrs.forcerefresh",i.now())}}})}),e.define("module:VideoCall",["base:Ajax.Support","base:Promise","mediacomponents:VideoCall.Dynamics.Call","private:KVSWebRTCLoaderMixin","private:ZiggeoDynamicMixin"],function(n,i,e,t,a,s){return e.extend({scoped:s},[a,function(e){return{attrs:{call:null,master:!0,role:"master",viewer:!1},computed:{"mode:call":function(e){return e?"join":"create"}},types:{call:"string",master:"bool",role:"string",viewer:"bool"},create:function(){this.set("viewer","viewer"===this.get("role")),this.set("master","viewer"!==this.get("role")),e.create.call(this)},_deferActivate:function(){return!!a._deferActivate.call(this)||!!t._deferActivate.call(this)},_connect:function(){return this.get("call")?this.get("master")?this._startMasterConnection():this.get("viewer")?this._startViewerConnection():void 0:this._createCallAndConnect()},_createCallAndConnect:function(){return this.application.video_calls.create().mapSuccess(function(e){return this.set("call_data",e.call),this.set("call",e.call.token),this._connect()}.bind(this))},_startMasterConnection:function(){return this._startConnection({master:!0})},_startViewerConnection:function(){return this._startConnection({viewer:!0})},_startConnection:function(s){var t=i.create();return this.application.video_calls.join(this.get("call"),s).success(function(e){e.signaling_client.requestSigner={getSignedURL:function(e,t,i){return i=i||new Date,n.execute({method:"POST",uri:this.application.urls.liveCallsSignUrl(),data:{endpoint:e,query_params:t,date:i}}).toNativePromise()}.bind(this)};var i=new KVSWebRTC.SignalingClient(e.signaling_client),a=(this.set("call_data",e.call),this._signalingClient=i,{iceServers:e.ice_servers,iceTransportPolicy:"all"});s.viewer&&this._createPeerConnection(a),i.on("open",function(){t.asyncSuccess(),!s.master&&this.get("local_stream")&&(this._videoSender=this._peerConnection.addTrack(this.get("local_stream").getVideoTracks()[0],this.get("local_stream")),this._audioSender=this._peerConnection.addTrack(this.get("local_stream").getAudioTracks()[0],this.get("local_stream")),this._peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){this._peerConnection.setLocalDescription(e).then(function(){this._useTrickleICE&&this._signalingClient.sendSdpOffer(this._peerConnection.localDescription)}.bind(this))}.bind(this)))}.bind(this)),s.viewer&&i.on("sdpAnswer",function(e){this._peerConnection.setRemoteDescription(e)}.bind(this)),s.master&&i.on("sdpOffer",function(e,t){s.master&&(this._createPeerConnection(a),this._peerConnectionByClientId[t]=this._peerConnection),this._peerConnection.addEventListener("icecandidate",function(e){e.candidate?this._useTrickleICE&&i.sendIceCandidate(e.candidate,t):this._useTrickleICE||i.sendSdpAnswer(this._peerConnection.localDescription,t)}.bind(this)),this._peerConnection.addEventListener("track",function(e){console.log("received track",e),"audio"===e.track.kind&&this.set("remote_microphone_active",!0),"video"===e.track.kind&&this.set("remote_camera_active",!0),this.set("remote_stream",e.streams[0]),this.get("remote_stream").addEventListener("removetrack",function(e){console.log("removetrack event",e)}),this.get("remote_stream").addEventListener("addtrack",function(e){console.log("addtrack event",e)})}.bind(this)),this.get("local_stream")&&(this._videoSender=this._peerConnection.addTrack(this.get("local_stream").getVideoTracks()[0],this.get("local_stream")),this._audioSender=this._peerConnection.addTrack(this.get("local_stream").getAudioTracks()[0],this.get("local_stream"))),this._peerConnection.setRemoteDescription(e).then(function(){this._peerConnection.createAnswer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(e){this._peerConnection.setLocalDescription(e).then(function(){this._useTrickleICE&&i.sendSdpAnswer(this._peerConnection.localDescription,t)}.bind(this))}.bind(this))}.bind(this))}.bind(this)),i.on("iceCandidate",function(e,t){s.viewer&&this._peerConnection.addIceCandidate(e),s.master&&this._peerConnectionByClientId[t].addIceCandidate(e)}.bind(this)),i.on("close",function(){this.host.state().next("CallEnded")}.bind(this)),i.on("error",function(e){throw t.asyncError(e),new Error(e)}.bind(this)),s.viewer&&(this._peerConnection.addEventListener("icecandidate",function(e){e.candidate?this._useTrickleICE&&i.sendIceCandidate(e.candidate):this._useTrickleICE||i.sendSdpOffer(this._peerConnection.localDescription)}.bind(this)),this._peerConnection.addEventListener("track",function(e){this.set("remote_stream",e.streams[0])}.bind(this))),i.open()}.bind(this)).error(function(e){t.asyncError(e)}),t},_useTrickleICE:!0,_peerConnectionByClientId:{}}}]).register("ba-ziggeovideocall").register("ziggeovideocall")}),e.define("private:KVSWebRTCLoaderMixin",["browser:Loader"],function(t){return{_deferActivate:function(){try{if(KVSWebRTC)return!1}catch(e){if(e instanceof ReferenceError)return t.loadScript("https://unpkg.com/amazon-kinesis-video-streams-webrtc/dist/kvs-webrtc.min.js",function(){this.activate()}.bind(this)),!0;throw e}}}}),e.define("private:Application.VideosApiMixin",function(){return{index:function(e,t,i){return this.application.connect.request("/videos/",{method:"GET",auth:t,resilience:i,data:e})},destroy:function(e,t,i){return this.application.connect.request("/videos/"+e,{method:"DELETE",auth:t,resilience:i})},destroy_file:function(e,t,i){return this.application.connect.request("/videos/"+e+"/file",{method:"DELETE",auth:t,resilience:i})},create:function(e,t,i){return this.application.connect.request("/videos",{method:"POST",auth:t,resilience:i,data:e})},_create:function(e,t,i){return this.application.connect.request("/videos/videos-upload-url",{method:"POST",auth:t,resilience:i,data:e})},update:function(e,t,i,a){return this.application.connect.request("/videos/"+e,{method:"POST",auth:i,resilience:a,data:t})},_playback:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/playback",{method:"POST",auth:i,resilience:a,data:t})},get:function(e,t,i){return this.application.connect.request("/videos/"+e,{method:"GET",auth:t,resilience:i})}}}),e.define("private:Application.StreamsApiMixin",function(){return{index:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/",{method:"GET",auth:i,resilience:a,data:t})},destroy:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t,{method:"DELETE",auth:i,resilience:a})},destroy_file:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/file",{method:"DELETE",auth:i,resilience:a})},create:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams",{method:"POST",auth:i,resilience:a,data:t})},_create:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/streams-upload-url",{method:"POST",auth:i,resilience:a,data:t})},accept:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/accept",{method:"POST",auth:i,resilience:a})},_image_attach:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/imageattach",{method:"POST",auth:a,resilience:s,data:i})},_audio_attach:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/audioattach",{method:"POST",auth:a,resilience:s,data:i})},_recorder_submit:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/recordersubmit",{method:"POST",auth:a,resilience:s,data:i})},_uploader_state:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/uploaderstate",{method:"GET",auth:i,resilience:a})},_subtitle_attach:function(e,t,i,a){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/subtitleattach",{method:"POST",auth:i,resilience:a})},_confirm:function(e,t,i,a,s,n){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/confirm-video",{method:"POST",auth:a,resilience:s,data:i,query:n})},_confirm_image:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/confirm-image",{method:"POST",auth:a,resilience:s,data:i})},_confirm_audio:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/confirm-audio",{method:"POST",auth:a,resilience:s,data:i})},_get_video_upload_urls:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/video-upload-urls",{method:"GET",auth:a,resilience:s,data:i})},_get_image_upload_urls:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/image-upload-urls",{method:"GET",auth:a,resilience:s,data:i})},_get_audio_upload_urls:function(e,t,i,a,s){return this.application.connect.request("/videos/"+e+"/streams/"+t+"/audio-upload-urls",{method:"GET",auth:a,resilience:s,data:i})}}}),e.define("private:Application.AudiosApiMixin",function(){return{index:function(e,t,i){return this.application.connect.apiRequest("/audios/",{method:"GET",auth:t,resilience:i,data:e})},destroy:function(e,t,i){return this.application.connect.apiRequest("/audios/"+e,{method:"DELETE",auth:t,resilience:i})},create:function(e,t,i){return this.application.connect.apiRequest("/audios",{method:"POST",auth:t,resilience:i,data:e})},update:function(e,t,i,a){return this.application.connect.apiRequest("/audios/"+e,{method:"POST",auth:i,resilience:a,data:t})},get:function(e,t,i){return this.application.connect.apiRequest("/audios/"+e,{method:"GET",auth:t,resilience:i})}}}),e.define("private:Application.AudioStreamsApiMixin",function(){return{index:function(e,t,i,a){return this.application.connect.apiRequest("/audios/"+e+"/streams/",{method:"GET",auth:i,resilience:a,data:t})},destroy:function(e,t,i,a){return this.application.connect.apiRequest("/audios/"+e+"/streams/"+t,{method:"DELETE",auth:i,resilience:a})},create:function(e,t,i,a){return this.application.connect.apiRequest("/audios/"+e+"/streams",{method:"POST",auth:i,resilience:a,data:t})},confirm:function(e,t,i,a,s){return this.application.connect.apiRequest("/audios/"+e+"/streams/"+t+"/confirm",{method:"POST",auth:a,resilience:s,data:i})},submit:function(e,t,i,a,s){return this.application.connect.apiRequest("/audios/"+e+"/streams/"+t+"/submit",{method:"POST",auth:a,resilience:s,data:i})},get:function(e,t,i,a){return this.application.connect.apiRequest("/audios/"+e+"/streams/"+t,{method:"GET",auth:i,resilience:a})},_get_audio_upload_urls:function(e,t,i,a,s){return this.application.connect.apiRequest("/audios/"+e+"/streams/"+t+"/audio-upload-urls",{method:"GET",auth:a,resilience:s,data:i})}}}),e.define("private:Application.ImagesApiMixin",function(){return{index:function(e,t,i){return this.application.connect.apiRequest("/images/",{method:"GET",auth:t,resilience:i,data:e})},destroy:function(e,t,i){return this.application.connect.apiRequest("/images/"+e,{method:"DELETE",auth:t,resilience:i})},create:function(e,t,i){return this.application.connect.apiRequest("/images",{method:"POST",auth:t,resilience:i,data:e})},update:function(e,t,i,a){return this.application.connect.apiRequest("/images/"+e,{method:"POST",auth:i,resilience:a,data:t})},get:function(e,t,i){return this.application.connect.apiRequest("/images/"+e,{method:"GET",auth:t,resilience:i})}}}),e.define("private:Application.ImageStreamsApiMixin",function(){return{index:function(e,t,i,a){return this.application.connect.apiRequest("/images/"+e+"/streams/",{method:"GET",auth:i,resilience:a,data:t})},destroy:function(e,t,i,a){return this.application.connect.apiRequest("/images/"+e+"/streams/"+t,{method:"DELETE",auth:i,resilience:a})},create:function(e,t,i,a){return this.application.connect.apiRequest("/images/"+e+"/streams",{method:"POST",auth:i,resilience:a,data:t})},confirm:function(e,t,i,a,s){return this.application.connect.apiRequest("/images/"+e+"/streams/"+t+"/submit",{method:"POST",auth:a,resilience:s,data:i})},submit:function(e,t,i,a,s){return this.application.connect.apiRequest("/images/"+e+"/streams/"+t+"/submit",{method:"POST",auth:a,resilience:s,data:i})},get:function(e,t,i,a){return this.application.connect.apiRequest("/images/"+e+"/streams/"+t,{method:"GET",auth:i,resilience:a})},_get_image_upload_urls:function(e,t,i,a,s){return this.application.connect.apiRequest("/images/"+e+"/streams/"+t+"/image-upload-urls",{method:"GET",auth:a,resilience:s,data:i})}}}),e.define("private:Application.AnalyticsApiMixin",function(){return{_push:function(e,t,i){return this.application.connect.apiRequest("/scitylana/kcart",{method:"POST",auth:t,resilience:i,data:e})}}}),e.define("private:Application.VideoCallsApiMixin",function(){return{create:function(e,t,i){return this.application.connect.apiRequest("/live-calls",{method:"POST",auth:t,resilience:i,data:e})},sign:function(e,t,i){return this.application.connect.apiRequest("/live-calls-sign-request",{method:"POST",auth:t,resilience:i,data:e})},join:function(e,t,i,a){return this.application.connect.apiRequest("/live-calls/"+e+"/join",{method:"POST",auth:i,resilience:a,data:t})},leave:function(e,t,i,a){return this.application.connect.apiRequest("/live-calls/"+e,{method:"POST",auth:i,resilience:a,data:t})},end:function(e,t,i,a){return this.application.connect.apiRequest("/live-calls/"+e,{method:"POST",auth:i,resilience:a,data:t})},update:function(e,t,i,a){return this.application.connect.apiRequest("/live-calls/"+e,{method:"POST",auth:i,resilience:a,data:t})}}})}.call(Scoped);